<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Virtual Coach AI — Swing Report</title>
<style>
:root{
  --bg:#0e1a22; --text:#ecf3f7; --muted:#9fb8c7; --accent:#5eb3ff;
  --ok:#19c37d; --warn:#f6c453; --bad:#ff6b6b;
  --panel:rgba(22,36,46,.62); --panel-brd:rgba(34,55,67,.65);
  --radius:16px; --shadow:0 8px 24px rgba(0,0,0,.35);
  --bgimg-opacity:.70; /* brighten background photo */
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Inter,Roboto,Helvetica,Arial,sans-serif;background:var(--bg)}
.bg{position:fixed;inset:0;background:url('/homepage-background.png') center/cover no-repeat fixed;opacity:var(--bgimg-opacity);filter:brightness(1.22) saturate(1.05);z-index:-1}

.wrap{max-width:1080px;margin:24px auto;padding:0 16px}
h1,h2,h3{margin:0}
.sub{color:var(--muted);font-size:13px}
.header{display:flex;align-items:flex-start;justify-content:space-between;gap:12px;margin:10px 0 14px}
.tools{display:flex;gap:8px;flex-wrap:wrap}
.btn,.select{background:rgba(22,36,46,.85);border:1px solid #223743;color:var(--text);padding:8px 12px;border-radius:12px;cursor:pointer}
.select{appearance:none;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');background-repeat:no-repeat;background-position:right 10px center;padding-right:36px}
.badge{background:rgba(29,47,59,.55);border:1px solid #263b48;color:#cfe3ee;padding:6px 10px;border-radius:999px;font-size:12px}

.grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media(max-width:900px){.grid2{grid-template-columns:1fr}}
.card,details.panel{background:var(--panel);border:1px solid var(--panel-brd);border-radius:var(--radius);box-shadow:var(--shadow)}
.card h3{padding:14px 16px;border-bottom:1px solid rgba(31,51,64,.75)}
.card .content{padding:12px 16px}
summary{list-style:none;display:flex;align-items:center;gap:10px;padding:14px 16px;cursor:pointer}
summary::-webkit-details-marker{display:none}
.pnum{width:34px;height:34px;border-radius:10px;background:rgba(12,24,32,.85);border:1px solid #223743;display:grid;place-items:center;font-weight:800}
.pname{font-weight:700}
.caret{margin-left:auto;transition:transform .2s ease} details[open] .caret{transform:rotate(180deg)}

.grade{display:inline-block;padding:3px 8px;border-radius:8px;font-size:12px;font-weight:800;color:#fff}
.grade.good{background:var(--ok)} .grade.ok{background:var(--warn)} .grade.bad{background:var(--bad)}
.meta{display:flex;gap:10px;flex-wrap:wrap}

.metric{display:flex;align-items:center;gap:10px;margin:9px 0}
.metric .name{flex:0 0 210px;color:#cfe3ee}
.bar{flex:1;height:10px;border-radius:999px;background:#10222c;border:1px solid #22404f;position:relative;overflow:hidden}
.bar>span{position:absolute;left:0;top:0;bottom:0;border-radius:999px}
.okbar{background:linear-gradient(90deg,var(--ok),#2bd897)}
.warnbar{background:linear-gradient(90deg,var(--warn),#ffd479)}
.badbar{background:linear-gradient(90deg,var(--bad),#ff8f8f)}
.pct{width:52px;text-align:right;color:#cfe3ee}

.info{background:rgba(22,36,46,.85);border:1px solid #224355;border-radius:10px;padding:6px 10px;font-size:12px;cursor:pointer}
.kit{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.hidden{display:none}
</style>
</head>
<body data-report-src="/reports/demo/report.json">
  <div id="navMount"></div>
<script src="/nav.js" defer></script>

  <!-- Shared nav (2 lines) -->
  <div id="navMount"></div>
  <script src="/nav.js" defer></script>

  <div class="bg" aria-hidden="true"></div>

  <main class="wrap">
    <div class="header">
      <div>
        <h1>Swing Report — P1–P9</h1>
        <div class="sub">Date: <span id="date"></span> • Mode: <span id="modeLabel">Full Swing</span></div>
      </div>
      <div class="tools">
        <span class="badge">Swings: <span id="swingCount">1</span></span>
        <select id="focus" class="select" title="Focus filter">
          <option value="all" selected>Focus: All</option>
          <optgroup label="Upper Body">
            <option value="right-wrist">Right Wrist</option>
            <option value="left-wrist">Left Wrist</option>
            <option value="arm-bend">Arm Bend</option>
            <option value="shoulder-turn">Shoulder Turn</option>
          </optgroup>
          <optgroup label="Lower Body">
            <option value="hip-movement">Hip Movement</option>
            <option value="knee-movement">Knee Movement</option>
            <option value="foot-movement">Foot / Pressure</option>
          </optgroup>
          <optgroup label="Club">
            <option value="club-path">Club Path</option>
            <option value="face-angle">Face Angle</option>
            <option value="tempo">Timing & Tempo</option>
          </optgroup>
        </select>
        <button id="reload" class="btn" type="button">Reload</button>
        <button id="share" class="btn" type="button">Share</button>
        <button id="pdf" class="btn" type="button">Download PDF</button>
      </div>
    </div>

    <div id="status" class="sub"></div>
    <div id="error" class="sub" style="color:#ff9a9a"></div>

    <!-- P1–P9 FIRST -->
    <section id="phases" class="card">
      <h3 style="display:flex;align-items:center;gap:10px">
        <span>P1–P9</span>
        <button class="info" type="button" data-info="phelp">Info</button>
      </h3>
      <div class="sub" style="padding:0 16px 8px">Click a row to expand.</div>
      <div id="plist" class="content"></div>
    </section>

    <!-- Coaching Card second -->
    <section class="card" style="margin-top:12px">
      <h3>Coaching Card</h3>
      <div class="content">
        <details class="panel" open>
          <summary><span class="pname">Top 3 Priority Fixes</span><svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></summary>
          <div id="coachPriority"></div>
        </details>
        <details class="panel" style="margin-top:10px">
          <summary><span class="pname">Top 3 Power Fixes</span><svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></summary>
          <div id="coachPower"></div>
        </details>
      </div>
    </section>

    <!-- The rest -->
    <section class="grid2" style="margin-top:12px">
      <div class="card">
        <h3>Position Consistency <button class="info" type="button" data-info="pos">Info</button></h3>
        <div id="position" class="content"></div>
      </div>
      <div class="card">
        <h3>Swing Consistency <button class="info" type="button" data-info="swing">Info</button></h3>
        <div id="swing" class="content"></div>
      </div>
    </section>

    <section class="card" style="margin-top:12px">
      <h3>Power Score Summary <button class="info" type="button" data-info="power">Info</button></h3>
      <div id="power" class="content"></div>
    </section>
  </main>

<script>
document.getElementById('date').textContent = new Date().toLocaleDateString();

var infoMap = {
  phelp: "P1–P9 are nine checkpoints from setup to finish. Tap a row for a quick why + how and (if provided) the phase video.",
  pos: "Position Consistency = how reliably you put your body/club into each P-position swing-to-swing.",
  swing: "Swing Consistency = repeatability of motion patterns (arms, face, hip, path, tempo, etc).",
  power: "Power Score blends tempo, sequence, verticals/braking and release timing into one number."
};
document.addEventListener('click',function(e){
  var btn = e.target.closest('.info'); if(!btn) return;
  alert(infoMap[btn.getAttribute('data-info')]||'Info');
});

function pct(v){ return (v||0) + '%' }
function band(v){ return v>=75?'okbar':(v>=55?'warnbar':'badbar') }
function gradeLabel(g){
  var key=(g||'').toLowerCase();
  if(key==='good') return ['good','GOOD'];
  if(key==='ok'||key==='okay') return ['ok','OK'];
  return ['bad','NEEDS HELP'];
}

function metricRow(m){
  return '<div class="metric" data-tags="'+(m.tags||[]).join(' ')+'">'
    +'<div class="name">'+m.label+'</div>'
    +'<div class="bar"><span class="'+band(m.value)+'" style="width:'+m.value+'%"></span></div>'
    +'<div class="pct">'+pct(m.value)+'</div></div>';
}
function posRow(p){
  return '<div class="metric">'
    +'<div class="name">'+p.p+'</div>'
    +'<div class="bar"><span class="'+band(p.value)+'" style="width:'+p.value+'%"></span></div>'
    +'<div class="pct">'+pct(p.value)+'</div></div>';
}

function renderCoaching(data){
  var pri = (data.coaching&&data.coaching.priority_fixes)||[];
  var pow = (data.coaching&&data.coaching.power_fixes)||[];
  var mk = function(item){
    return '<details class="panel"><summary><span class="pname">'
      +item.title+'</span><svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></summary>'
      +'<div class="content"><div class="sub" style="margin-bottom:8px">'+(item.short||'')+'</div>'
      +'<div>'+(item.long||'')+'</div>'
      +'<div class="kit"><button class="btn" type="button" onclick="alert(\'Ask your coach for a demo of this fix on your swing.\')">Add metrics</button><button class="btn" type="button" onclick="alert(\'Reference video opening…\')">Reference video</button></div>'
      +'</div></details>';
  };
  document.getElementById('coachPriority').innerHTML = pri.map(mk).join('') || '<div class="sub">No priority fixes.</div>';
  document.getElementById('coachPower').innerHTML   = pow.map(mk).join('') || '<div class="sub">No power fixes.</div>';
}

function renderPhases(data){
  var phases = Array.isArray(data.phases)?data.phases.slice():[];
  if(!phases.length){
    var names = ['Setup','Shaft Parallel (Backswing)','Lead Arm Parallel (Backswing)','Top of Swing','Lead Arm Parallel (Downswing)','Shaft Parallel (Downswing)','Impact','Trail Arm Parallel (Follow-Through)','Finish'];
    var pm = data.position_metrics||[];
    for(var i=0;i<9;i++){
      var pid='P'+(i+1);
      var m=pm.find(function(x){return String(x.p).toUpperCase()===pid})||{value:0};
      var g = m.value>=75?'good':(m.value>=55?'ok':'bad');
      phases.push({id:pid,name:names[i],short:'',long:'',grade:g});
    }
  }
  var html = phases.map(function(ph,i){
    var parts = gradeLabel(ph.grade);
    var gclass = parts[0], glabel = parts[1];
    return '<details class="panel" '+(i===0?'open':'')+'>'
      +'<summary>'
      +'<span class="pnum">'+(ph.id||('P'+(i+1)))+'</span>'
      +'<span class="pname">'+(ph.name||'')+'</span>'
      +'<span class="grade '+gclass+'">'+glabel+'</span>'
      +'<span class="sub" style="margin-left:8px">'+(ph.short||'')+'</span>'
      +'<svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>'
      +'</summary>'
      +'<div class="content"><div class="sub" style="margin-bottom:8px">'+(ph.short||'')+'</div>'
      +'<div style="margin-bottom:10px">'+(ph.long||'')+'</div>'
      +'<div class="kit"><button class="btn" type="button" onclick="alert(\'P-phase metrics coming soon.\')">Add metrics</button><button class="btn" type="button" onclick="alert(\'Phase video placeholder.\')">View Video</button></div>'
      +'</div></details>';
  }).join('');
  document.getElementById('plist').innerHTML = html;
}

function renderReport(data){
  if(data.discipline){ document.getElementById('modeLabel').textContent = /putt/i.test(data.discipline)?'Putting':/chip/i.test(data.discipline)?'Chipping':'Full Swing'; }
  if(data.swings!=null){ document.getElementById('swingCount').textContent = String(data.swings); }

  document.getElementById('swing').innerHTML    = (data.swing_metrics||[]).map(metricRow).join('') || '<div class="sub">No swing metrics.</div>';
  document.getElementById('position').innerHTML = (data.position_metrics||[]).map(posRow).join('')   || '<div class="sub">No position metrics.</div>';

  var p = data.power||{score:0,tempo:'—',release_timing:0};
  document.getElementById('power').innerHTML =
    '<div class="metric"><div class="name">Power Score</div><div class="bar"><span class="'+band(p.score)+'" style="width:'+p.score+'%"></span></div><div class="pct">'+pct(p.score)+'</div></div>'
   +'<div class="metric"><div class="name">Tempo</div><div class="bar"><span class="okbar" style="width:76%"></span></div><div class="pct">'+(p.tempo||'—')+'</div></div>'
   +'<div class="metric"><div class="name">Release Timing</div><div class="bar"><span class="'+band(+p.release_timing)+'" style="width:'+(+p.release_timing||0)+'%"></span></div><div class="pct">'+(+p.release_timing||0)+'%</div></div>';

  renderPhases(data);
  renderCoaching(data);
}

function cleanJSON(text){
  // BOM + trim only (kept simple to avoid paste issues)
  return (text||'').replace(/^\uFEFF/,'').trim();
}

async function loadReport(url){
  var s=document.getElementById('status'), e=document.getElementById('error');
  e.textContent=''; s.textContent='Loading '+url+' …';
  try{
    var res = await fetch(url,{cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    var raw = await res.text();
    var data = JSON.parse(cleanJSON(raw));
    renderReport(data);
    s.textContent='Loaded: '+url;
  }catch(err){
    e.textContent='Failed to load report: '+(err.message||String(err));
  }
}

// Buttons
document.getElementById('reload').onclick = function(){
  var u = new URLSearchParams(location.search).get('report') || document.body.dataset.reportSrc || '/reports/demo/report.json';
  loadReport(u);
};
document.getElementById('pdf').onclick = function(){ window.print() };
document.getElementById('share').onclick = function(){
  var link = location.href;
  if(navigator.share){ navigator.share({title:'Virtual Coach AI Report',url:link}).catch(()=>{}); }
  else{ navigator.clipboard&&navigator.clipboard.writeText(link); alert('Link copied'); }
};

// Focus filter dims non-matching metrics
document.getElementById('focus').addEventListener('change',function(e){
  var val=e.target.value;
  document.querySelectorAll('.metric').forEach(function(el){
    el.style.opacity = (val==='all' || (el.getAttribute('data-tags')||'').split(' ').includes(val)) ? 1 : .35;
  });
});

// Auto load
(function(){
  var auto = new URLSearchParams(location.search).get('report') || document.body.dataset.reportSrc || '/reports/demo/report.json';
  loadReport(auto);
})();
</script>
</body>
</html>
