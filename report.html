<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Virtual Coach AI — Swing Report</title>
  <style>
    :root{
      --bg:#0e1a22;           /* deep navy */
      --panel:#16242e;        /* card background */
      --muted:#8aa5b5;        /* secondary text */
      --text:#ecf3f7;         /* primary text */
      --accent:#5eb3ff;       /* blue accent */
      --ok:#19c37d;           /* green */
      --warn:#f6c453;         /* yellow */
      --bad:#ff6b6b;          /* red */
      --chip:#1d2f3b;         /* chip bg */
      --radius:16px;
      --shadow:0 8px 24px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;color:var(--text);font:16px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif;background:linear-gradient(180deg,rgba(10,18,24,.65),rgba(10,18,24,.65)), url('https://images.unsplash.com/photo-1518593923141-142d9f4d13e7?q=80&w=1920&auto=format&fit=crop') center/cover fixed}
    a{color:var(--accent)}
    .container{max-width:1080px;margin:32px auto;padding:0 16px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:20px}
    .title{font-size:28px;font-weight:750;letter-spacing:.3px}
    .subtitle{color:var(--muted);font-size:14px}

    .toolbar{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
    .select, .btn{background:var(--panel);border:1px solid #223743;border-radius:12px;color:var(--text);padding:10px 12px;box-shadow:var(--shadow)}
    .select{appearance:none;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');background-repeat:no-repeat;background-position:right 10px center;padding-right:36px}
    .badge{background:var(--chip);border:1px solid #263b48;color:var(--muted);padding:6px 10px;border-radius:999px;font-size:12px}

    .grid{display:grid;grid-template-columns:1fr;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}

    .card{background:rgba(22,36,46,.86);border:1px solid #223743;border-radius:var(--radius);box-shadow:var(--shadow)}
    .card h3{margin:0;padding:16px 18px;border-bottom:1px solid #1f3340;font-weight:700}
    .card .content{padding:14px 18px}

    details.panel{background:rgba(22,36,46,.86);border:1px solid #223743;border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    details.panel+details.panel{margin-top:12px}
    summary{list-style:none;cursor:pointer;display:flex;align-items:center;gap:12px;padding:16px 18px}
    summary::-webkit-details-marker{display:none}
    .tag{font-size:12px;color:var(--muted);padding:4px 8px;border-radius:8px;border:1px solid #27404f;background:var(--chip)}
    .pnum{width:36px;height:36px;border-radius:10px;background:#0c1820;display:grid;place-items:center;font-weight:800;border:1px solid #223743}
    .pname{font-weight:700}
    .caret{margin-left:auto;transition:transform .2s ease}
    details[open] .caret{transform:rotate(180deg)}

    .row{display:flex;flex-wrap:wrap;gap:16px}
    .col{flex:1 1 260px}
    .media{aspect-ratio:16/9;background:#0b151b;border:1px dashed #29424f;border-radius:12px;display:grid;place-items:center;color:var(--muted)}

    /* metric list */
    .metric{display:flex;align-items:center;gap:10px;margin:10px 0}
    .metric .name{flex:0 0 210px;color:#cfe3ee}
    .bar{flex:1;height:10px;border-radius:999px;background:#10222c;position:relative;border:1px solid #22404f;overflow:hidden}
    .bar>span{position:absolute;left:0;top:0;bottom:0;border-radius:999px}
    .pct{width:52px;text-align:right;color:#cfe3ee}
    .ok{background:linear-gradient(90deg,var(--ok),#2bd897)}
    .warn{background:linear-gradient(90deg,var(--warn),#ffd479)}
    .bad{background:linear-gradient(90deg,var(--bad),#ff8f8f)}

    /* highlight for focus filter */
    .focus-dim{opacity:.35;filter:saturate(.5)}

    .footnote{color:var(--muted);font-size:12px;margin-top:6px}

    .chips{display:flex;flex-wrap:wrap;gap:8px}
    /* --- Progress UI --- */
    .overlay{position:fixed;inset:0;background:rgba(8,16,22,.72);backdrop-filter:saturate(120%) blur(2px);display:grid;place-items:center;z-index:9999}
    .overlay-card{width:min(720px,92vw);background:var(--panel);border:1px solid #224355;border-radius:18px;box-shadow:var(--shadow);padding:22px}
    .overlay h2{margin:0 0 8px 0;font-size:22px}
    .overlay .sub{color:var(--muted);margin-bottom:14px}
    .progress{height:14px;border-radius:999px;background:#0f2230;border:1px solid #22404f;overflow:hidden;position:relative}
    .progress>span{position:absolute;left:0;top:0;bottom:0;width:0%}
    .progress>span.ok{background:linear-gradient(90deg,#4aa3ff,#19c37d)}
    .status-list{margin:14px 0 0 0;padding:0;list-style:none;display:grid;gap:8px}
    .status-item{display:flex;align-items:center;gap:10px;color:#cfe3ee}
    .status-item .dot{width:10px;height:10px;border-radius:50%;background:#2a3f4d;border:1px solid #3a5566}
    .status-item.active .dot{background:#4aa3ff;border-color:#4aa3ff}
    .status-item.done .dot{background:#19c37d;border-color:#19c37d}
    .eta{color:var(--muted);font-size:12px}
      /* P1–P9 summary table */
    .pgrid{width:100%;border-collapse:collapse}
    .pgrid th,.pgrid td{border-bottom:1px solid #1f3340;padding:8px 10px;text-align:left}
    .pgrid th{color:#cfe3ee;font-weight:700}
    .grade{font-weight:700}
    .grade.good{color:var(--ok)}
    .grade.ok{color:var(--warn)}
    .grade.bad{color:var(--bad)}
    .phase-nav{display:grid;grid-template-columns:repeat(9,1fr);gap:8px;margin:8px 0 4px}
  .phase-tab{background:rgba(22,36,46,.9);border:1px solid #223743;border-radius:12px;padding:10px 12px;box-shadow:var(--shadow);cursor:pointer;display:flex;gap:8px;align-items:center}
  .phase-tab .n{font-weight:800;width:32px;height:32px;border-radius:10px;display:grid;place-items:center;background:#0c1820;border:1px solid #223743}
  .phase-tab .t{font-size:12px;color:var(--muted)}
  .phase-tab.active{outline:2px solid var(--accent)}
  #powerTop{display:none}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <div class="title">Swing Report — P1–P9</div>
        <div class="subtitle">Club: 7‑iron • Date: <span id="date"></span> • View: Human</div>
      </div>
      <div class="toolbar">
        <label class="badge">Swings: <span id="swingCount">2</span></label>
        <select id="focus" class="select" title="Focus on a specific component">
          <option value="all">Focus: All components</option>
          <optgroup label="Upper Body">
            <option value="right-wrist">Right Wrist</option>
            <option value="left-wrist">Left Wrist</option>
            <option value="arm-bend">Arm Bend</option>
            <option value="hand-path">Hand Path</option>
            <option value="shoulder-turn">Shoulder Turn</option>
          </optgroup>
          <optgroup label="Lower Body">
            <option value="hip-movement">Hip Movement</option>
            <option value="knee-movement">Knee Movement</option>
            <option value="foot-movement">Foot / Pressure</option>
            <option value="lead-leg-brake">Lead Leg Braking</option>
          </optgroup>
          <optgroup label="Club">
            <option value="club-path">Club Path</option>
            <option value="face-angle">Club Face Angle</option>
            <option value="tempo">Timing & Tempo</option>
          </optgroup>
        </select>
        <button id="expandAll" class="btn" type="button">Expand All</button>
        <button id="collapseAll" class="btn" type="button">Collapse All</button>
        <button id="analyzeBtn" class="btn" type="button">Analyze Video<\/button>
        <label class="badge"><input id="proToggle" type="checkbox" style="vertical-align:middle;margin-right:6px"> Pro Overlay: Hogan</label>
      </div>
    </header>

    <!-- Phase Navigation Row -->
    <section class="card" aria-label="Phase Navigation">
      <div id="phaseNav" class="phase-nav"></div>
    </section>

    <!-- Progress Overlay -->
    <div id=\"progressOverlay\" class=\"overlay\" hidden>
      <div class=\"overlay-card\">
        <h2>Analyzing your swing…</h2>
        <div class=\"sub\" id=\"progressSub\">Preparing</div>
        <div class=\"progress\"><span id=\"progressFill\" class=\"ok\"></span></div>
        <ul class=\"status-list\" id=\"statusList\"></ul>
        <div class=\"eta\" id=\"eta\"></div>
      </div>
    </div>

    <section class="grid" aria-label="Top Summary">
      <div class="card">
        <h3>Swing Consistency</h3>
        <div class="content" id="swingConsistency"></div>
      </div>
      <div class="card">
        <h3>Position Consistency</h3>
        <div class="content" id="positionConsistency"></div>
      </div>
    </section>

    <section id="powerTop" class="grid" aria-label="Power Summary" style="margin-top:16px">
      <div class="card">
        <h3>Power Score Summary</h3>
        <div class="content">
          <div class="metric"><div class="name">Power Score</div><div class="bar"><span class="ok" style="width:82%"></span></div><div class="pct">82%</div></div>
          <div class="metric"><div class="name">Tempo</div><div class="bar"><span class="ok" style="width:76%"></span></div><div class="pct">3.2:1</div></div>
          <div class="metric"><div class="name">Release Timing</div><div class="bar"><span class="warn" style="width:64%"></span></div><div class="pct">On-time</div></div>
          <div class="footnote">Placeholder — wire to engine.</div>
        </div>
      </div>
    </section>

    <section class="grid" aria-label="Full Monty Extras" style="margin-top:16px">
      <div class="card">
        <h3 style="display:none">P1–P9 Table</h3>
        <details class="panel"><summary><div class="pname">P1–P9 Table (Summary)</div><svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></summary>
        <div class="content">
          <table class="pgrid" role="table">
            <thead>
              <tr>
                <th>Checkpoint</th>
                <th>Position Name</th>
                <th>Description (Short)</th>
                <th>Description (Long)</th>
                <th>Grade</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>P1</td>
                <td>Setup</td>
                <td>Athletic stance, posture aligned</td>
                <td>Neutral spine with balanced pressure (~55/45 trail→lead), relaxed arms, square clubface, eyes level, and a stable base to load from.</td>
                <td class="grade good">🟢 Good</td>
              </tr>
              <tr>
                <td>P2</td>
                <td>Shaft Parallel (Backswing)</td>
                <td>Club parallel, early width</td>
                <td>Shaft parallel to ground and on plane; hands move in with width, minimal wrist set, pelvis begins loading without lateral sway.</td>
                <td class="grade ok">🟡 Okay</td>
              </tr>
              <tr>
                <td>P3</td>
                <td>Lead Arm Parallel (Backswing)</td>
                <td>Good extension, slight flat</td>
                <td>Lead arm parallel; trail elbow under the shaft; lead wrist near flat to slightly flexed; torso keeps turning while lower body stays braced.</td>
                <td class="grade ok">🟡 Okay</td>
              </tr>
              <tr>
                <td>P4</td>
                <td>Top of Swing</td>
                <td>Full coil, face a touch open</td>
                <td>Complete coil with depth; lead shoulder under chin; trail knee retains some flex; if face is open, reduce trail wrist extension or add lead wrist flex.</td>
                <td class="grade bad">🔴 Needs Work</td>
              </tr>
              <tr>
                <td>P5</td>
                <td>Lead Arm Parallel (Downswing)</td>
                <td>Arm drops inside, solid wrist</td>
                <td>Arm shallows as pelvis opens; lead wrist flexes to stabilize face; hands in front of trail thigh; pressure shifting forward decisively.</td>
                <td class="grade good">🟢 Good</td>
              </tr>
              <tr>
                <td>P6</td>
                <td>Shaft Parallel (Downswing)</td>
                <td>Shallowing, trail elbow leads</td>
                <td>Shaft parallel with the hands ahead; lead hip clearing; trail elbow in front of ribcage; face-to-path relationship managed (no early roll).</td>
                <td class="grade good">🟢 Good</td>
              </tr>
              <tr>
                <td>P7</td>
                <td>Impact</td>
                <td>Hips open, shaft lean</td>
                <td>Lead side braced with handle forward; dynamic loft and low‑point ahead; chest slightly open; pressure ~80–90% lead foot for compression.</td>
                <td class="grade ok">🟡 Okay</td>
              </tr>
              <tr>
                <td>P8</td>
                <td>Trail Arm Parallel (Follow‑Through)</td>
                <td>Balanced extension</td>
                <td>Arms extend through; wrists unhinge gradually; face stays stable post‑impact; rotation continues without stalling.</td>
                <td class="grade good">🟢 Good</td>
              </tr>
              <tr>
                <td>P9</td>
                <td>Finish</td>
                <td>Upright, balanced</td>
                <td>Full balance on lead side; belt buckle at target; spine tall; club wraps around naturally with no excess tension.</td>
                <td class="grade good">🟢 Good</td>
              </tr>
            </tbody>
          </table>
        </div>
        </details>
      </div>
      <div class="card">
        <h3 style="display:none">Power & Efficiency</h3>
        <details class="panel"><summary><div class="pname">Power & Efficiency</div><svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></summary>
        <div class="content">
          <div class="metric"><div class="name">Power Efficiency Score</div><div class="bar"><span class="ok" style="width:82%"></span></div><div class="pct">82%</div></div>
          <div class="metric"><div class="name">Kinematic Flow</div><div class="bar"><span class="warn" style="width:68%"></span></div><div class="pct">68%</div></div>
          <div class="footnote">Placeholder values — will fill from your analysis engine.</div>
        </div>
        </details>
      </div>
    </section>

    <details class="panel" aria-label="Coaching Card">
      <summary>
        <div class="pname">Coaching Card — Top 3 Priority Fixes</div>
        <span class="tag">Tap to expand</span>
        <svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
      </summary>
      <div class="content">
        <details class="panel"><summary>1) Trail wrist set earlier (P3→P4)</summary><div class="content">Firm up extension to control face. <em>Drill:</em> toe-up checkpoints, flat lead wrist to P4.</div></details>
        <details class="panel"><summary>2) Lead leg brake sooner (P5→P6)</summary><div class="content">Stop the slide, pop the rotation. <em>Drill:</em> stick-at-hip, step-change of direction.</div></details>
        <details class="panel"><summary>3) Face control at P6–P7</summary><div class="content">Match path/face to tighten start line. <em>Drill:</em> quarter-release punch to 9 o'clock.</div></details>
      </div>
    </details>

    <details class="panel" aria-label="Power Fixes">
      <summary>
        <div class="pname">Top 3 Power Fixes</div>
        <span class="tag">Tap to expand</span>
        <svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
      </summary>
      <div class="content">
        <details class="panel"><summary>1) Lead‑leg brake timing (P5→P6)</summary><div class="content">Convert linear shift into rotational speed. <em>Cue:</em> stomp → post → turn.</div></details>
        <details class="panel"><summary>2) Sequence: pelvis → torso → arm → club</summary><div class="content">Clean kinematic handoff so peak speed is post‑impact. <em>Drill:</em> step‑sequence swings.</div></details>
        <details class="panel"><summary>3) Pressure shift map (→ P7)</summary><div class="content">Arrive ~80–90% lead foot by impact; kill hang‑back. <em>Drill:</em> pump swings with pressure cue.</div></details>
      </div>
    </details>

    <section style="margin-top:22px">
      <div class="chips footnote">Tip: Click a P‑section to expand. Use the Focus filter to highlight only the components you care about. Video is a placeholder — your real clip drops in via the uploader.</div>

      <div id="pList"></div>
    </section>

    <!-- Power Summary moved under P1–P9 -->
    <section class="grid" aria-label="Power Summary (Bottom)" style="margin-top:16px">
      <div class="card">
        <h3>Power Score Summary</h3>
        <div class="content">
          <div class="metric"><div class="name">Power Score</div><div class="bar"><span class="ok" style="width:82%"></span></div><div class="pct">82%</div></div>
          <div class="metric"><div class="name">Tempo</div><div class="bar"><span class="ok" style="width:76%"></span></div><div class="pct">3.2:1</div></div>
          <div class="metric"><div class="name">Release Timing</div><div class="bar"><span class="warn" style="width:64%"></span></div><div class="pct">On-time</div></div>
          <div class="footnote">Placeholder — wire to engine.</div>
        </div>
      </div>
    </section>
  </div>

  <script>
    // ------------ Mock data (replace with real analytics payload) ------------
    const swingMetrics = [
      { key:'right-arm-angle', label:'Right Arm Angle', value:85, tags:['arm-bend'] },
      { key:'face-angle',      label:'Club Face Angle', value:83, tags:['face-angle'] },
      { key:'shoulder-turn',   label:'Shoulder Turn',   value:77, tags:['shoulder-turn'] },
      { key:'pelvis-turn',     label:'Pelvis Turn',     value:71, tags:['hip-movement'] },
      { key:'hand-path',       label:'Hand Path',       value:70, tags:['hand-path'] },
      { key:'club-path',       label:'Club Path',       value:67, tags:['club-path'] },
      { key:'pressure-shift',  label:'Pressure Shift',  value:54, tags:['foot-movement'] },
      { key:'hip-sway',        label:'Hip Sway',        value:50, tags:['hip-movement'] },
      { key:'lead-leg-brake',  label:'Lead Leg Braking',value:44, tags:['lead-leg-brake'] }
    ];

    const positionMetrics = [
      {p:'P1', value:89}, {p:'P2', value:72}, {p:'P3', value:53}, {p:'P4', value:61},
      {p:'P5', value:55}, {p:'P6', value:59}, {p:'P7', value:77}, {p:'P8', value:85}, {p:'P9', value:73}
    ];

    const phases = [
      { id:'P1', name:'Setup', tags:['hand-path','arm-bend','right-wrist','left-wrist','foot-movement'] },
      { id:'P2', name:'Shaft Parallel (Backswing)', tags:['hand-path','shoulder-turn','hip-movement','knee-movement'] },
      { id:'P3', name:'Lead Arm Parallel (Backswing)', tags:['arm-bend','shoulder-turn','hip-movement'] },
      { id:'P4', name:'Top of Swing', tags:['shoulder-turn','hip-movement','right-wrist','left-wrist'] },
      { id:'P5', name:'Lead Arm Parallel (Downswing)', tags:['club-path','face-angle','lead-leg-brake'] },
      { id:'P6', name:'Shaft Parallel (Downswing)', tags:['club-path','face-angle','lead-leg-brake','knee-movement'] },
      { id:'P7', name:'Impact', tags:['club-path','face-angle','lead-leg-brake','foot-movement'] },
      { id:'P8', name:'Trail Arm Parallel (Follow‑Through)', tags:['arm-bend','hand-path','tempo'] },
      { id:'P9', name:'Finish', tags:['balance','tempo','arm-bend'] }
    ];

    // ------------ Helpers ------------
    const fmt = v => `${v}%`;
    const band = v => v>=75? 'ok' : v>=55? 'warn' : 'bad';

    function metricRow(m){
      const cls = band(m.value);
      return `<div class="metric" data-tags="${(m.tags||[]).join(' ')}">
        <div class="name">${m.label}</div>
        <div class="bar"><span class="${cls}" style="width:${m.value}%"></span></div>
        <div class="pct">${fmt(m.value)}</div>
      </div>`;
    }

    function posRow(p){
      const cls = band(p.value);
      return `<div class="metric"><div class="name">${p.p}</div>
        <div class="bar"><span class="${cls}" style="width:${p.value}%"></span></div>
        <div class="pct">${fmt(p.value)}</div>
      </div>`;
    }

    function renderTop(){
      document.getElementById('swingConsistency').innerHTML = swingMetrics.map(metricRow).join('');
      document.getElementById('positionConsistency').innerHTML = positionMetrics.map(posRow).join('');
    }

    function renderPhases(){
      const wrapper = document.getElementById('pList');
      wrapper.innerHTML = phases.map((ph,i)=>{
        return `<details class="panel" data-phase="${ph.id}" ${i===0?'open':''}>
          <summary>
            <div class="pnum">${ph.id}</div>
            <div class="pname">${ph.name}</div>
            <span class="tag">Checkpoint ${i+1}/9</span>
            <svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
          </summary>
          <div class="content">
            <div class="row">
              <div class="col">
                <div class="media" id="video-${ph.id}">Video ${ph.id}<br><span class="footnote">(drop-in container)</span></div>
                <div class="media pro" id="pro-${ph.id}" hidden>Hogan Overlay ${ph.id}<br><span class="footnote">(toggle via Pro Overlay switch)</span></div>
                <div class="footnote">Coaching Notes: replace with AI output.</div>
              </div>
              <div class="col">
                <div class="chips" aria-label="Key focus areas">
                  ${(ph.tags||[]).map(t=>`<span class="badge">${t.replace(/-/g,' ')}</span>`).join('')}
                </div>
                <div style="margin-top:10px">
                  ${[
                    {label:'Right Wrist Angle', value: 72, tags:['right-wrist']},
                    {label:'Left Wrist Angle',  value: 69, tags:['left-wrist']},
                    {label:'Arm Bend',         value: 81, tags:['arm-bend']},
                    {label:'Hip Movement',     value: 64, tags:['hip-movement']},
                    {label:'Knee Movement',    value: 58, tags:['knee-movement']},
                    {label:'Foot Pressure',    value: 71, tags:['foot-movement']},
                    {label:'Club Path',        value: 66, tags:['club-path']}
                  ].map(metricRow).join('')}
                </div>
              </div>
            </div>
          </div>
        </details>`;
      }).join('');
    }

    function renderPhaseNav(){
      const nav = document.getElementById('phaseNav');
      nav.innerHTML = phases.map(p=>`<button class='phase-tab' data-target='${p.id}'>
        <span class='n'>${p.id}</span>
        <div>
          <div>${p.name}</div>
          <div class='t'>Tap to open</div>
        </div>
      </button>`).join('');
      nav.addEventListener('click', (e)=>{
        const btn = e.target.closest('.phase-tab');
        if(!btn) return;
        openPhase(btn.getAttribute('data-target'));
      });
    }

    function openPhase(id){
      document.querySelectorAll('.phase-tab').forEach(b=>b.classList.toggle('active', b.getAttribute('data-target')===id));
      const det = document.querySelector(`details[data-phase='${id}']`);
      if(!det) return;
      document.querySelectorAll('details.panel').forEach(d=>d.open=false);
      det.open = true;
      det.scrollIntoView({behavior:'smooth', block:'start'});
    }

    function applyFocus(value){
      const blocks = document.querySelectorAll('.metric');
      blocks.forEach(el=>{
        el.classList.remove('focus-dim');
        if(value==='all') return;
        const tags = (el.getAttribute('data-tags')||'').split(' ');
        if(!tags.includes(value)) el.classList.add('focus-dim');
      });
    }

    // ------------ Init ------------
    document.getElementById('date').textContent = new Date().toLocaleDateString();
    renderTop();
    renderPhases();
    renderPhaseNav();
    applyFocus('all');

    // Focus filter
    document.getElementById('focus')?.addEventListener('change', e=>applyFocus(e.target.value));

    // Expand/Collapse controls
    const expandAllBtn = document.getElementById('expandAll');
    const collapseAllBtn = document.getElementById('collapseAll');
    expandAllBtn?.addEventListener('click',()=>{
      document.querySelectorAll('details.panel').forEach(d=>d.open=true);
    });
    collapseAllBtn?.addEventListener('click',()=>{
      document.querySelectorAll('details.panel').forEach(d=>d.open=false);
    });

    // Pro overlay toggle
    const proToggle = document.getElementById('proToggle');
    proToggle?.addEventListener('change', (e)=>{
      const show = e.target.checked;
      document.querySelectorAll('.media.pro').forEach(el=> el.hidden = !show);
    });

    // Placeholder: insert real video element per phase here
    // Example hook: replace #video-P1 with <video src="yourfile.mp4" controls></video>
    // document.getElementById('video-P1').replaceWith(Object.assign(document.createElement('video'),{src:'swing.mp4',controls:true,style:'width:100%;border-radius:12px;border:1px solid #223743'}));
      
    // ---------- Progress / Meter logic ----------
    const steps = [
      {key:'upload', label:'Uploading video'},
      {key:'extract', label:'Extracting frames (P1–P9)'},
      {key:'pose', label:'Pose estimation'},
      {key:'analyze', label:'Biomechanics + club math'},
      {key:'report', label:'Building reports & thumbnails'}
    ];

    const Overlay = {
      root: document.getElementById('progressOverlay'),
      fill: document.getElementById('progressFill'),
      sub:  document.getElementById('progressSub'),
      eta:  document.getElementById('eta'),
      list: document.getElementById('statusList'),
      percent: 0,
      timer: null,
      start(){
        this.root.hidden = false;
        this.percent = 0;
        this.renderList();
        this.tick('Uploading video…');
      },
      set(p, sub){
        this.percent = Math.max(0, Math.min(100, p));
        this.fill.style.width = this.percent + '%';
        if(sub) this.sub.textContent = sub;
      },
      complete(){
        this.set(100, 'Done');
        setTimeout(()=>{ this.root.hidden = true; }, 450);
      },
      renderList(activeIndex=0){
        this.list.innerHTML = steps.map((s,i)=>`<li class='status-item ${i<activeIndex?"done":i===activeIndex?"active":""}'>
          <span class='dot'></span><span>${s.label}</span></li>`).join('');
      },
      tick(sub){ this.sub.textContent = sub || this.sub.textContent; }
    };

    // Demo/Hook: simulate analysis with realistic stages
    function simulateAnalysis(){
      Overlay.start();
      let i = 0;
      const stageDur = [800, 1200, 1400, 1200, 900]; // ms per step (tweak as needed)
      const stagePct = [15, 40, 70, 88, 100];
      function run(){
        if(i>=steps.length){ Overlay.complete(); return; }
        Overlay.renderList(i);
        const label = steps[i].label + '…';
        const startPct = i===0?0:stagePct[i-1];
        const endPct = stagePct[i];
        const start = performance.now();
        const dur = stageDur[i];
        (function loop(now){
          const t = Math.min(1, (now - start)/dur);
          const pct = Math.round(startPct + (endPct-startPct)*t);
          Overlay.set(pct, label);
          if(t<1){ requestAnimationFrame(loop); } else { i++; setTimeout(run, 120); }
        })(start);
      }
      run();
    }

    // Public hook: call window.AnalysisProgress.start() from your uploader once the file is received
    window.AnalysisProgress = { start: simulateAnalysis, set: (p,msg)=>Overlay.set(p,msg), done: ()=>Overlay.complete() }

    // Wire demo button
    document.getElementById('analyzeBtn').addEventListener('click', simulateAnalysis);

  </script>
</body>
</html>
