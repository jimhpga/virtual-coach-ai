<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Virtual Coach AI — Swing Report</title>
<style>
:root{
  --bg:#0e1a22; --panel:#16242e; --muted:#8aa5b5; --text:#ecf3f7; --accent:#5eb3ff;
  --ok:#19c37d; --warn:#f6c453; --bad:#ff6b6b; --chip:#1d2f3b; --radius:16px;
  --shadow:0 8px 24px rgba(0,0,0,.35); --bgimg-opacity:.12;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0;color:var(--text);font:16px/1.45 system-ui, -apple-system, Segoe UI, Inter, Roboto, Helvetica, Arial, sans-serif;background:#0e1a22}

/* full-bleed golf course background */
.bg{position:fixed;inset:0;background:url('/homepage-background.png') center/cover no-repeat fixed;opacity:var(--bgimg-opacity);z-index:-1}
.bg::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(10,18,24,.02),rgba(10,18,24,.02))}

/* top nav */
.topbar{position:sticky;top:0;z-index:1000;background:rgba(255,255,255,.78);backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid #d8eaf6}
.topbar .inner{max-width:1100px;margin:0 auto;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 16px}
.topbar .brand{display:flex;align-items:center;gap:10px;color:#0f2330;font-weight:800;letter-spacing:.2px;text-decoration:none}
.topbar .brand img{height:28px;width:auto}
.topbar .nav{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
.topbar .nav a{display:inline-block;padding:8px 10px;border-radius:10px;color:#0c2433;text-decoration:none;border:1px solid transparent}
.topbar .nav a:hover{background:#fff;border-color:#d3e3ee}
.topbar .nav a.active{background:#0f66a9;color:#fff;border-color:#0f66a9}

/* layout */
.wrap{max-width:1080px;margin:24px auto;padding:0 16px}
header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin:8px 0 16px}
.title{font-size:26px;font-weight:800;letter-spacing:.2px}
.sub{color:var(--muted);font-size:13px}

.toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.btn,.select{background:rgba(22,36,46,.9);border:1px solid #223743;border-radius:12px;color:var(--text);padding:8px 12px;box-shadow:var(--shadow);cursor:pointer}
.select{appearance:none;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>');background-repeat:no-repeat;background-position:right 10px center;padding-right:36px}
.badge{background:var(--chip);border:1px solid #263b48;color:#cfe3ee;padding:6px 10px;border-radius:999px;font-size:12px}

/* cards */
.card,details.panel{background:rgba(22,36,46,.82);border:1px solid #223743;border-radius:var(--radius);box-shadow:var(--shadow)}
.card h3{margin:0;padding:14px 16px;border-bottom:1px solid #1f3340}
.card .content{padding:12px 16px}
.grid{display:grid;grid-template-columns:1fr;gap:14px}
@media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}

summary{list-style:none;display:flex;gap:10px;align-items:center;padding:14px 16px;cursor:pointer}
summary::-webkit-details-marker{display:none}
.pnum{width:34px;height:34px;border-radius:10px;background:#0c1820;border:1px solid #223743;display:grid;place-items:center;font-weight:800}
.pname{font-weight:700}
.caret{margin-left:auto;transition:transform .2s ease}
details[open] .caret{transform:rotate(180deg)}

/* grade chips */
.gchip{font-size:12px;font-weight:800;padding:3px 8px;border-radius:8px;border:1px solid #27404f;background:var(--chip)}
.g-good{background:#1f7a46;color:#fff;border-color:#1f7a46}
.g-ok{background:#c28b00;color:#fff;border-color:#c28b00}
.g-bad{background:#b13333;color:#fff;border-color:#b13333}

/* metric rows */
.metric{display:flex;align-items:center;gap:10px;margin:9px 0}
.metric .name{flex:0 0 260px;color:#cfe3ee;display:flex;align-items:center;gap:8px;flex-wrap:wrap}
.bar{flex:1;height:10px;border-radius:999px;background:#10222c;border:1px solid #22404f;position:relative;overflow:hidden}
.bar>span{position:absolute;left:0;top:0;bottom:0;border-radius:999px}
.ok{background:linear-gradient(90deg,var(--ok),#2bd897)}
.warn{background:linear-gradient(90deg,var(--warn),#ffd479)}
.bad{background:linear-gradient(90deg,var(--bad),#ff8f8f)}
.pct{width:52px;text-align:right;color:#cfe3ee}
.focus-dim{opacity:.35;filter:saturate(.5)}

.info-btn{margin-left:8px;font-size:12px;line-height:1;background:rgba(255,255,255,.85);border:1px solid #d3e3ee;border-radius:999px;padding:4px 8px;cursor:pointer;color:#0b2230}
.info-btn:hover{background:#fff}
.info-callout{margin-top:10px;background:rgba(255,255,255,.7);border:1px solid #d8eaf6;border-radius:12px;padding:10px;color:#0c2433}

/* reference video */
.video-btn{margin-left:8px;font-size:12px;line-height:1;background:rgba(255,255,255,.9);border:1px solid #d3e3ee;border-radius:999px;padding:4px 8px;cursor:pointer;color:#0b2230}
.video-btn:hover{background:#fff}
.video-btn::before{content:"▶";display:inline-block;margin-right:6px;font-size:11px}

/* busy pill */
.busy{position:fixed;top:12px;right:12px;background:var(--panel);border:1px solid #224355;border-radius:999px;padding:8px 12px;display:flex;gap:8px;align-items:center;box-shadow:var(--shadow);z-index:10000}
.busy[hidden]{display:none!important}
.spinner{width:18px;height:18px;border:3px solid #2a3f4d;border-top-color:#5eb3ff;border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
#debug{display:none!important}
</style>
</head>

<body data-report-src="/reports/demo/report.json">
  <div class="bg" aria-hidden="true"></div>
  <nav class="topbar" role="navigation" aria-label="Main">
    <div class="inner">
      <a class="brand" href="/"><img src="/virtualcoach-logo-transparent.png" alt="" onerror="this.remove()"><span>Virtual Coach AI</span></a>
      <div class="nav">
        <a href="/" data-nav>Home</a>
        <a href="/upload.html" data-nav>Upload</a>
        <a href="/reports.html" data-nav>Reports</a>
        <a href="/report.html" data-nav>Report</a>
        <a href="/pricing.html" data-nav>Pricing</a>
        <a href="/faq.html" data-nav>FAQ</a>
        <a href="/contact.html" data-nav>Contact</a>
        <a href="/login.html" data-nav>Login</a>
      </div>
    </div>
  </nav>

  <div id="busy" class="busy" hidden><span class="spinner" aria-hidden="true"></span><span id="busyText">Processing…</span></div>

  <div class="wrap">
    <header>
      <div>
        <div class="title">Swing Report — P1–P9</div>
        <div class="sub">Date: <span id="date"></span> • Mode: <span id="modeLabel">Full Swing</span></div>
      </div>
      <div class="toolbar">
        <label class="badge">Swings: <span id="swingCount">1</span></label>
        <select id="discipline" class="select" title="Shot type">
          <option value="full-swing" selected>Full Swing</option>
          <option value="chipping">Chipping</option>
          <option value="putting">Putting</option>
        </select>
        <select id="focus" class="select" title="Focus filter">
          <option value="all" selected>Focus: All</option>
          <optgroup label="Upper Body">
            <option value="right-wrist">Right Wrist</option>
            <option value="left-wrist">Left Wrist</option>
            <option value="arm-bend">Arm Bend</option>
            <option value="hand-path">Hand Path</option>
            <option value="shoulder-turn">Shoulder Turn</option>
          </optgroup>
          <optgroup label="Lower Body">
            <option value="hip-movement">Hip Movement</option>
            <option value="knee-movement">Knee Movement</option>
            <option value="foot-movement">Foot / Pressure</option>
            <option value="lead-leg-brake">Lead Leg Braking</option>
          </optgroup>
          <optgroup label="Club">
            <option value="club-path">Club Path</option>
            <option value="face-angle">Club Face Angle</option>
            <option value="tempo">Timing & Tempo</option>
          </optgroup>
        </select>
        <button id="expandAll" class="btn" type="button">Expand All</button>
        <button id="collapseAll" class="btn" type="button">Collapse All</button>
        <button id="reload" class="btn" type="button">Reload</button>
        <button id="sample" class="btn" type="button">Load Sample</button>
      </div>
    </header>

    <div class="sub" id="status"></div>
    <div class="sub" id="error" style="color:#ff9a9a"></div>

    <!-- P1–P9 FIRST -->
    <section style="margin-top:4px">
      <div class="sub">Click a P-section to expand. Use Focus to dim what you don’t care about.</div>
      <div id="plist"></div>
    </section>

    <!-- Coaching Card -->
    <section class="card" style="margin-top:12px">
      <h3>Coaching Card</h3>
      <div class="content">
        <details class="panel" open>
          <summary><span class="pname">Top 3 Priority Fixes</span><svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></summary>
          <div id="coachPriority"></div>
        </details>
        <details class="panel" style="margin-top:10px">
          <summary><span class="pname">Top 3 Power Fixes</span><svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></summary>
          <div id="coachPower"></div>
        </details>
      </div>
    </section>

    <!-- CONSISTENCY + POWER -->
    <section class="grid" style="margin-top:12px">
      <div class="card">
        <h3>Position Consistency <button class="info-btn" type="button" data-target="info-position">Info</button></h3>
        <div class="content">
          <div id="position"></div>
          <div id="info-position" class="info-callout" hidden>
            Position Consistency shows how repeatable your checkpoints (P1–P9) are across the swings in this report.
            It’s not “textbook form”—it’s how reliably <em>you</em> hit your own model. Higher = more repeatable.
          </div>
        </div>
      </div>
      <div class="card">
        <h3>Swing Consistency <button class="info-btn" type="button" data-target="info-swing">Info</button></h3>
        <div class="content">
          <div id="swing"></div>
          <div id="info-swing" class="info-callout" hidden>
            Swing Consistency tracks dynamic metrics—arm angles, face-to-path, club path, attack angle, tempo—and how
            much they vary swing-to-swing. Higher = steadier delivery; lower = timing changes.
          </div>
        </div>
      </div>
    </section>

    <section class="card" style="margin-top:12px">
      <h3>Power Score Summary <button class="info-btn" type="button" data-target="info-power">Info</button></h3>
      <div class="content">
        <div id="power"></div>
        <div id="info-power" class="info-callout" hidden>
          Power Score is a 0–100 index of how effectively you produce and deliver speed. It blends tempo, sequencing,
          release timing, and impact delivery. 75+ usually feels “easy speed”; 55–74 is workable; below 55 = efficiency leaks.
        </div>
      </div>
    </section>
  </div>

<script>
/* ---------- tiny helpers ---------- */
const $ = s => document.querySelector(s);
const $$ = s => document.querySelectorAll(s);
const byId = s => document.getElementById(s);
const fmt = v => `${v}%`;
const band = v => v>=75?'ok':v>=55?'warn':'bad';
const gradeLabel = {good:'GOOD', ok:'OK', bad:'NEEDS HELP'};
const gradeClass = g => g==='good'?'g-good':g==='ok'?'g-ok':'g-bad';

byId('date').textContent = new Date().toLocaleDateString();

/* ---------- safe json cleaner (no regex) ---------- */
function cleanJson(t){
  if(!t) return '';
  if (t.charCodeAt(0) === 0xFEFF) t = t.slice(1); // strip BOM
  // Remove control chars except tab/newline/CR
  let out=''; for (let i=0;i<t.length;i++){ const c=t.charCodeAt(i); if(c===9||c===10||c===13||c>=32) out+=t[i]; }
  let s = out.trim();
  // Trim before first { or [
  const firstCurly = s.indexOf('{'); const firstBracket = s.indexOf('[');
  let start = firstCurly; if(firstBracket>=0 && (start<0 || firstBracket<start)) start = firstBracket;
  if(start>0) s = s.slice(start);
  // Trim after last } or ]
  const lastBrace = s.lastIndexOf('}'); const lastBracket = s.lastIndexOf(']');
  const end = Math.max(lastBrace,lastBracket); if(end>=0) s = s.slice(0,end+1);
  return s;
}

/* ---------- render rows with video refs ---------- */
function metricRow(m){
  const q = 'golf ' + (m.label||'metric') + ' drill';
  const tags = (m.tags||[]).join(' ');
  return `<div class="metric" data-tags="${tags}">
    <div class="name">${m.label||'Metric'} <button class="video-btn" type="button" data-q="${q}">Reference Video</button></div>
    <div class="bar"><span class="${band(m.value||0)}" style="width:${m.value||0}%"></span></div>
    <div class="pct">${fmt(m.value||0)}</div>
  </div>`;
}
function posRow(p){
  const q = 'golf ' + (p.p||'P') + ' position drill';
  return `<div class="metric">
    <div class="name">${p.p||''} <button class="video-btn" type="button" data-q="${q}">Reference Video</button></div>
    <div class="bar"><span class="${band(p.value||0)}" style="width:${p.value||0}%"></span></div>
    <div class="pct">${fmt(p.value||0)}</div>
  </div>`;
}

/* ---------- defaults for P text ---------- */
const defaultShort = {
  P1:'Athletic setup—tall spine, neutral grip, 55/45 pressure.',
  P2:'Width maintained; toe-up face; gentle early wrist set.',
  P3:'Lead arm parallel; full turn; width kept from chest.',
  P4:'Top: trail hip deep; flatter lead wrist; steady head.',
  P5:'Transition: pelvis leads; shaft shallows; pressure left.',
  P6:'Delivery: hands ahead; trail elbow tucked; face square.',
  P7:'Impact: forward lean; hips open; low point forward.',
  P8:'Through: extend trail arm; rotate; zero flip.',
  P9:'Finish: balanced over lead side; hold the pose.'
};
const defaultLong = {
  P1:'Address like an athlete: neutral grip (trail hand in fingers), soft knees, pelvis neutral. Feel 55/45 under the arches. Chin up, spine long, eyes level. Cue: “zipper tall, arms soft.”',
  P2:'Shaft parallel with width. Hands in front of the chest, gentle wrist set, face near toe-up. Pressure loads trail foot without sway.',
  P3:'Lead arm parallel with a full turn. Trail elbow folds in front of ribcage, not behind. Keep about a forearm of space from chest; head steady.',
  P4:'Top: pressure into trail heel, trail hip deep, lead wrist flatter/bowed. Avoid across-the-line/laid-off. Soft arms, steady head.',
  P5:'Transition sequence = pelvis → torso → arms. Shaft shallows, trail elbow in front of side seam. Maintain lead-wrist flexion; pressure into lead mid-foot.',
  P6:'Delivery: hands slightly ahead of clubhead, trail elbow tucked, face in the “window.” Pelvis keeps turning—no stall.',
  P7:'Impact: forward shaft lean, low point forward. Hips ~30–45° open, chest ~10–20° open, lead leg braced. Face near square to path.',
  P8:'Post-impact: extend trail arm, handle works around you (not straight down the line). Chest up/left, no flip. Divot ahead of ball.',
  P9:'Finish balanced, weight on lead side. Belt buckle and chest to target; trail toe down. Freeze the finish for 2 counts.'
};

/* ---------- coaching content (lesson style) ---------- */
const defaultPri = [
 {title:'Clubface control at P7 (impact)', short:'Match face to path', long:`<p><b>Problem:</b> Face drifts open from P6→P7, starts leak right.</p><p><b>Feel:</b> From P5→P6 bow the lead wrist; glove logo at target through P7.</p><p><b>Drills:</b> Mirror P6 checks; two-tee gate (clip both tees).</p><p><b>Prescription:</b> 3×(5 rehearsals + 5 half + 3 full). Film last 2.</p>`},
 {title:'Lower body sequence', short:'Clear hips before hands', long:`<p><b>Problem:</b> Hands jump first; path steep; timing roulette.</p><p><b>Feel:</b> Plant lead heel from P4, post and turn belt buckle; chest stays closed a beat.</p><p><b>Drills:</b> Step-throughs 2×10; post-and-turn 3×8.</p><p><b>Prescription:</b> 3 blocks (8 rehearsals + 6 balls). Hold tall finish.</p>`},
 {title:'Hand path width', short:'Keep width at P3', long:`<p><b>Problem:</b> Width collapses at P3 → across-the-line later.</p><p><b>Feel:</b> Keep a “beach ball” of space from sternum to hands.</p><p><b>Drills:</b> Pump-downs P3→mini P4→P5, 3×10; split-hand backswing.</p><p><b>Prescription:</b> 2×(10 rehearsals + 6 balls). Face-on video check.</p>`}
];
const defaultPow = [
 {title:'Tempo 3:1', short:'Smooth, athletic rhythm', long:`Count “one-two-three” back, “one” through. Metronome ~72 bpm. 3 sets × 12 swings.`},
 {title:'Lead-leg brake', short:'Post into the lead side', long:`From P4 plant the lead heel and straighten it through P5–P6. Towel under heel; 10 rehearsals + 5 balls × 3.`},
 {title:'Late release timing', short:'Hold, then let it go', long:`Carry the lag to P6 then release through the ball. Two-tee gate; clip both tees. 2×5 swings; video last 2.`}
];

/* ---------- renderers ---------- */
function renderReport(data){
  // header
  if(data.discipline){ byId('modeLabel').textContent = /putt/i.test(data.discipline)?'Putting':/chip/i.test(data.discipline)?'Chipping':'Full Swing'; }
  if(data.swings!=null){ byId('swingCount').textContent = String(data.swings); }

  // power
  const p = data.power||{score:0, tempo:'—', release_timing:0};
  byId('power').innerHTML = `
    <div class="metric"><div class="name">Power Score</div><div class="bar"><span class="${band(p.score)}" style="width:${p.score}%"></span></div><div class="pct">${fmt(p.score)}</div></div>
    <div class="metric"><div class="name">Tempo</div><div class="bar"><span class="ok" style="width:76%"></span></div><div class="pct">${p.tempo}</div></div>
    <div class="metric"><div class="name">Release Timing</div><div class="bar"><span class="${band(+p.release_timing)}" style="width:${+p.release_timing||0}%"></span></div><div class="pct">${+p.release_timing||0}%</div></div>`;

  // metrics
  const swingHtml = (data.swing_metrics||[]).map(metricRow).join('') || '<div class="sub">No swing metrics.</div>';
  const posHtml   = (data.position_metrics||[]).map(posRow).join('')   || '<div class="sub">No position metrics.</div>';
  byId('swing').innerHTML = swingHtml;
  byId('position').innerHTML = posHtml;

  // P1–P9
  const names = ['Setup','Shaft Parallel (Backswing)','Lead Arm Parallel (Backswing)','Top of Swing','Lead Arm Parallel (Downswing)','Shaft Parallel (Downswing)','Impact','Trail Arm Parallel (Follow-Through)','Finish'];
  let phases = Array.isArray(data.phases)? data.phases.slice() : [];
  const pm = data.position_metrics||[];
  const getPmVal = id => { const m = pm.find(x=>(x.p||'').toUpperCase()===id); return m? m.value : 0; };
  const gradeFromVal = v => v>=75?'good':v>=55?'ok':'bad';
  if(!phases.length){
    for(let i=0;i<9;i++){
      const id='P'+(i+1), val=getPmVal(id), g=gradeFromVal(val);
      phases.push({id,name:names[i],short:defaultShort[id],long:defaultLong[id],grade:g});
    }
  }else{
    // fill missing copy/grades
    phases = phases.map((ph,i)=>{
      const id = ph.id || ('P'+(i+1));
      const g = ph.grade || gradeFromVal(getPmVal(id));
      const s = (ph.short && ph.short.trim().length>24)? ph.short : (defaultShort[id]||ph.short||'');
      const l = (ph.long && ph.long.trim() && ph.long.trim()!==(s||'').trim()) ? ph.long : (defaultLong[id]||'');
      return {id,name:ph.name||names[i],short:s,long:l,grade:g};
    });
  }
  byId('plist').innerHTML = phases.map((ph,i)=>`
    <details ${i===0?'open':''} class="panel">
      <summary>
        <span class="pnum">${ph.id}</span>
        <span class="pname">${ph.name}</span>
        <span class="gchip ${gradeClass(ph.grade)}" style="margin-left:8px">${gradeLabel[ph.grade]||'OK'}</span>
        <span class="sub" style="margin-left:8px">${ph.short||''}</span>
        <svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
      </summary>
      <div class="content">
        <div class="sub" style="margin-bottom:8px">${ph.short||''}</div>
        <div style="margin-bottom:10px">${ph.long||''}</div>
        <div><button class="video-btn" type="button" data-q="${'golf '+ph.id+' '+ph.name+' drill'}">Reference Video</button></div>
      </div>
    </details>`).join('');

  // Coaching
  const pri = (data.coaching && Array.isArray(data.coaching.priority_fixes)) ? data.coaching.priority_fixes : defaultPri;
  const pow = (data.coaching && Array.isArray(data.coaching.power_fixes)) ? data.coaching.power_fixes : defaultPow;
  const mk = i => `
    <details class="panel">
      <summary><span class="pname">${i.title}</span><span class="sub" style="margin-left:8px">${i.short||''}</span><svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg></summary>
      <div class="content">${i.long||''}
        <div style="margin-top:8px"><button class="video-btn" type="button" data-q="${'golf '+(i.title||'drill')}">Reference Video</button></div>
      </div>
    </details>`;
  byId('coachPriority').innerHTML = pri.map(mk).join('');
  byId('coachPower').innerHTML   = pow.map(mk).join('');
}

/* ---------- loader ---------- */
async function loadReport(url){
  const s = byId('status'), e = byId('error');
  e.textContent=''; s.innerHTML='Loading <a href="'+url+'" target="_blank" rel="noopener">'+url+'</a>…';
  try{
    const res = await fetch(url,{cache:'no-store'});
    if(!res.ok) throw new Error('HTTP '+res.status);
    const raw = await res.text();
    const clean = cleanJson(raw);
    const data = JSON.parse(clean);
    renderReport(data);
    s.innerHTML='Loaded: <a href="'+url+'" target="_blank" rel="noopener">'+url+'</a>';
  }catch(err){
    e.textContent='Failed to load report: '+(err && err.message ? err.message : String(err));
    renderReport(sample); // fallback so UI isn’t empty
    s.textContent='Loaded SAMPLE (parse failed): '+url;
  }
}

/* ---------- sample data ---------- */
const sample = {
  swings:1, discipline:'full-swing',
  power:{score:78, tempo:'3.0:1', release_timing:62},
  swing_metrics:[
    {label:'Right Arm Angle',value:84,tags:['arm-bend']},
    {label:'Club Face Angle',value:79,tags:['face-angle']},
    {label:'Shoulder Turn',value:72,tags:['shoulder-turn']},
    {label:'Hip Turn',value:68,tags:['hip-movement']},
    {label:'X-Factor (Shoulder–Hip)',value:64,tags:['sequence']},
    {label:'Club Path',value:71,tags:['club-path']},
    {label:'Face-to-Path',value:66,tags:['face-angle']},
    {label:'Attack Angle',value:62,tags:['delivery']}
  ],
  position_metrics:[{p:'P1',value:90},{p:'P2',value:74},{p:'P3',value:61},{p:'P4',value:55},{p:'P5',value:63},{p:'P6',value:70},{p:'P7',value:81},{p:'P8',value:86},{p:'P9',value:78}],
  phases:[
    {id:'P1',name:'Setup',short:'Athletic stance',long:'Neutral grip, soft knees, pelvis neutral. Pressure 55/45 lead-to-trail; spine tall; eyes level.',grade:'good'},
    {id:'P2',name:'Shaft Parallel (Backswing)',short:'Width + neutral face',long:'Hands in front of chest; gradual wrist set; near toe-up; pressure loads trail foot without sway.',grade:'ok'},
    {id:'P3',name:'Lead Arm Parallel (Backswing)',short:'Maintain width',long:'Trail elbow folds in front of ribcage; club on plane; head steady; width ~a forearm off chest.',grade:'ok'},
    {id:'P4',name:'Top of Swing',short:'Full coil',long:'Pressure into trail heel; trail hip deep; lead wrist nearer flat/bowed. Avoid across-the-line/laid-off extremes.',grade:'bad'},
    {id:'P5',name:'Lead Arm Parallel (Downswing)',short:'Sequencing',long:'Pelvis → torso → arms. Shaft shallows; trail elbow in front of side seam; lead-wrist flexion maintained.',grade:'good'},
    {id:'P6',name:'Shaft Parallel (Downswing)',short:'Deliver',long:'Hands slightly ahead; face in the window; pelvis keeps turning (no stall).',grade:'good'},
    {id:'P7',name:'Impact',short:'Forward lean',long:'Forward shaft lean; low point forward. Pelvis 30–45° open; chest 10–20° open; lead leg braced.',grade:'ok'},
    {id:'P8',name:'Trail Arm Parallel (Follow-Through)',short:'Extension',long:'Trail arm extends; handle works around; control rate of closure (no flip).',grade:'good'},
    {id:'P9',name:'Finish',short:'Balanced',long:'Pressure fully lead side; belt buckle and chest to target; hold the pose.',grade:'good'}
  ]
};

/* ---------- events ---------- */
byId('expandAll').onclick = ()=>{$$('details.panel').forEach(d=>d.open=true);};
byId('collapseAll').onclick = ()=>{$$('details.panel').forEach(d=>d.open=false);};
byId('sample').onclick = ()=>{ renderReport(sample); byId('status').textContent='Loaded sample (no fetch).'; };
byId('reload').onclick = ()=>{
  const u = new URLSearchParams(location.search).get('report') || document.body.dataset.reportSrc || '/reports/demo/report.json';
  loadReport(u);
};
byId('focus').addEventListener('change', e=>{
  const val=e.target.value;
  $$('.metric').forEach(el=>{
    el.classList.remove('focus-dim');
    if(val==='all') return;
    const tags=(el.getAttribute('data-tags')||'').split(' ');
    if(!tags.includes(val)) el.classList.add('focus-dim');
  });
});
// Info toggles
document.addEventListener('click', (e)=>{
  const ib = e.target.closest('.info-btn');
  if(ib){ const t = byId(ib.dataset.target); if(t) t.hidden=!t.hidden; }
  const vb = e.target.closest('.video-btn');
  if(vb){ const q = (vb.getAttribute('data-q')||'').trim(); const url='https://www.youtube.com/results?search_query='+encodeURIComponent(q); window.open(url,'_blank','noopener'); }
});

// auto mark active nav link
(function(){
  try{
    const here = location.pathname.replace(/\/index\.html$/,'/') || '/';
    document.querySelectorAll('.topbar [data-nav]').forEach(a=>{
      const href = a.getAttribute('href');
      if(here === href) a.classList.add('active');
    });
  }catch(_){}
})();

// initial load
const auto = new URLSearchParams(location.search).get('report') || document.body.dataset.reportSrc || '/reports/demo/report.json';
loadReport(auto);
</script>
</body>
</html>
