<!doctype html><meta charset="utf-8"><title>Pipeline Health</title>
<style>
  body{font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto;max-width:960px;margin:40px auto;padding:0 16px}
  table{width:100%;border-collapse:collapse}
  th,td{border-top:1px solid #ddd;padding:8px;vertical-align:top}
  .ok{color:green}.bad{color:#b00020}
  pre{white-space:pre-wrap;word-break:break-word;background:#f7f7f7;padding:8px;border-radius:6px}
</style>
<h1>Pipeline Health</h1>
<p>This page probes your live APIs and writes/reads a test status.</p>
<table id="t"><thead><tr><th>Check</th><th>Status</th><th>HTTP</th><th>Body</th></tr></thead><tbody></tbody></table>
<script>
const checks=[ 
  { label:"API: /api/health", url:"/api/health" },
  { label:"API: /api/upload (POST)", url:"/api/upload", method:"POST",
    body:{ jobId:"smoke", key:"uploads/smoke.txt", contentType:"text/plain" } },
  { label:"API: PUT to signed URL", url:"", method:"PUT", followSigned:true },
  { label:"API: /api/report (POST)", url:"/api/report", method:"POST",
    body:{ jobId:"smoke", status:"ready", data:{ t:Date.now() } } },
  { label:"API: /api/analyze?jobId=smoke", url:"/api/analyze?jobId=smoke" },
];
const tbody=document.querySelector("#t tbody");
function row(label, ok, code, body){ const tr=document.createElement('tr');
  tr.innerHTML=`<td>${label}</td><td class="${ok?'ok':'bad'}">${ok?'œ…':'Œ'}</td><td>${code||''}</td><td><pre>${body}</pre></td>`;
  tbody.appendChild(tr);
}
(async()=>{
  try{
    let signedURL=null;
    for(const c of checks){
      try{
        if(c.followSigned){
          if(!signedURL){ row(c.label,false,0,"No signed URL from previous step"); continue; }
          const put = await fetch(signedURL, {method:"PUT", body:new Blob(["smoke"],{type:"text/plain"})});
          row(c.label, put.ok, put.status, "PUT tiny text to S3");
          continue;
        }
        const resp = await fetch(c.url, {method:c.method||"GET",
          headers: c.method?{"Content-Type":"application/json"}:undefined,
          body: c.method?JSON.stringify(c.body):undefined});
        const text = await resp.text();
        let pretty = text; try{ pretty = JSON.stringify(JSON.parse(text), null, 2);}catch{}
        row(c.label, resp.ok, resp.status, pretty);
        if(c.label.includes("/api/upload") && resp.ok){
          try{ const j = JSON.parse(text); signedURL = j.url; }catch{}
        }
      }catch(e){ row(c.label,false,0,String(e)); }
    }
  }catch(e){ row("fatal",false,0,String(e)); }
})();
</script>









.brand-logo{height:36px;width:auto;display:block}


