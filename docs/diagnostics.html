<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>VirtualCoachAI – Diagnostics</title>
<style>
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:0;background:#0d0f10;color:#fff}
  .wrap{max-width:900px;margin:0 auto;padding:24px}
  h1{margin:0 0 12px}
  .card{background:#151a1f;border:1px solid #2a3340;border-radius:12px;padding:16px;margin:12px 0}
  button{background:#0a5f37;border:1px solid #2a3340;color:#fff;border-radius:10px;padding:10px 14px;cursor:pointer}
  pre{white-space:pre-wrap;word-break:break-word;background:#0e1216;padding:12px;border-radius:8px;border:1px solid #2a3340;max-height:380px;overflow:auto}
  .ok{color:#7CFC00}
  .bad{color:#ff726f}
  .muted{color:#a6b0bf}
  .row{display:flex;gap:8px;flex-wrap:wrap}
</style>
</head>
<body>
<div class="wrap">
  <h1>Diagnostics</h1>
  <div class="card">
    <div class="row">
      <button id="btnVersion">Check /api/version</button>
      <button id="btnSelf">Run Server Self-Test</button>
      <button id="btnClient">Run Client S3 Test (no upload)</button>
      <a href="upload-html" style="margin-left:auto;color:#8fd1ff">Go to Upload Page †’</a>
    </div>
    <div id="out"></div>
  </div>
  <div class="card">
    <div class="muted">
      What this does:
      <ul>
        <li><b>/api/version</b>: proves this deployment is reachable.</li>
        <li><b>/api/self-test</b>: verifies env vars and that S3 presign works.</li>
        <li><b>Client S3 Test</b>: calls <code>/api/s3-presign</code> (must exist) and shows the S3 POST URL/fields we’d use to upload.</li>
      </ul>
    </div>
  </div>
</div>
<script>
const out = document.getElementById('out');
const log = (title, obj, ok = true) => {
  const h = document.createElement('div');
  h.innerHTML = `<h3 class="${ok?'ok':'bad'}">${ok?'œ“':'œ—'} ${title}</h3><pre>${escape(JSON.stringify(obj, null, 2))}</pre>`;
  out.prepend(h);
};
const escape = s => s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;' }[m]));

document.getElementById('btnVersion').onclick = async () => {
  try {
    const r = await fetch('/api/version', { cache: 'no-store' });
    const j = await r.json();
    log('/api/version', j, r.ok);
  } catch (e) {
    log('/api/version FAILED', { error: String(e) }, false);
  }
};

document.getElementById('btnSelf').onclick = async () => {
  try {
    const r = await fetch('/api/self-test', { method: 'POST' });
    const j = await r.json();
    log('/api/self-test', j, j.ok);
  } catch (e) {
    log('/api/self-test FAILED', { error: String(e) }, false);
  }
};

document.getElementById('btnClient').onclick = async () => {
  try {
    const payload = { filename: 'probe.mov', contentType: 'video/quicktime' };
    const r = await fetch('/api/s3-presign', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const txt = await r.text();
    let j;
    try { j = JSON.parse(txt); } catch { j = { raw: txt }; }
    log('/api/s3-presign (client)', { status: r.status, body: j }, r.ok);
  } catch (e) {
    log('/api/s3-presign FAILED', { error: String(e) }, false);
  }
};
</script>
</body>
</html>




