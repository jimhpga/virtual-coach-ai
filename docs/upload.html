<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Virtual Coach AI — Upload</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="preload" as="image" href="homepage-background.png" />
<meta http-equiv="Cache-Control" content="no-store, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<style>
  :root{ --nav:#0b2b12; --scrim:rgba(0,0,0,.06); --panel:rgba(10,18,24,.24);
         --line:rgba(255,255,255,.10); --text:#ecf3f7; --muted:#cfe0e6; --radius:14px; --maxw:1100px;
         --accent:#19c37d; --accent2:#6aa8ff; --accent3:#f6c453; --shadow:0 10px 28px rgba(0,0,0,.25); }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;color:var(--text);font:16px/1.55 system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial;
       background:url("homepage-background.png") center/cover fixed no-repeat}
  .scrim{min-height:100vh;background:var(--scrim)}
  header.top{position:sticky;top:0;z-index:100;background:var(--nav);border-bottom:1px solid rgba(255,255,255,.1)}
  .navwrap{width:min(var(--maxw),94%);margin:0 auto;padding:10px 0;display:flex;gap:12px;align-items:center;justify-content:space-between}
  .brand{display:flex;align-items:center;gap:10px;text-decoration:none}
  .brand-logo{height:36px;width:auto;display:block}
  nav.nav{display:flex;gap:8px;flex-wrap:wrap}
  nav.nav a{color:#fff;text-decoration:none;padding:8px 10px;border-radius:10px;border:1px solid transparent;white-space:nowrap}
  nav.nav a[aria-current="page"]{border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.10)}
  main{width:min(var(--maxw),92%);margin:0 auto;padding:22px 0 56px;display:grid;gap:14px}
  h1{margin:0 0 6px;color:#86efac}
  .lead{color:var(--muted)}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);padding:16px;backdrop-filter:blur(1px);box-shadow:var(--shadow)}
  .picker{border:1px dashed rgba(255,255,255,.25);border-radius:12px;padding:16px;display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  input[type=file]{display:none}
  .btn{border:1px solid var(--line);background:rgba(255,255,255,.10);color:#fff;padding:10px 14px;border-radius:10px;text-decoration:none;display:inline-flex;gap:8px;align-items:center;cursor:pointer}
  .btn.primary{background:rgba(25,195,125,.18);border-color:#2a6}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .badge{display:inline-block;background:rgba(255,255,255,.06);border:1px solid var(--line);color:#dff3ff;padding:6px 10px;border-radius:999px;font-size:12px}
  #log{white-space:pre-wrap;background:#0b1520;border:1px solid #123;border-radius:10px;padding:12px;min-height:120px;color:#dfe9f2;font-size:13px}
  .grid{display:grid;gap:12px}
  @media(min-width:940px){ .grid.two{grid-template-columns:1.1fr .9fr} }
  .tip{display:flex;gap:10px;align-items:flex-start}
  .dot{flex:0 0 22px;height:22px;border-radius:6px;border:1px solid var(--line);display:grid;place-items:center;background:rgba(255,255,255,.10)}
  .dot svg{display:block}
  .tips h2{margin:0 0 6px;font-size:1.12rem}
  footer{text-align:center;color:#cbd5cb;font-size:12px;padding:18px 0 26px}
</style>
<script>
  addEventListener('DOMContentLoaded', ()=>{
    const here=(location.pathname.split('/').pop()||'index.html').split('?')[0];
    document.querySelectorAll('nav a').forEach(a=>{ const h=a.getAttribute('href'); if(h&&h.split('?')[0]===here) a.setAttribute('aria-current','page'); });
    const y=document.getElementById('y'); if(y) y.textContent=new Date().getFullYear();
  });
</script>
</head>
<body>
<header class="top" id="site-header">
  <div class="navwrap">
    <a class="brand" href="index.html" aria-label="Virtual Coach AI">
      <img src="virtualcoach-logo.png" alt="Virtual Coach AI" class="brand-logo" />
      <span style="color:#fff;font-weight:800">Virtual Coach AI</span>
    </a>
    <nav class="nav" id="siteNav" aria-label="Primary">
      <a href="index.html">Home</a>
      <a href="upload.html" aria-current="page">Upload</a>
      <a href="report.html?report=report.json">Reports</a>
      <a href="coming-soon.html">Coming&nbsp;Soon</a>
      <a href="pricing.html">Pricing</a>
      <a href="faq.html">FAQ</a>
      <a href="contact.html">Contact</a>
      <a href="login.html">Login</a>
    </nav>
  </div>
</header>

<div class="scrim">
  <main class="grid two">
    <!-- Left: uploader -->
    <section class="card">
      <h1>Upload → Report → Analyze</h1>
      <p class="lead">Pick a single swing video. We’ll upload, analyze, and open your live report automatically.</p>

      <div class="picker" id="drop">
        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap">
          <label class="btn" for="file">Choose Video</label>
          <input id="file" type="file" accept="video/*,.mov,.mp4,.m4v" />
          <span class="badge" id="keyBadge">(no file)</span>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <button id="go" class="btn primary" disabled>Upload &amp; Generate Report</button>
          <a class="btn" href="report.html?report=report.json">Open Sample</a>
        </div>
      </div>

      <div id="log" class="card" style="margin-top:12px">Ready.</div>
    </section>

    <!-- Right: filming tips -->
    <section class="card tips">
      <h2 style="margin:0 0 10px;font-size:1.25rem;color:#8bf0b9">How to film (best results)</h2>

      <div class="tip"><span class="dot">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
      </span>
      <div><b>Angles:</b> Record <em>Face-On</em> (chest-high camera, square to target) and/or <em>Down-the-Line</em> (behind, on target line).</div></div>

      <div class="tip"><span class="dot">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
      </span>
      <div><b>Height & Distance:</b> Set camera roughly <em>hip- to chest-high</em>, ~<em>7–9 ft</em> away. Keep the lens level.</div></div>

      <div class="tip"><span class="dot">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
      </span>
      <div><b>Framing:</b> Capture <em>the entire clubhead</em> through the swing, with feet and ball fully in frame.</div></div>

      <div class="tip"><span class="dot">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
      </span>
      <div><b>Stability:</b> Use a tripod or prop your phone; bright, even lighting beats slow-mo in the dark.</div></div>

      <div class="tip"><span class="dot">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>
      </span>
      <div><b>Optional:</b> 60–240fps is great <em>if</em> lighting is solid. Otherwise keep it standard frame-rate to avoid blur.</div></div>
    </section>
  </main>

  <footer>© <span id="y"></span> Virtual Coach AI</footer>
</div>

<script>
  const logEl = document.getElementById('log');
  const fileEl = document.getElementById('file');
  const keyBadge = document.getElementById('keyBadge');
  const goBtn = document.getElementById('go');
  const drop = document.getElementById('drop');

  const log = (m) => { logEl.textContent += '\\n' + m; logEl.scrollTop = logEl.scrollHeight; };
  const setKey = (k) => { keyBadge.textContent = k || '(no file)'; };
  const safeName = (s) => (s||'video').replace(/[^a-zA-Z0-9._-]+/g,'_');

  function onChosen(file){
    if(!file){ setKey('(no file)'); goBtn.disabled = true; return; }
    const ok = /video\\//i;
    if(!ok.test(file.type) && !/\\.(mp4|mov|m4v)$/i.test(file.name)){
      alert('Please choose a video (.mp4, .mov, .m4v).');
      fileEl.value = ''; setKey('(no file)'); goBtn.disabled = true; return;
    }
    setKey(safeName(file.name));
    goBtn.disabled = false;
  }
  fileEl.addEventListener('change', e => onChosen(e.target.files[0]));

  // Drag & drop
  ;['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault(); drop.style.borderColor='#2a6';}));
  ;['dragleave','drop'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault(); drop.style.borderColor='rgba(255,255,255,.25)';}));
  drop.addEventListener('drop', e=>{
    const f = e.dataTransfer.files && e.dataTransfer.files[0];
    if(f){ fileEl.files = e.dataTransfer.files; onChosen(f); }
  });

  // --- Upload → Report ---
  function apiBase(){
    // On GitHub Pages, send to vercel domain; on vercel/custom domain, use same origin.
    return location.hostname.endsWith('github.io') ? 'https://virtualcoachai.net' : '';
  }

  async function tryEndpoints(fd){
    // We’ll try a few common endpoints; first one that returns 200/201 wins.
    const eps = ['/api/upload','/api/analyze','/api/report'];
    for(const ep of eps){
      try{
        const r = await fetch(apiBase()+ep, { method:'POST', body:fd, credentials:'include', mode:'cors' });
        if(r.status === 202){
          // Poll a Location if provided
          const loc = r.headers.get('Location');
          log('Queued (202). Polling status…');
          if(loc){
            for(let i=0;i<20;i++){
              await new Promise(res=>setTimeout(res, 1000));
              const s = await fetch(apiBase()+loc, {credentials:'include'});
              if(s.ok){
                const j = await s.json().catch(()=>null);
                if(j && (j.reportUrl || j.url || j.report)){ return j; }
              }
            }
          }
        }
        if(r.ok){
          const j = await r.json().catch(()=>null);
          if(j) return j;
        }
      }catch(e){ /* keep trying */ }
    }
    return null;
  }

  function deriveReportHref(j){
    // Accept multiple shapes from the API and convert to report.html?report=…
    // Examples supported:
    // { reportUrl: "report.html?report=/tmp/abc.json" }
    // { url: "https://…/report.html?report=…" }
    // { report: { json: "/tmp/abc.json" } }
    // { id: "abc123" } or { key:"abc123" }  => reports/abc123.json
    if(!j) return null;

    // Direct URL (already report.html?report=…)
    if(j.reportUrl && /report\.html\?report=/i.test(j.reportUrl)) return j.reportUrl;
    if(j.url && /report\.html\?report=/i.test(j.url)) return j.url;

    // JSON path
    const jsonPath = j?.report?.json || j?.jsonPath || j?.json || j?.path;
    if(jsonPath){
      const p = String(jsonPath);
      // If absolute URL, keep it; else make relative
      const q = /^https?:\/\//i.test(p) ? p : p.replace(/^\/+/,'');
      return 'report.html?report=' + encodeURIComponent(q);
    }

    // ID / key → standard location
    const id = j.id || j.key || j.reportKey;
    if(id){
      return 'report.html?report=' + encodeURIComponent(`reports/${id}.json`);
    }

    return null;
  }

  document.getElementById('go').onclick = async ()=>{
    const f = fileEl.files[0];
    if(!f){ alert('Pick a video first.'); return; }

    goBtn.disabled = true;
    log('Uploading…');

    const fd = new FormData();
    fd.append('file', f, safeName(f.name));
    fd.append('filename', safeName(f.name));
    // you can add user/session fields here: fd.append('user','…')

    const resp = await tryEndpoints(fd);
    const href = deriveReportHref(resp);

    if(href){
      log('Opening your live report…');
      // If href is absolute report.html?report=http(s)://…, it still works.
      location.href = href;
      return;
    }

    log('API not available, opening sample report.');
    location.href = 'report.html?report=report.json';
  };
</script>
</body></html>
