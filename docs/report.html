<!doctype html>
<html lang="en">
<head>
<meta http-equiv="Cache-Control" content="no-store, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Virtual Coach AI â€” Swing Report</title>
<link rel="preload" as="image" href="homepage-background.png"/>
<style>
  :root{
    --nav:#0b2b12; --brand:#0b2b12; --scrim:rgba(0,0,0,.06);
    --panel:rgba(10,18,24,.24); --line:rgba(255,255,255,.10);
    --text:#ecf3f7; --muted:#cfe0e6; --radius:16px; --shadow:0 8px 24px rgba(0,0,0,.20);
    --maxw:1080px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;color:var(--text);
    background:url('homepage-background.png') center/cover fixed no-repeat;
    font:16px/1.5 system-ui,-apple-system,Segoe UI,Inter,Roboto,Arial,sans-serif;
  }
  .scrim{min-height:100vh;background:var(--scrim)}

  /* NAV */
  header.top{position:sticky;top:0;z-index:100;background:var(--nav);border-bottom:1px solid rgba(255,255,255,.1)}
  .navwrap{width:min(var(--maxw),92%);margin:0 auto;padding:10px 0;display:flex;gap:12px;align-items:center;justify-content:space-between}
  .brand{display:flex;align-items:center;gap:10px;color:#fff;text-decoration:none;font-weight:800}
  .brand-logo{height:36px;width:auto;display:block}
  .menu-toggle{display:none;align-items:center;gap:8px;color:#fff;background:transparent;border:1px solid rgba(255,255,255,.3);border-radius:10px;padding:6px 10px;cursor:pointer}
  nav.nav{display:flex;gap:8px}
  nav.nav a{color:#fff;text-decoration:none;padding:8px 10px;border-radius:10px;border:1px solid transparent;white-space:nowrap}
  nav.nav a:hover{background:rgba(255,255,255,.08)}
  nav.nav a[aria-current="page"]{border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.10)}
  @media(max-width:820px){
    .menu-toggle{display:inline-flex}
    nav.nav{position:absolute;right:0;top:100%;background:var(--nav);border-bottom:1px solid rgba(255,255,255,.1);display:none;flex-direction:column;padding:8px}
    header.top.open nav.nav{display:flex}
  }

  /* Layout */
  .wrap{width:min(var(--maxw),92%);margin:0 auto;padding:18px 0 42px}
  .title{font-size:26px;font-weight:800}
  .sub{color:var(--muted);font-size:13px}
  .badge{background:rgba(255,255,255,.06);border:1px solid var(--line);color:#dff3ff;padding:6px 10px;border-radius:999px;font-size:12px}
  .actions{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0}
  .btn{border:1px solid var(--line);background:rgba(255,255,255,.10);color:#fff;padding:8px 12px;border-radius:10px;text-decoration:none;display:inline-flex;gap:8px;align-items:center;cursor:pointer}
  .btn:hover{background:rgba(255,255,255,.16)}
  .btn.primary{background:rgba(25,195,125,.18);border-color:#2a6}
  .btn.warn{background:rgba(246,196,83,.18);border-color:#b8860b}

  .card,details.panel{background:var(--panel);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);backdrop-filter:blur(1.5px)}
  .card h3{margin:0;padding:14px 16px;border-bottom:1px solid var(--line)}
  .card .content{padding:12px 16px}
  .hdr{display:flex;align-items:center;justify-content:space-between;gap:10px}

  summary{list-style:none;display:flex;gap:10px;align-items:center;padding:14px 16px;cursor:pointer}
  summary::-webkit-details-marker{display:none}
  .pnum{width:34px;height:34px;border-radius:10px;background:#0c1820;border:1px solid var(--line);display:grid;place-items:center;font-weight:800}
  .pname{font-weight:700}
  .gchip{font-size:12px;font-weight:800;padding:4px 8px;border-radius:999px;margin-left:8px}
  .g-good{background:#19c37d;color:#fff}
  .g-ok{background:#f6c453;color:#2a2300}
  .g-bad{background:#ff6b6b;color:#fff}
  .caret{margin-left:auto;transition:transform .2s}
  details[open] .caret{transform:rotate(180deg)}

  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media(max-width:960px){.grid2{grid-template-columns:1fr}}

  /* Bars (â€œgraphsâ€) */
  .metric{display:flex;align-items:center;gap:10px;margin:9px 0}
  .metric .name{flex:0 0 210px;color:#d8ebf2}
  .bar{flex:1;height:10px;border-radius:999px;background:#10222c;border:1px solid #22404f;position:relative;overflow:hidden}
  .bar>span{position:absolute;left:0;top:0;bottom:0;border-radius:999px}
  .ok{background:linear-gradient(90deg,#19c37d,#2bd897)}
  .warn{background:linear-gradient(90deg,#f6c453,#ffd479)}
  .bad{background:linear-gradient(90deg,#ff6b6b,#ff8f8f)}
  .pct{width:52px;text-align:right;color:#cfe3ee}

  ul.clean{margin:8px 0 0 18px}
  ul.clean li{margin:6px 0}
  footer{width:min(var(--maxw),92%);margin:14px auto 26px;text-align:left;color:#cbd9de;font-size:12px}

  /* Modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;padding:16px;z-index:9999}
  .modal.open{display:flex}
  .modal .box{width:min(960px,95vw);background:#0b1520;border:1px solid #123;border-radius:12px;box-shadow:0 10px 28px rgba(0,0,0,.4)}
  .modal header.mh{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;border-bottom:1px solid #123}
  .modal .content{padding:10px 12px}
  .modal iframe,.modal video{width:100%;height:min(72vh,56vw);background:#000;border-radius:8px}
  .closebtn{background:transparent;color:#fff;border:1px solid #345;padding:6px 10px;border-radius:8px;cursor:pointer}
</style>
</head>
<body>
  <header class="top" id="site-header">
<meta http-equiv="Cache-Control" content="no-store, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
    <div class="navwrap">
      <a class="brand" href="index.html">
        <img class="brand-logo" src="virtualcoach-logo.png" alt="Virtual Coach AI"/>
        <span>Virtual Coach AI</span>
      </a>
      <button class="menu-toggle" id="menuBtn" aria-expanded="false">Menu â–¾</button>
      <nav class="nav" id="siteNav" aria-label="Primary">
        <a href="index.html">Home</a>
        <a href="upload.html">Upload</a>
        <a href="report.html?report=report.json" aria-current="page">Reports</a>
        <a href="coming-soon.html">Coming&nbsp;Soon</a>
        <a href="pricing.html">Pricing</a>
        <a href="faq.html">FAQ</a>
        <a href="contact.html">Contact</a>
        <a href="login.html">Login</a>
      </nav>
    </div>
  </header>

  <div class="scrim">
    <main class="wrap">
      <header class="hdr" style="margin-bottom:10px">
<meta http-equiv="Cache-Control" content="no-store, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
        <div>
          <div class="title">Swing Report â€” P1–P9</div>
          <div class="sub">Date: <span id="date"></span> â€¢ Mode: <span id="modeLabel">Full Swing</span></div>
        </div>
        <div>
          <span class="badge">Swings: <span id="swingCount">â€”</span></span>
          <span class="badge" id="statusPill" style="margin-left:8px">Loadingâ€¦</span>
        </div>
      </header>

      <div class="actions">
        <button id="btnDownload" class="btn primary">Download</button>
        <button id="btnSend" class="btn warn">Send to Coach</button>
        <button id="btnCopy" class="btn">Copy Share Link</button>
      </div>

      <!-- P1–P9 -->
      <section class="card" style="margin-top:6px">
        <h3 class="hdr"><span>P1–P9</span></h3>
        <div id="plist" class="content"></div>
      </section>

      <!-- Metrics -->
      <section class="grid2" style="margin-top:12px">
        <div class="card">
          <h3 class="hdr"><span>Position Consistency</span></h3>
          <div id="position" class="content"></div>
        </div>
        <div class="card">
          <h3 class="hdr"><span>Swing Consistency</span></h3>
          <div id="swing" class="content"></div>
        </div>
      </section>

      <section class="card" style="margin-top:12px">
        <h3 class="hdr"><span>Power Score Summary</span></h3>
        <div id="power" class="content"></div>
      </section>

      <section class="card" style="margin-top:12px">
        <h3 class="hdr"><span>Top 3 Fundamentals</span></h3>
        <div id="fundamentals" class="content"></div>
      </section>

      <section class="card" style="margin-top:12px">
        <h3 class="hdr"><span>Top 3 Power Errors</span></h3>
        <div id="powerErrors" class="content"></div>
      </section>

      <section class="card" style="margin-top:12px">
        <h3 class="hdr"><span>Top 3 Quick Fixes</span></h3>
        <div id="quickFixes" class="content"></div>
      </section>

      <section class="card" style="margin-top:12px">
        <h3 class="hdr"><span>Faults</span></h3>
        <div id="faults" class="content"></div>
      </section>

      <section class="card" style="margin-top:12px">
        <h3 class="hdr"><span>Drills</span></h3>
        <div id="drills" class="content"></div>
      </section>
    </main>

    <footer>Â© <span id="y"></span> Virtual Coach AI</footer>
  </div>

  <!-- Video modal -->
  <div id="viewer" class="modal" role="dialog" aria-modal="true" aria-label="Video">
    <div class="box">
      <header class="mh">
<meta http-equiv="Cache-Control" content="no-store, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0"><h4 style="margin:0">Video</h4><button class="closebtn" id="viewerClose">Close</button></header>
      <div class="content" id="viewerBody"></div>
    </div>
  </div>

<script>
/* ===== utils ===== */
const $ = s => document.querySelector(s);
const qp = new URLSearchParams(location.search);
const reportParam = qp.get('report');

const esc = s => String(s ?? '')
  .replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
const band = v => (+v>=75 ? 'ok' : +v>=55 ? 'warn' : 'bad');

function deMoji(s){
  // fix the common mojibake we saw in your JSON
  return String(s ?? '')
    .replace(/Ã¢â‚¬â€/g,'â€”').replace(/Ã¢â‚¬â€œ/g,'â€“').replace(/Ã¢â‚¬Â¦/g,'â€¦')
    .replace(/Ãƒâ€”/g,'Ã—').replace(/Ã‚/g,'').replace(/\s+/g,' ').trim();
}

document.getElementById('y').textContent = new Date().getFullYear();

/* NAV */
(function(){
  const header = $('#site-header'), btn = $('#menuBtn'), nav = $('#siteNav');
  btn && btn.addEventListener('click', ()=>{ const open=header.classList.toggle('open'); btn.setAttribute('aria-expanded', open?'true':'false'); });
  nav && nav.addEventListener('click', e=>{ if (e.target && e.target.tagName==='A'){ header.classList.remove('open'); btn && btn.setAttribute('aria-expanded','false'); }});
})();

/* Modal viewer */
function toYouTubeEmbed(url){
  try{
    const u=new URL(url);
    if (u.hostname.includes('youtube.com')){
      if (u.pathname==='/watch' && u.searchParams.get('v')) return 'https://www.youtube.com/embed/'+u.searchParams.get('v');
      if (u.pathname.startsWith('/embed/')) return url;
    }
    if (u.hostname==='youtu.be') return 'https://www.youtube.com/embed/'+u.pathname.slice(1);
  }catch(_){}
  return null;
}
function openViewer(href){
  const viewer = $('#viewer'), body = $('#viewerBody'); body.innerHTML='';
  const yt = toYouTubeEmbed(href);
  if (yt) body.innerHTML = `<iframe src="${esc(yt)}" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`;
  else if (/^https?:/.test(href)) body.innerHTML = `<video controls playsinline src="${esc(href)}"></video>`;
  else { window.open(href,'_blank','noopener'); return; }
  viewer.classList.add('open');
}
(function(){
  const vc = $('#viewerClose'), v = $('#viewer');
  vc && vc.addEventListener('click', ()=> v.classList.remove('open'));
  v && v.addEventListener('click', e=>{ if(e.target.id==='viewer') v.classList.remove('open'); });
})();

/* Rows */
function metricRow(label, value){
  const v = +value || 0;
  return `
    <div class="metric">
      <div class="name">${esc(deMoji(label))}</div>
      <div class="bar"><span class="${band(v)}" style="width:${v}%"></span></div>
      <div class="pct">${v}%</div>
    </div>`;
}
function phaseRow(p, i){
  const id    = p.id || ('P'+(i+1));
  const name  = deMoji(p.title || p.name || '');
  const short = deMoji(p.label || p.short || '');
  const long  = deMoji(p.long  || p.description || '');
  const gRaw  = (p.grade || p.status || 'ok').toString().toLowerCase();
  const grade = (gRaw==='bad') ? 'NEEDS HELP' : gRaw.toUpperCase();
  const ref   = p.url || p.ref || p.video || p.video_url || '';
  const btn   = ref ? `<button class="btn videoBtn" data-href="${esc(ref)}">${/youtu(\.be|be\.com)/.test(ref)?'YouTube':'Video'}</button>` : '';
  return `
    <details class="panel" ${i===0?'open':''}>
      <summary>
        <span class="pnum">${esc(id)}</span>
        <span class="pname">${esc(name)}</span>
        <span class="gchip ${gRaw==='good'?'g-good':gRaw==='ok'?'g-ok':'g-bad'}">${grade}</span>
        ${short?`<span class="sub" style="margin-left:8px">${esc(short)}</span>`:''}
        <svg class="caret" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"/></svg>
      </summary>
      <div class="content">
        ${short?`<div class="sub" style="margin-bottom:8px">${esc(short)}</div>`:''}
        ${long?`<div style="margin-bottom:10px">${esc(long)}</div>`:''}
        ${btn}
      </div>
    </details>`;
}
function listBlock(items){
  if (!items || !items.length) return '<div class="sub">None listed.</div>';
  return `<ul class="clean">` + items.map(x=>`<li>${esc(deMoji(x.title||x.name||x))}</li>`).join('') + `</ul>`;
}
function drillsBlock(drills){
  if (!drills || !drills.length) return '<div class="sub">None listed.</div>';
  return `<ul class="clean">` + drills.map(d=>{
    const bits = [
      deMoji(d.title || d.name || 'Drill'),
      d.fault ? ` â€” ${deMoji(d.fault)}` : '',
      d.how   ? ` â€” ${deMoji(d.how)}`   : ''
    ].join('');
    const ref = d.ref || d.url || d.video;
    const link = ref ? ` <a class="btn" style="padding:2px 8px;margin-left:6px" href="${esc(ref)}" target="_blank" rel="noopener">Video</a>` : '';
    return `<li>${esc(bits)}${link}</li>`;
  }).join('') + `</ul>`;
}

/* Render (legacy + ROM) */
let __lastReport = null;
function render(data){
  __lastReport = data;

  $('#date').textContent = deMoji(data.date) || new Date().toLocaleDateString();
  $('#modeLabel').textContent = deMoji(data.mode || data.discipline || 'Full Swing');
  if (data.swings != null) $('#swingCount').textContent = String(data.swings);

  const phases = Array.isArray(data.phases) ? data.phases : [];
  $('#plist').innerHTML = phases.length ? phases.map(phaseRow).join('') : '<div class="sub">No phases found.</div>';
  document.querySelectorAll('.videoBtn').forEach(b => b.addEventListener('click', function(){ openViewer(this.dataset.href); }));

  const pos = data.positionConsistency || data.position_metrics || [];
  $('#position').innerHTML = pos.length ? pos.map(m => metricRow(m.label||m.position||m.p||m.name||'', m.value)).join('') : '<div class="sub">No position metrics.</div>';

  const swing = data.swingConsistency ? [{label:'Tempo Ratio', value:data.swingConsistency.value}] : (data.swing_metrics || []);
  $('#swing').innerHTML = swing.length ? swing.map(m => metricRow(m.label||m.name||'', m.value)).join('') : '<div class="sub">No swing metrics.</div>';

  const p = data.powerScoreSummary || data.power || {};
  const pHtml =
    (p.value!=null ? metricRow('Power Score', p.value) : (p.score!=null ? metricRow('Power Score', p.score) : '')) +
    (p.tempo ? `<div class="metric"><div class="name">Tempo</div><div class="bar"><span class="ok" style="width:76%"></span></div><div class="pct">${esc(deMoji(p.tempo))}</div></div>` : '') +
    (p.release_timing!=null ? metricRow('Release Timing', p.release_timing) : '');
  $('#power').innerHTML = pHtml || '<div class="sub">No power metrics.</div>';

  $('#fundamentals').innerHTML = listBlock(data.fundamentals || data.top3_fundamentals || []);
  $('#powerErrors').innerHTML  = listBlock(data.power_errors   || data.errors || data.top3_power_errors || []);
  $('#quickFixes').innerHTML   = listBlock(data.quick_fixes    || data.quickFixes || data.top3_quick_fixes || []);
  $('#faults').innerHTML       = listBlock(data.faults || []);
  $('#drills').innerHTML       = drillsBlock(data.drills || []);

  setPill(true);
}
function setPill(ok){
  const pill = $('#statusPill');
  pill.textContent = ok ? 'Loaded âœ“' : 'Load failed';
  pill.style.borderColor = ok ? '#2a6' : 'rgba(255,255,255,.18)';
  pill.style.background  = ok ? 'rgba(25,195,125,.18)' : 'rgba(255,255,255,.10)';
}

/* Boot */
(async function(){
  $('#date').textContent = new Date().toLocaleDateString();
  const srcUrl = (reportParam && reportParam !== 'local') ? reportParam : 'report.json';
  try{
    const r = await fetch(srcUrl, {cache:'no-store'});
    if(!r.ok) throw new Error('HTTP '+r.status);
    const j = await r.json();
    render(j?.data?.report || j?.report || j);
  }catch(e){
    console.error(e);
    setPill(false);
    $('#plist').innerHTML = '<div class="sub">Failed to load report.</div>';
  }
})();

/* Share / download */
function shareUrl(){
  try{ const u = new URL(location.href); if (reportParam) u.searchParams.set('report', reportParam); return u.toString(); }
  catch(_){ return location.href; }
}
$('#btnCopy')?.addEventListener('click', async ()=>{
  const link = shareUrl();
  try{ await navigator.clipboard.writeText(link); alert('Share link copied'); }
  catch(_){ prompt('Copy link:', link); }
});
$('#btnSend')?.addEventListener('click', ()=>{
  const email = prompt('Coach email (e.g. coach@example.com):'); if(!email) return;
  const p = __lastReport?.powerScoreSummary?.value ?? __lastReport?.power?.score ?? '-';
  const subject = encodeURIComponent('Virtual Coach AI Swing Report');
  const body = encodeURIComponent('Here is my swing report:\n' + shareUrl() + '\n\nPower ' + p + '%\n\nâ€” sent from virtualcoachai.net');
  location.href = 'mailto:' + email + '?subject=' + subject + '&body=' + body;
});
$('#btnDownload')?.addEventListener('click', ()=>{
  const css = document.querySelector('style').textContent;
  const sect = id => (document.getElementById(id)?.innerHTML)||'';
  const txt = id => (document.getElementById(id)?.textContent)||'';
  const html = [
    '<!doctype html><html lang="en"><head>
<meta http-equiv="Cache-Control" content="no-store, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0"><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>',
    '<title>Virtual Coach AI â€” Swing Report</title><style>'+css+'</style></head><body style="background:#0b1520">',
    '<main class="wrap" style="width:900px;max-width:94%;margin:20px auto">',
    '<header class="hdr" style="margin-bottom:10px">
<meta http-equiv="Cache-Control" content="no-store, max-age=0">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0"><div><div class="title">Swing Report â€” P1–P9</div><div class="sub">Date: <strong>'+esc(txt('date'))+'</strong> â€¢ Mode: <strong>'+esc(txt('modeLabel'))+'</strong></div></div><div><span class="badge">Swings: <span>'+esc(txt('swingCount'))+'</span></span></div></header>',
    '<section class="card"><h3>P1–P9</h3><div class="content">'+sect('plist')+'</div></section>',
    '<section class="grid2"><div class="card"><h3>Position Consistency</h3><div class="content">'+sect('position')+'</div></div><div class="card"><h3>Swing Consistency</h3><div class="content">'+sect('swing')+'</div></div></section>',
    '<section class="card"><h3>Power Score Summary</h3><div class="content">'+sect('power')+'</div></section>',
    '<section class="card"><h3>Top 3 Fundamentals</h3><div class="content">'+sect('fundamentals')+'</div></section>',
    '<section class="card"><h3>Top 3 Power Errors</h3><div class="content">'+sect('powerErrors')+'</div></section>',
    '<section class="card"><h3>Top 3 Quick Fixes</h3><div class="content">'+sect('quickFixes')+'</div></section>',
    '<section class="card"><h3>Faults</h3><div class="content">'+sect('faults')+'</div></section>',
    '<section class="card"><h3>Drills</h3><div class="content">'+sect('drills')+'</div></section>',
    '</main></body></html>'
  ].join('\n');
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([html], {type:'text/html'}));
  a.download = 'swing-report.html';
  document.body.appendChild(a); a.click(); a.remove();
  setTimeout(()=> URL.revokeObjectURL(a.href), 1000);
});
</script>
</body>
</html>


