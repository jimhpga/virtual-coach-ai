<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Virtual Coach AI — Swing Report</title>
<meta name="robots" content="noindex, nofollow" />
<style>
  :root{ --fg:#f5f5f5; --bg:#0a0a0a; --line:rgba(255,255,255,0.16);
         --muted:rgba(255,255,255,0.75);
         --good:#16a34a; --warn:#eab308; --bad:#ef4444; --accent:#1F6F1F; }
  html,body{ height:100%; margin:0; padding:0; color:var(--fg);
             font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
             background: var(--bg) url("homepage-background.png") center / cover no-repeat fixed;
             filter: brightness(1.08) contrast(1.03); }
  body{ min-height:-webkit-fill-available; }
  .wrap{ max-width: 1100px; margin:0 auto; padding:48px 20px; text-shadow:0 1px 2px rgba(0,0,0,0.25); }
  h1{ margin:0 0 6px; font-size:32px; }
  .muted{ color:var(--muted); }
  .card{ border:1px solid var(--line); border-radius:12px; background:rgba(0,0,0,0.25); padding:14px 16px; margin:14px 0; }
  .chips{ display:flex; gap:8px; flex-wrap:wrap; margin:8px 0 16px; }
  .chip{ border:1px solid var(--line); border-radius:999px; padding:6px 10px; font-size:13px; }
  .pill{ padding:3px 8px; border-radius:999px; font-size:12px; border:1px solid var(--line);}
  .g{ background:rgba(22,163,74,0.18); border-color:var(--good); }
  .y{ background:rgba(234,179,8,0.18);  border-color:var(--warn); }
  .r{ background:rgba(239,68,68,0.18);  border-color:var(--bad); }
  table{ width:100%; border-collapse:collapse; font-size:14px; }
  th, td{ padding:10px; border-bottom:1px solid var(--line); vertical-align:top; text-align:left; }
  th{ color:#fff; font-weight:700; }
  .legend{ display:flex; gap:10px; flex-wrap:wrap; margin:8px 0 12px; font-size:13px; }
  .dot{ width:10px; height:10px; border-radius:50%; display:inline-block; margin-right:6px; }
  .cta{ display:inline-block; margin-top:14px; padding:10px 14px; border-radius:10px; background:var(--accent); color:#fff; text-decoration:none; font-weight:700; }
</style>
</head>
<body>
<div class="wrap">
  <h1>Swing Report</h1>
  <div class="muted">ID: <span id="rid">—</span></div>
  <div class="muted">Profile: <span id="profile">—</span></div>

  <div class="legend">
    <div><span class="dot g" style="background:var(--good)"></span>Good</div>
    <div><span class="dot y" style="background:var(--warn)"></span>Okay</div>
    <div><span class="dot r" style="background:var(--bad)"></span>Needs Work</div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">Tempo</h3>
    <div class="chips" id="tempoChips"></div>
    <div class="muted">Target repeatable ~3:1. Keep a small pause; don’t rush P4→P5.</div>
  </div>

  <div class="card" id="miCard" style="border-color:#bae6fd;background:rgba(59,130,246,0.08)">
    <h3 style="margin:0 0 8px">Most Important for Consistency</h3>
    <div id="miBody" class="muted">—</div>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">P1–P9 Assessment</h3>
    <table>
      <thead>
        <tr>
          <th style="width:22%">Checkpoint</th>
          <th style="width:12%">Status</th>
          <th style="width:28%">Short Description</th>
          <th>Long Description</th>
        </tr>
      </thead>
      <tbody id="cpRows"></tbody>
    </table>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">Top 3 Things to Work On</h3>
    <ol id="top3work" class="muted"></ol>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">Top 3 Power Builders</h3>
    <ol id="top3power" class="muted"></ol>
  </div>

  <div class="card">
    <h3 style="margin:0 0 8px">Power Assessment</h3>
    <div id="powerBody" class="muted">—</div>
  </div>

  <a href="/" class="cta">Upload Another Swing</a>
</div>

<script>
  const id = new URLSearchParams(location.search).get('id') || 'local-demo';
  document.getElementById('rid').textContent = id;

  // profile (from upload selections)
  const handed = sessionStorage.getItem('vc_last_handed') || 'right';
  const eye    = sessionStorage.getItem('vc_last_eye') || 'unknown';
  document.getElementById('profile').textContent =
    `${handed === 'left' ? 'Left' : 'Right'}-handed, ` +
    (eye === 'left' ? 'Left-eye dominant' : eye === 'right' ? 'Right-eye dominant' : 'eye dominance: unknown');

  const raw = sessionStorage.getItem('vc_report_' + id);
  if (!raw) {
    document.querySelector('.wrap').insertAdjacentHTML('beforeend',
      '<div class="card">No report data. Please upload again from the homepage.</div>');
  } else {
    const j = JSON.parse(raw);

    // Tempo
    const t = j.tempo || {};
    document.getElementById('tempoChips').innerHTML = `
      <span class="chip">Backswing: ${t.backswing ?? '—'}s</span>
      <span class="chip">Pause: ${t.pause ?? '—'}s</span>
      <span class="chip">Downswing: ${t.downswing ?? '—'}s</span>
      <span class="chip">Ratio: ${t.ratio ?? '—'}:1</span>
    `;

    // Most Important
    const mi = j.mostImportant || {};
    document.getElementById('miBody').innerHTML =
      mi.title
        ? `<b>${mi.title}</b><br>${mi.why || ''}${mi.drill ? `<br><i>Drill:</i> ${mi.drill}` : ''}`
        : '—';

    // P1–P9 rows (Status + Short + Long)
    const rows = document.getElementById('cpRows');
    const cps = Array.isArray(j.checkpoints) ? j.checkpoints : [];
    const order = ['P1','P2','P3','P4','P5','P6','P7','P8','P9'];
    const byId = Object.fromEntries(cps.map(x => [x.id, x]));
    rows.innerHTML = order.map(pid => {
      const c = byId[pid] || { id: pid, title: pid, status: 'y', noteShort: '', noteLong: '' };
      const badge = c.status === 'g' ? 'g' : (c.status === 'r' ? 'r' : 'y');
      return `<tr>
        <td><b>${c.id}</b> — ${c.title || ''}</td>
        <td><span class="pill ${badge}">${badge==='g'?'Good':badge==='y'?'Okay':'Needs Work'}</span></td>
        <td>${c.noteShort || ''}</td>
        <td>${c.noteLong || ''}</td>
      </tr>`;
    }).join('');

    // Top 3 Work-On
    const w = Array.isArray(j.top3WorkOn) ? j.top3WorkOn : [];
    document.getElementById('top3work').innerHTML =
      w.map(x => `<li><b>${x.title || ''}</b> — ${x.why || ''}${x.drill ? `<br><i>Drill:</i> ${x.drill}` : ''}</li>`).join('');

    // Top 3 Power
    const p = Array.isArray(j.top3Power) ? j.top3Power : [];
    document.getElementById('top3power').innerHTML =
      p.map(x => `<li><b>${x.title || ''}</b> — ${x.why || ''}${x.drill ? `<br><i>Drill:</i> ${x.drill}` : ''}</li>`).join('');

    // Power Assessment
    const pa = j.powerAssessment || {};
    const seq = pa.kinematicSequence === 'g' ? 'Good' : pa.kinematicSequence === 'r' ? 'Needs Work' : 'Okay';
    const lbe = pa.lowerBodyEngagement === 'g' ? 'Good' : pa.lowerBodyEngagement === 'r' ? 'Needs Work' : 'Okay';
    const notes = Array.isArray(pa.notes) ? pa.notes.map(n=>`• ${n}`).join('<br>') : '';
    document.getElementById('powerBody').innerHTML = `
      <div><b>Clubhead Speed (est.):</b> ${pa.clubheadSpeedEstimate || '—'}</div>
      <div><b>Kinematic Sequence:</b> ${seq}</div>
      <div><b>Lower-Body Engagement:</b> ${lbe}</div>
      ${notes ? `<div style="margin-top:6px">${notes}</div>` : ''}
    `;
  }
</script>
</body>
</html>
