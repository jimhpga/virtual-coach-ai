<script>
  const id = new URLSearchParams(location.search).get('id') || 'local-demo';
  document.getElementById('rid').textContent = id;

  (function load() {
    const raw = sessionStorage.getItem('vc_report_' + id);
    if (!raw) {
      console.warn('No cached report. Re-run analysis from home.');
      return;
    }
    const j = JSON.parse(raw);

    // Tempo chips
    const chips = document.querySelector('.chips');
    if (chips && j.tempo) {
      chips.innerHTML = `
        <span class="chip g">Backswing: ${j.tempo.backswing}s</span>
        <span class="chip g">Pause: ${j.tempo.pause}s</span>
        <span class="chip g">Downswing: ${j.tempo.downswing}s</span>
        <span class="chip g">Ratio: ${j.tempo.ratio}:1</span>
      `;
    }

    // P1â€“P9 flags (assumes your table order is P1..P9)
    const cells = document.querySelectorAll('tbody tr td:last-child .pill');
    if (j.pFlags && cells.length >= 9) {
      j.pFlags.slice(0,9).forEach((flag, i) => {
        const el = cells[i]; if (!el) return;
        el.classList.remove('g','y','r');
        el.classList.add(flag);
        el.textContent = flag === 'g' ? 'Good' : (flag === 'y' ? 'Okay' : 'Needs Work');
      });
    }

    // Top 3 lists
    const work = document.getElementById('top3work');
    const power = document.getElementById('top3power');
    if (work && j.top3WorkOn) work.innerHTML = j.top3WorkOn.map(x=>`<li><b>${x}</b></li>`).join('');
    if (power && j.top3Power) power.innerHTML = j.top3Power.map(x=>`<li><b>${x}</b></li>`).join('');
  })();

  // Fill Available Reports with the current item on top (optional)
  const rows = document.getElementById('reportRows');
  if (rows) {
    rows.innerHTML = `
      <tr>
        <td>${new Date().toLocaleDateString()}</td>
        <td>7i</td>
        <td><span class="pill g">3:1</span></td>
        <td><span class="pill g">Good</span></td>
        <td><a class="cta" style="padding:6px 10px; font-size:13px;" href="summary.html?id=${id}">Open</a></td>
      </tr>
    `;
  }
</script>

