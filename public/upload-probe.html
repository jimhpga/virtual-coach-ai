<!doctype html><meta charset="utf-8"><title>Upload Probe</title>
<pre id="out">Running...
</pre>
<script>
const out = (m)=>{ document.getElementById('out').textContent += m+"\n"; };
(async()=>{
  try{
    out("Requesting signed URL...");
    const r = await fetch('/api/upload', { method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ jobId:'smoke', key:'uploads/smoke.txt', contentType:'text/plain' }) });
    const j = await r.json(); out("upload api: "+r.status+" "+JSON.stringify(j));
    if (!r.ok || !j.url) return;

    out("PUT tiny text to S3...");
    const put = await fetch(j.url, { method:'PUT', body:new Blob(["smoke"],{type:'text/plain'}) });
    out("PUT result: "+put.status);

    out("Mark status ready...");
    const rr = await fetch('/api/report', { method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ jobId:'smoke', status:'ready', data:{ t: Date.now() }}) });
    out("report api: "+rr.status);

    out("Check analyze...");
    const aa = await fetch('/api/analyze?jobId=smoke');
    out("analyze api: "+aa.status+" "+await aa.text());
  }catch(e){ out("Error: "+e.message); }
})();
</script>


