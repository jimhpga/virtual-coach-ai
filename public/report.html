<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Virtual Coach AI — Swing Report</title>
<link rel="stylesheet" href="/styles.css" />
<style>
  :root{--glass:rgba(255,255,255,.04)}
  .wrap { max-width: 1100px; margin: 0 auto; padding: 20px; }
  .pill { background:#0f1b22;border:1px solid var(--line);border-radius:999px;padding:4px 10px;font-weight:700 }
  .meta-row { display:flex; flex-wrap:wrap; gap:8px; align-items:center }
  .card { background:var(--glass); border:1px solid var(--line); border-radius:14px; padding:12px; box-shadow:0 6px 14px rgba(0,0,0,.25) }
  .card h3 { margin: 0 0 10px; }
  .muted { color: var(--muted); }
  .grid2 { display:grid; grid-template-columns: 1fr 1fr; gap:14px; }
  .grid3 { display:grid; grid-template-columns: repeat(3, 1fr); gap:14px; }
  .bar { height:8px; border-radius:999px; background:#0f1b22; border:1px solid var(--line); overflow:hidden; }
  .bar > i { display:block; height:100%; width:0%; background:var(--accent, #4ad0ff); transition: width .5s ease; }
  .section-title { display:flex; align-items:center; justify-content:space-between; margin:0 0 8px; }
  .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; font-size:12px; }
  .pill-tiny { font-size: 12px; padding: 3px 8px; border-radius: 999px; border:1px solid var(--line); background:#0f1b22 }
  .pgrid{ display:grid; grid-template-columns: 1fr; gap:14px; } /* STACK */
  .p-card { background:rgba(255,255,255,.03); border:1px solid var(--line); border-radius:14px; padding:12px; box-shadow:0 6px 14px rgba(0,0,0,.25); }
  .p-card h4 { margin:0 0 6px; font-size:15px }
  .p-card .short { color:var(--muted); margin-bottom:8px }
  .p-card .row { display:flex; gap:8px; align-items:center; flex-wrap:wrap }
  .btn-sm, .btn { border:1px solid var(--line); padding:6px 10px; border-radius:8px; background:#0f1b22; color:#fff; text-decoration:none; cursor:pointer }
  .btn-sm:hover, .btn:hover { background:#122734 }
  .btn.primary{ background:#2b7cff; border-color:#2b7cff}
  .btn.primary:hover{ filter:brightness(1.05) }
  details.p1long { margin-top:6px }
  details.p1long summary { cursor:pointer; list-style:none; }
  details.p1long summary::-webkit-details-marker{ display:none }
  details.p1long summary .caret { display:inline-block; transform: rotate(0deg); transition: transform .2s ease; }
  details[open].p1long summary .caret { transform: rotate(90deg); }
  .list-tight > div { margin:6px 0; }
  .list-dot { padding-left:18px }
  .list-dot li { margin:4px 0 }
  .accordion { border:1px solid var(--line); border-radius:14px; overflow:hidden }
  .ac-head { background:rgba(255,255,255,.03); padding:10px 12px; display:flex; align-items:center; justify-content:space-between; cursor:pointer }
  .ac-body { padding:12px; display:none }
  .ac-open .ac-body { display:block }
  .ac-open .caret { transform: rotate(90deg); }
  .hide { display:none !important; }
  .infobox { font-size:12px; color:var(--muted) }
  .kpis{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  @media (max-width: 900px) {
    .grid3 { grid-template-columns: 1fr; }
    .grid2 { grid-template-columns: 1fr; }
    .pgrid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<header class="site">
  <div class="navwrap">
    <a class="brand" href="/"><img src="/virtualcoach-logo-transparent.png" alt="Virtual Coach AI"><span>Virtual Coach AI</span></a>
    <nav aria-label="Primary">
      <a href="/">Home</a>
      <a href="/upload">Upload</a>
      <a href="/reports">Reports</a>
      <a href="/coming-soon">Coming&nbsp;Soon</a>
      <a href="/pricing">Pricing</a>
      <a href="/faq">FAQ</a>
      <a href="/contact">Contact</a>
      <a href="/about">About</a>
    </nav>
  </div>
</header>

<div class="scrim">
  <main class="wrap" id="app">
    <h1 style="margin-bottom:6px">Swing Report — P1–P9</h1>
    <div class="meta-row muted" id="metaRow"></div>

    <!-- Personalize -->
    <section class="card" style="margin-top:12px">
      <div class="section-title"><h3>Personalize with AI</h3></div>
      <div class="kpis">
        <label>Level:
          <select id="levelSelect">
            <option value="beginner">Beginner</option>
            <option value="intermediate" selected>Intermediate</option>
            <option value="advanced">Advanced</option>
          </select>
        </label>

        <label>Goals:
          <select id="goalsSelect" multiple size="3" style="min-width:240px">
            <option value="swing_plane">Swing plane</option>
            <option value="hand_plane">Hand plane</option>
            <option value="tempo">Tempo (3:1)</option>
            <option value="release_timing">Release timing</option>
            <option value="face_to_path">Face-to-path</option>
            <option value="ground_forces">Ground forces</option>
          </select>
        </label>

        <button class="btn primary" id="aiBtn">Generate with AI</button>
        <button class="btn" id="saveBtn">Save</button>
      </div>
      <div class="infobox" style="margin-top:6px">Tip: choose a level and a few goals, then “Generate with AI” to fill coaching card, consistency notes, longer P1–P9 details, and the Swing Summary automatically.</div>
    </section>

    <!-- SUMMARY STRIP -->
    <section class="grid3" style="margin-top:14px">
      <div class="card">
        <div class="section-title">
          <h3>Coaching Card</h3>
        </div>
        <div class="grid2">
          <div>
            <div class="muted" style="font-weight:700; margin-bottom:6px">Top 3 Priority Fixes</div>
            <div id="topPriority" class="list-tight"></div>
          </div>
          <div>
            <div class="muted" style="font-weight:700; margin-bottom:6px">Top 3 Power Fixes</div>
            <div id="topPower" class="list-tight"></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="section-title">
          <h3>Power Score Summary</h3>
        </div>
        <div class="list-tight">
          <div>
            <div class="muted">Power Score</div>
            <div class="bar"><i id="barScore"></i></div>
            <div class="mono" id="txtScore"></div>
          </div>
          <div>
            <div class="muted">Tempo</div>
            <div class="mono" id="txtTempo">—</div>
          </div>
          <div>
            <div class="muted">Release Timing</div>
            <div class="bar"><i id="barRelease"></i></div>
            <div class="mono" id="txtRelease"></div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="section-title"><h3>Consistency</h3></div>
        <div class="grid2">
          <div>
            <div class="muted" style="font-weight:700; margin-bottom:6px">Position Consistency</div>
            <div class="mono" id="posScore">—</div>
            <div id="posConsistency" class="infobox">—</div>
          </div>
          <div>
            <div class="muted" style="font-weight:700; margin-bottom:6px">Swing Consistency</div>
            <div class="mono" id="swScore">—</div>
            <div id="swingConsistency" class="infobox">—</div>
          </div>
        </div>
      </div>
    </section>

    <!-- PRACTICE PLAN ACCORDION -->
    <section style="margin-top:14px">
      <div class="accordion" id="planAcc">
        <div class="ac-head" role="button" tabindex="0">
          <div style="display:flex; gap:10px; align-items:center">
            <span class="caret">▶</span>
            <h3 style="margin:0">Practice Plan (optional)</h3>
          </div>
          <span class="pill-tiny" id="planCount">0 items</span>
        </div>
        <div class="ac-body">
          <div id="planList" class="list-dot"></div>
        </div>
      </div>
    </section>

    <!-- P1–P9 -->
    <section style="margin-top:14px">
      <h2 style="margin:0 0 8px">P1–P9</h2>
      <div class="pgrid" id="pGrid"></div>
      <div class="infobox" id="pGridEmpty" style="margin-top:8px"></div>
    </section>

    <!-- Swing Summary -->
    <section id="sumBox" class="card hide" style="margin-top:14px">
      <div class="section-title"><h3>Swing Summary</h3></div>
      <div class="grid3">
        <div>
          <div class="muted" style="font-weight:700;margin-bottom:6px">What you do well</div>
          <ul id="sumGood" class="list-dot"></ul>
        </div>
        <div>
          <div class="muted" style="font-weight:700;margin-bottom:6px">Needs attention</div>
          <ul id="sumNeeds" class="list-dot"></ul>
        </div>
        <div>
          <div class="muted" style="font-weight:700;margin-bottom:6px">Goals</div>
          <ul id="sumGoals" class="list-dot"></ul>
        </div>
      </div>
    </section>

    <!-- Note area -->
    <section id="noteBox" class="card hide" style="margin-top:14px">
      <h3 style="margin:0 0 8px">Note</h3>
      <div id="noteTxt" class="muted"></div>
    </section>

  </main>
</div>

<script>
/* ----------- CONFIG / HELPERS ----------- */
window.BLOB_PUBLIC_BASE =
  window.BLOB_PUBLIC_BASE || "https://yw0bpv5czlbqowjq.public.blob.vercel-storage.com";

const $ = s => document.querySelector(s);
const qp = new URLSearchParams(location.search);
const rid = qp.get('id');
const directUrl = qp.get('url');
const blobFromId = id =>
  `${window.BLOB_PUBLIC_BASE.replace(/\/+$/,'')}/reports/${encodeURIComponent(id)}.json?cb=${Date.now()}`;

function pct(n){ if(n==null||isNaN(n)) return 0; return Math.max(0, Math.min(100, Number(n))); }
function itemDiv(txt){ const d=document.createElement('div'); d.textContent=txt; return d; }
function youtubeLink(name){ return `https://www.youtube.com/results?search_query=${encodeURIComponent(name+' golf checkpoint')}`; }

/* ----------- RENDERERS ----------- */
function fillMeta(data){
  const row = $('#metaRow'); row.innerHTML='';
  const pills = [
    ['Score', (data.swingScore ?? data.score ?? '—')],
    ['Status', (data.status ?? '—')],
    ['Tempo', (data.power?.tempo ?? '—')],
    ['Release', (data.power?.release_timing != null ? (data.power.release_timing + '%') : '—')],
  ];
  pills.forEach(([k,v])=>{
    const s = document.createElement('span');
    s.className='pill';
    s.textContent = `${k}: ${v}`;
    row.appendChild(s);
  });
  const created = document.createElement('span');
  created.className = 'muted';
  created.style.marginLeft='8px';
  created.textContent = `Created: ${new Date().toLocaleString()}`;
  row.appendChild(created);
}

function setBars(data){
  const score = pct(data.power?.score ?? data.swingScore ?? 0);
  $('#barScore').style.width = score + '%';
  $('#txtScore').textContent = `${score}%`;
  const rel = pct(data.power?.release_timing ?? 0);
  $('#barRelease').style.width = rel + '%';
  $('#txtRelease').textContent = `${rel}%`;
  $('#txtTempo').textContent = data.power?.tempo ?? '—';
}

function setConsistency(data){
  const posS = data.consistency?.position?.score ?? data.positionConsistency?.score ?? null;
  const posN = data.consistency?.position?.note  ?? data.positionConsistency?.notes ?? '—';
  const swS  = data.consistency?.swing?.score    ?? data.swingConsistency?.score ?? null;
  const swN  = data.consistency?.swing?.note     ?? data.swingConsistency?.notes ?? '—';
  $('#posScore').textContent = posS != null ? `${posS}%` : '—';
  $('#posConsistency').textContent = posN || '—';
  $('#swScore').textContent = swS != null ? `${swS}%` : '—';
  $('#swingConsistency').textContent = swN || '—';
}

function setCoachingCard(data){
  const pri = (data.coachingCard?.topPriorityFixes || data.topPriorityFixes || data.top_priority_fixes || []).slice(0,3);
  const pow = (data.coachingCard?.topPowerFixes    || data.topPowerFixes    || data.top_power_fixes    || []).slice(0,3);
  const priBox = $('#topPriority'); priBox.innerHTML='';
  const powBox = $('#topPower'); powBox.innerHTML='';
  if(!pri.length) priBox.appendChild(itemDiv('—'));
  if(!pow.length) powBox.appendChild(itemDiv('—'));
  pri.forEach(x => priBox.appendChild(itemDiv('• ' + String(x))));
  pow.forEach(x => powBox.appendChild(itemDiv('• ' + String(x))));
}

function renderPGrid(data){
  const list = Array.isArray(data.p1p9 || data.phases) ? (data.p1p9 || data.phases) : [];
  const grid = $('#pGrid'); grid.innerHTML = '';
  const empty = $('#pGridEmpty'); empty.textContent='';

  if(!list.length){
    empty.textContent = 'No P1–P9 items in this report.';
    return;
  }

  list.forEach((p,i)=>{
    const idTxt = p.id || `P${i+1}`;
    const name  = p.name || p.title || idTxt;
    const grade = (p.grade || '').toString();
    const short = p.short || p.note || '—';
    const long  = p.long  || p.details || '';
    const video = p.video || youtubeLink(name);

    const c = document.createElement('div');
    c.className='p-card';

    const head = document.createElement('div');
    head.style.display = 'flex';
    head.style.alignItems = 'center';
    head.style.justifyContent = 'space-between';
    head.style.gap = '8px';

    const h4 = document.createElement('h4');
    h4.textContent = `${idTxt}. ${name}`;
    head.appendChild(h4);

    const g = document.createElement('span');
    g.className='pill-tiny';
   
