<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Virtual Coach AI — Report</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>body{font-family:system-ui,Segoe UI,Arial;max-width:900px;margin:24px auto;padding:0 12px}
  #video{width:100%;max-height:60vh}</style>
</head>
<body>
  <h1>Virtual Coach AI — Swing Report</h1>
  <p id="meta"></p>
  <video id="video" controls></video>
  <pre id="log" style="background:#111;color:#0f0;padding:8px;border-radius:6px;white-space:pre-wrap"></pre>

  <script>
  (async () => {
    const $ = (s) => document.querySelector(s);
    const log = (m) => { const el = $("#log"); el.textContent += (el.textContent ? "\n" : "") + m; };
    const params = new URLSearchParams(location.search);
    const key = params.get("key");

    async function setVideoFromKey(k) {
      const r = await fetch(`/api/get-url?key=${encodeURIComponent(k)}`);
      if (!r.ok) throw new Error("get-url failed " + r.status);
      const { url } = await r.json();
      $("#video").src = url;
      $("#meta").textContent = `Object: ${k}`;
      log("Loaded presigned GET for playback.");
    }

    if (key) {
      try {
        localStorage.setItem("vcai:lastKey", key);
        await setVideoFromKey(key);
      } catch (e) {
        log("Error loading key: " + (e.message || e));
      }
    } else {
      const last = localStorage.getItem("vcai:lastKey");
      if (last) {
        log("No key in URL; loading last uploaded video.");
        try { await setVideoFromKey(last); } catch (e) { log("Fallback failed: " + e.message); }
      } else {
        log("No key provided and no previous upload found.");
      }
    }
  })();
  </script>
</body>
</html>
