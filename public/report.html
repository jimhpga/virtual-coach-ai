<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Virtual Coach AI â€” Swing Report</title>
<link rel="stylesheet" href="/styles.css" />
<style>
  body { background:#020b11; color:#f3f3f3; font-family:system-ui, sans-serif; }
  .wrap { max-width:1100px; margin:0 auto; padding:20px; }
  .card { background:rgba(255,255,255,.03); border:1px solid #223; border-radius:14px; padding:16px; margin:14px 0; box-shadow:0 5px 10px rgba(0,0,0,.25);}
  h1,h2,h3,h4 { margin:0 0 10px }
  .pill { background:#111c22; border:1px solid #333; border-radius:999px; padding:4px 10px; font-weight:700; margin-right:6px; display:inline-block }
  .pill-tiny { font-size:12px; border-radius:999px; border:1px solid #333; padding:3px 8px; background:#111c22 }
  .g-good{background:#19c37d;color:#001e0d}
  .g-ok{background:#f6c453;color:#2a2300}
  .g-bad{background:#ff6b6b;color:#fff}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:14px;}
  @media(max-width:900px){.grid2{grid-template-columns:1fr}}
  .fix { margin-bottom:10px; }
  .fix .short { color:#ccc; line-height:1.45; }
  .expand-btn { display:inline-block; margin-top:4px; font-size:12px; color:#4ad0ff; cursor:pointer; }
  .hidden { display:none; }
  .p-card{border:1px solid #333;border-radius:14px;padding:14px;margin:10px 0;}
  .short{color:#ccc;line-height:1.55}
  .btn-sm{border:1px solid #333;padding:5px 10px;border-radius:8px;background:#111c22;color:#fff;text-decoration:none}
</style>
</head>
<body>
<main class="wrap" id="app">
  <h1>Swing Report â€” P1â€“P9</h1>
  <div id="metaRow"></div>

  <section class="grid2">
    <div class="card">
      <h3>Coaching Card</h3>
      <div class="grid2">
        <div>
          <div><strong>Top 3 Priority Fixes</strong></div>
          <div id="topPriority"></div>
        </div>
        <div>
          <div><strong>Top 3 Power Fixes</strong></div>
          <div id="topPower"></div>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>Power & Consistency</h3>
      <div class="grid2">
        <div>
          <div>Power Score: <span id="score"></span></div>
          <div>Tempo: <span id="tempo"></span></div>
          <div>Release Timing: <span id="release"></span></div>
        </div>
        <div>
          <div><strong>Position Consistency</strong></div>
          <div id="posConsistency" style="color:#ccc"></div>
          <div style="margin-top:8px"><strong>Swing Consistency</strong></div>
          <div id="swingConsistency" style="color:#ccc"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ðŸ”¥ Power Leaks -->
  <section class="card">
    <h3>Top 3 Power Leaks</h3>
    <div id="powerLeaks"></div>
  </section>

  <section class="card">
    <h3>Summary of Your Swing</h3>
    <div id="summaryText"></div>
  </section>

  <section class="card">
    <h3>P1â€“P9 Swing Positions</h3>
    <div id="pCol"></div>
  </section>
</main>

<script>
const $ = s => document.querySelector(s);
async function getReport() {
  const p = new URLSearchParams(location.search);
  const url = p.get('url');
  const id  = p.get('id');
  const blob = url || `https://yw0bpv5czlbqowjq.public.blob.vercel-storage.com/reports/${id}.json`;
  const res = await fetch(blob);
  const data = await res.json();
  renderReport(data);
}

function makeFixCard(item) {
  const wrap = document.createElement('div'); wrap.className='fix';
  const title = document.createElement('div'); title.innerHTML = `<b>${item.title}</b>`; wrap.appendChild(title);
  const short = document.createElement('div'); short.className='short'; 
  short.textContent = `${(item.why||'').slice(0,80)}...`; wrap.appendChild(short);
  const expand = document.createElement('div'); expand.className='expand-btn'; expand.textContent='Expand';
  const long = document.createElement('div'); long.className='hidden short'; 
  long.innerHTML = `<b>Why:</b> ${item.why}<br><b>How:</b> ${item.how}`;
  expand.onclick=()=>{long.classList.toggle('hidden'); expand.textContent=long.classList.contains('hidden')?'Expand':'Collapse'};
  wrap.appendChild(expand); wrap.appendChild(long);
  return wrap;
}

function fillFixes(list, mount) {
  mount.innerHTML='';
  if(!list) return;
  list.forEach(it=>mount.appendChild(makeFixCard(it)));
}

function fillPowerLeaks() {
  const leaks = [
    { title:"Early Release", why:"Lag angle lost too soon reduces dynamic loft control.", how:"Feel trail wrist retain angle through impact; hit punch shots to train later release." },
    { title:"Weak Lead-Leg Brake", why:"Poor ground reaction force limits energy transfer.", how:"Perform wall-brace drill: post left hip against wall at impact feel." },
    { title:"Inconsistent Pressure Shift", why:"Improper timing of shift hurts kinematic sequence.", how:"Step-change drill: step into lead leg at start of downswing to time shift." }
  ];
  fillFixes(leaks,$('#powerLeaks'));
}

function fillP1P9(list) {
  const col=$('#pCol'); col.innerHTML='';
  (list||[]).forEach(p=>{
    const div=document.createElement('div');
    div.className='p-card';
    div.innerHTML=`<h4>${p.id||''} - ${p.name||''}</h4>
      <div class='short'>${p.short||''}</div>
      <div style='margin:8px 0'><a class='btn-sm' href='${p.video||"#"}' target='_blank'>Watch</a></div>
      <details><summary>More details</summary><div class='short'>${p.long||''}</div></details>`;
    col.appendChild(div);
  });
}

function renderReport(d){
  $('#score').textContent = (d.power?.score||d.swingScore||'') + '%';
  $('#tempo').textContent = d.power?.tempo||'';
  $('#release').textContent = (d.power?.release_timing||'') + '%';
  $('#posConsistency').textContent = d.positionConsistency?.notes||'';
  $('#swingConsistency').textContent = d.swingConsistency?.notes||'';
  $('#summaryText').textContent = d.summary_long||d.summary||'';
  fillFixes(d.topPriorityFixes,$('#topPriority'));
  fillFixes(d.topPowerFixes,$('#topPower'));
  fillPowerLeaks();
  fillP1P9(d.p1p9);
}
getReport();
</script>
</body>
</html>
