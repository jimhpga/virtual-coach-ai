<!-- LOCKED SWING REPORT TEMPLATE - DO NOT EDIT. COPY THIS FILE IF YOU NEED A NEW VERSION. -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Virtual Coach AI – Swing Report</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        color-scheme: dark;
        --bg-main: radial-gradient(circle at top left, #182438 0, #050814 45%, #02030a 100%);
        --card-bg: rgba(10, 18, 32, 0.96);
        --card-bg-soft: rgba(12, 22, 40, 0.9);
        --border-subtle: rgba(110, 140, 190, 0.35);
        --accent: #38f18a;
        --accent-soft: rgba(56, 241, 138, 0.14);
        --accent-yellow: #ffc857;
        --accent-red: #ff5573;
        --text-main: #f5f7ff;
        --text-soft: #a9b4d8;
        --pill-bg: rgba(22, 32, 52, 0.95);
        --pill-border: rgba(144, 178, 230, 0.55);
        --font-main: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
          "Segoe UI", sans-serif;
      }

      * {
        box-sizing: border-box;
      }

      html,
      body {
        margin: 0;
        padding: 0;
        font-family: var(--font-main);
        background: #02030a;
        color: var(--text-main);
      }

      body {
        min-height: 100vh;
        background-image: var(--bg-main);
        background-attachment: fixed;
        background-size: cover;
      }

      .page {
        max-width: 1180px;
        margin: 24px auto 40px;
        padding: 0 16px 40px;
      }

      @media (min-width: 1200px) {
        .page {
          margin-top: 32px;
        }
      }

      header.navbar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        margin-bottom: 18px;
      }

      .brand {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .brand-logo {
        width: 30px;
        height: 30px;
        border-radius: 999px;
        background: radial-gradient(circle at 30% 30%, #6bffb4, #12c96b 55%, #018442);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 18px;
        color: #03130a;
        box-shadow: 0 0 18px rgba(56, 241, 138, 0.5);
      }

      .brand-text {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .brand-text-main {
        font-size: 15px;
        letter-spacing: 0.06em;
        text-transform: uppercase;
        color: #e7f4ff;
      }

      .brand-text-sub {
        font-size: 11px;
        color: var(--text-soft);
      }

      .nav-actions {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      button.btn {
        border-radius: 999px;
        border: 1px solid rgba(129, 167, 228, 0.65);
        background: radial-gradient(circle at top left, rgba(34, 48, 88, 0.98), #090f26);
        color: #f2f6ff;
        padding: 7px 14px;
        font-size: 12px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        cursor: pointer;
        transition: background 0.15s ease, transform 0.1s ease, box-shadow 0.15s ease;
        white-space: nowrap;
      }

      button.btn-primary {
        border-color: transparent;
        background: linear-gradient(90deg, #32e27b, #15b4ff);
        color: #041017;
        box-shadow: 0 0 14px rgba(59, 236, 146, 0.5);
      }

      button.btn-ghost {
        border-style: solid;
      }

      button.btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 0 20px rgba(43, 132, 255, 0.45);
      }

      button.btn:active {
        transform: translateY(0);
        box-shadow: none;
      }

      main {
        display: flex;
        flex-direction: column;
        gap: 18px;
      }

      .top-grid {
        display: grid;
        grid-template-columns: minmax(0, 1.85fr) minmax(0, 1.2fr);
        gap: 16px;
      }

      @media (max-width: 900px) {
        .top-grid {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .card {
        background: var(--card-bg);
        border-radius: 16px;
        border: 1px solid var(--border-subtle);
        padding: 14px 16px 14px;
        box-shadow: 0 12px 40px rgba(4, 8, 20, 0.85);
      }

      .card-soft {
        background: var(--card-bg-soft);
      }

      .card-header-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-bottom: 10px;
      }

      .card-title {
        font-size: 14px;
        font-weight: 600;
        letter-spacing: 0.1em;
        text-transform: uppercase;
        color: #d9e6ff;
      }

      .card-subtitle {
        font-size: 11px;
        color: var(--text-soft);
      }

      .tag-row {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 6px;
        margin-bottom: 6px;
      }

      .tag-pill {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        border-radius: 999px;
        border: 1px solid rgba(125, 162, 231, 0.7);
        padding: 4px 8px;
        background: rgba(15, 26, 52, 0.98);
        color: #e2ecff;
      }

      .tag-pill-alt {
        border-color: rgba(86, 222, 141, 0.8);
        background: rgba(30, 90, 62, 0.9);
        color: #eafff4;
      }

      .player-summary-text {
        font-size: 13px;
        line-height: 1.58;
        color: var(--text-soft);
        margin-bottom: 10px;
      }

      .quick-list-title {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        color: #9eb4e6;
        margin-bottom: 4px;
      }

      .quick-list {
        margin: 0 0 4px;
        padding-left: 18px;
        font-size: 12px;
        line-height: 1.5;
        color: var(--text-soft);
      }

      .quick-list li {
        margin-bottom: 2px;
      }

      .summary-meta {
        font-size: 10px;
        color: rgba(147, 170, 220, 0.85);
        margin-top: 6px;
      }

      .summary-actions {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: flex-end;
        margin-top: 8px;
      }

      .btn-mini {
        padding: 4px 10px;
        font-size: 11px;
      }

      .scores-bars {
        margin-top: 8px;
        margin-bottom: 8px;
      }

      .score-row {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 4px;
      }

      .score-label {
        width: 70px;
        font-size: 11px;
        color: var(--text-soft);
      }

      .score-bar-shell {
        flex: 1;
        height: 7px;
        border-radius: 999px;
        background: radial-gradient(circle at top left, #141b30, #050714);
        overflow: hidden;
        border: 1px solid rgba(92, 130, 204, 0.6);
      }

      .score-bar-fill {
        height: 100%;
        border-radius: inherit;
        background: linear-gradient(90deg, #38f18a, #1ee5f9);
        width: 0;
        transition: width 0.4s ease-out;
      }

      .score-grade {
        width: 32px;
        text-align: right;
        font-size: 11px;
        color: #e7f5ff;
      }

      .power-columns {
        margin-top: 12px;
        display: grid;
        grid-template-columns: repeat(3, minmax(0, 1fr));
        gap: 10px;
      }

      @media (max-width: 900px) {
        .power-columns {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .power-col {
        background: radial-gradient(circle at top left, #141b2b, #060a16);
        border-radius: 12px;
        border: 1px solid rgba(103, 139, 211, 0.65);
        padding: 8px 9px 9px;
      }

      .power-col-title {
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.12em;
        color: #d5e4ff;
        margin-bottom: 4px;
      }

      .power-col-sub {
        font-size: 10px;
        color: var(--text-soft);
        margin-bottom: 4px;
      }

      .power-col ul {
        margin: 0;
        padding-left: 16px;
        font-size: 11px;
        color: var(--text-soft);
        line-height: 1.5;
      }

      .section-title-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 8px;
        margin-top: 6px;
        margin-bottom: 6px;
      }

      .section-title-row small {
        font-size: 11px;
        color: var(--text-soft);
      }

      .legend-row {
        display: flex;
        align-items: center;
        gap: 10px;
        font-size: 10px;
        color: var(--text-soft);
      }

      .legend-item {
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 999px;
      }

      .dot-green {
        background: var(--accent);
      }

      .dot-yellow {
        background: var(--accent-yellow);
      }

      .dot-red {
        background: var(--accent-red);
      }

      .checkpoint-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .checkpoint-card {
        background: rgba(8, 14, 30, 0.98);
        border-radius: 14px;
        border: 1px solid rgba(104, 141, 214, 0.7);
        padding: 9px 10px 10px;
      }

      .checkpoint-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 6px;
      }

      .checkpoint-left {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .phase-pill {
        min-width: 34px;
        text-align: center;
        font-size: 11px;
        padding: 4px 6px;
        border-radius: 999px;
        border: 1px solid rgba(114, 157, 230, 0.9);
        background: rgba(15, 26, 52, 0.98);
        color: #e7f2ff;
      }

      .phase-label {
        font-size: 13px;
        font-weight: 500;
        color: #eaf2ff;
      }

      .phase-note {
        font-size: 11px;
        color: var(--text-soft);
      }

      .status-pill {
        font-size: 10px;
        padding: 4px 8px;
        border-radius: 999px;
        border: 1px solid rgba(130, 172, 246, 0.85);
        background: var(--pill-bg);
        color: #e5eeff;
        text-transform: uppercase;
        letter-spacing: 0.09em;
      }

      .status-green {
        border-color: rgba(56, 241, 138, 0.9);
        background: rgba(13, 67, 46, 0.96);
        color: #dcffe9;
      }

      .status-yellow {
        border-color: rgba(255, 213, 112, 0.95);
        background: rgba(75, 56, 18, 0.96);
        color: #fff5da;
      }

      .status-red {
        border-color: rgba(255, 128, 160, 0.95);
        background: rgba(88, 20, 37, 0.96);
        color: #ffe5ef;
      }

      .checkpoint-body {
        display: grid;
        grid-template-columns: minmax(0, 1.2fr) minmax(0, 1fr) minmax(0, 1fr);
        gap: 12px;
        margin-bottom: 6px;
      }

      @media (max-width: 900px) {
        .checkpoint-body {
          grid-template-columns: minmax(0, 1fr);
        }
      }

      .checkpoint-col-title {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.15em;
        color: #aabbe7;
        margin-bottom: 3px;
      }

      .checkpoint-col-text {
        font-size: 11px;
        line-height: 1.5;
        color: var(--text-soft);
      }

      .checkpoint-col-text ul {
        margin: 0;
        padding-left: 16px;
      }

      .checkpoint-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 6px;
        margin-top: 4px;
        flex-wrap: wrap;
      }

      .checkpoint-buttons {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
      }

      .btn-chip {
        border-radius: 999px;
        border: 1px solid var(--pill-border);
        background: rgba(15, 22, 42, 0.98);
        color: #dfe8ff;
        font-size: 10px;
        padding: 3px 9px;
        cursor: pointer;
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .btn-chip-primary {
        border-color: rgba(67, 203, 132, 0.9);
        background: var(--accent-soft);
        color: #e1fff2;
      }

      .btn-chip:disabled {
        opacity: 0.6;
        cursor: default;
      }

      .ai-output {
        font-size: 11px;
        line-height: 1.5;
        color: #ccd9ff;
        border-radius: 10px;
        border: 1px dashed rgba(130, 166, 240, 0.8);
        background: rgba(7, 14, 34, 0.98);
        padding: 7px 8px;
        margin-top: 5px;
        display: none;
      }

      .ai-output.visible {
        display: block;
      }

      .ai-output-heading {
        font-size: 10px;
        text-transform: uppercase;
        letter-spacing: 0.14em;
        color: #9fb5ff;
        margin-bottom: 4px;
      }

      .ai-output-status {
        font-size: 10px;
        color: #7ab3ff;
        margin-bottom: 4px;
      }

      .practice-card {
        margin-top: 6px;
      }

      .practice-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 8px;
        margin-bottom: 4px;
      }

      .practice-body {
        font-size: 11px;
        line-height: 1.5;
        color: var(--text-soft);
      }

      .practice-day {
        margin-top: 4px;
        margin-bottom: 4px;
      }

      .practice-day strong {
        color: #e7f0ff;
      }

      .practice-toggle {
        font-size: 10px;
        color: #c5d6ff;
        cursor: pointer;
        border-radius: 999px;
        border: 1px solid rgba(128, 164, 240, 0.85);
        padding: 3px 9px;
        background: rgba(12, 19, 40, 0.95);
        display: inline-flex;
        align-items: center;
        gap: 4px;
      }

      .practice-body.collapsed {
        max-height: 0;
        overflow: hidden;
        opacity: 0;
        transition: max-height 0.2s ease-out, opacity 0.2s ease-out;
      }

      .practice-body.expanded {
        max-height: 600px;
        opacity: 1;
        transition: max-height 0.25s ease-out, opacity 0.25s ease-out;
      }

      .error-banner {
        display: none;
        margin-top: 6px;
        padding: 6px 8px;
        border-radius: 10px;
        border: 1px solid rgba(255, 146, 139, 0.85);
        background: rgba(60, 10, 21, 0.96);
        font-size: 11px;
        color: #ffe3e3;
      }

      .footer-note {
        margin-top: 10px;
        font-size: 10px;
        color: rgba(138, 157, 210, 0.85);
        text-align: right;
      }

      @media (max-width: 600px) {
        header.navbar {
          flex-direction: column;
          align-items: flex-start;
        }

        .nav-actions {
          align-self: stretch;
          justify-content: flex-start;
          flex-wrap: wrap;
        }

        .card {
          padding: 12px 13px 13px;
        }

        .player-summary-text {
          font-size: 12px;
        }

        .quick-list {
          font-size: 11px;
        }

        .checkpoint-header {
          align-items: flex-start;
          flex-direction: column;
        }

        .checkpoint-footer {
          align-items: flex-start;
          flex-direction: column;
        }

        .checkpoint-buttons {
          justify-content: flex-start;
        }
      }
    </style>
  </head>
  <body>
    <div class="page">
      <header class="navbar">
        <div class="brand">
          <div class="brand-logo">VC</div>
          <div class="brand-text">
            <div class="brand-text-main">Virtual Coach AI</div>
            <div class="brand-text-sub">Tour-level swing feedback from a single upload</div>
          </div>
        </div>
        <div class="nav-actions">
          <button
            type="button"
            class="btn btn-ghost"
            onclick="window.location.href='index.html';"
          >
            ← Back to home
          </button>
          <button
            type="button"
            class="btn btn-ghost"
            onclick="window.location.href='upload.html';"
          >
            ⬆ Upload another swing
          </button>
          <button type="button" class="btn btn-primary" onclick="window.print();">
            🖨 Print report
          </button>
        </div>
      </header>

      <main>
        <div class="top-grid">
          <section class="card card-soft" id="overview-card">
            <div class="card-header-row">
              <div>
                <div class="card-title">Player overview</div>
                <div class="card-subtitle" id="report-headline">
                  Solid fundamentally sound mid-iron swing with small opportunities to clean up
                  transition and low point control.
                </div>
              </div>
              <div class="card-subtitle" id="report-meta-line">
                Player: Player • Right hand / Right eye • Generated just now
              </div>
            </div>

            <div
              class="player-summary-text"
              id="player-summary-text"
              data-summary-text="Hi Player, thanks for sending in your swing. Big picture: this is a fundamentally solid motion with small opportunities to clean up transition and low point control."
            >
              Hi Player, thanks for sending in your swing. Big picture: this is a fundamentally
              solid motion with small opportunities to clean up transition and low point control.
              Your base setup and motion are strong enough to build real speed and consistency.
            </div>

            <div class="quick-list-title">Quick highlights</div>
            <ul class="quick-list" id="quick-highlights">
              <li>Athletic, balanced setup that supports a powerful coil.</li>
              <li>Good wrist hinge and width in the backswing.</li>
              <li>Clubface control is generally very good through impact.</li>
              <li>Transition timing can get a touch upper-body dominant.</li>
              <li>Low point control can tighten up for more compression.</li>
            </ul>

            <div class="tag-row" id="player-tags">
              <span class="tag-pill">Right hand</span>
              <span class="tag-pill">Right eye</span>
              <span class="tag-pill">Hcp 1</span>
              <span class="tag-pill">Height 6'0"</span>
              <span class="tag-pill-alt">Generated by Virtual Coach AI</span>
            </div>

            <div class="summary-meta" id="summary-meta">
              Report generated automatically from your latest upload. Use the checkpoints and
              practice plan below to work the changes in order.
            </div>

            <div class="summary-actions">
              <button
                type="button"
                class="btn btn-ghost btn-mini"
                onclick="playSummaryOutLoud();"
              >
                🔊 Play summary out loud
              </button>
            </div>

            <div class="error-banner" id="error-banner"></div>
          </section>

          <section class="card card-soft" id="power-card">
            <div class="card-header-row">
              <div>
                <div class="card-title">Power & reliability</div>
                <div class="card-subtitle">
                  Grades and power story for this swing.
                </div>
              </div>
              <div class="card-subtitle" id="power-meta">
                Grades A–F based on your model
              </div>
            </div>

            <div class="scores-bars">
              <div class="score-row">
                <div class="score-label">Overall swing</div>
                <div class="score-bar-shell">
                  <div class="score-bar-fill" id="bar-swing"></div>
                </div>
                <div class="score-grade" id="grade-swing">A-</div>
              </div>
              <div class="score-row">
                <div class="score-label">Speed & efficiency</div>
                <div class="score-bar-shell">
                  <div class="score-bar-fill" id="bar-power"></div>
                </div>
                <div class="score-grade" id="grade-power">B+</div>
              </div>
              <div class="score-row">
                <div class="score-label">Consistency & control</div>
                <div class="score-bar-shell">
                  <div class="score-bar-fill" id="bar-reliability"></div>
                </div>
                <div class="score-grade" id="grade-reliability">A-</div>
              </div>
            </div>

            <div class="power-columns">
              <div class="power-col">
                <div class="power-col-title">What you are doing well for power</div>
                <div class="power-col-sub">
                  These are the patterns that already support speed and solid contact.
                </div>
                <ul id="power-strengths-list">
                  <li>Athletic setup with clean spine tilt and balance.</li>
                  <li>Solid connection between arms and body in the takeaway.</li>
                  <li>Good wrist hinge that creates width and leverage.</li>
                </ul>
              </div>
              <div class="power-col">
                <div class="power-col-title">Where your power leaks out</div>
                <div class="power-col-sub">
                  Small inefficiencies that quietly bleed speed and compression.
                </div>
                <ul id="power-leaks-list">
                  <li>Upper body wants to start the downswing before the lower body.</li>
                  <li>Slight casting in the transition when you go after it hard.</li>
                  <li>Early extension under max effort swings.</li>
                </ul>
              </div>
              <div class="power-col">
                <div class="power-col-title">Top 3 fixes</div>
                <div class="power-col-sub">
                  Clean these up first. They give you the fastest return on practice.
                </div>
                <ul id="power-fixes-list">
                  <li>Clean up transition timing from the ground up.</li>
                  <li>Shallow the downswing a touch into the slot.</li>
                  <li>Keep pivot centered through impact for better low-point control.</li>
                </ul>
              </div>
            </div>
          </section>
        </div>

        <section class="card card-soft practice-card" id="checkpoints-card">
          <div class="section-title-row">
            <div class="card-title">P1–P9 checkpoints</div>
            <div class="legend-row">
              <span>Legend:</span>
              <span class="legend-item">
                <span class="status-dot dot-green"></span> On track
              </span>
              <span class="legend-item">
                <span class="status-dot dot-yellow"></span> Needs attention
              </span>
              <span class="legend-item">
                <span class="status-dot dot-red"></span> Priority fix
              </span>
            </div>
          </div>
          <div class="card-subtitle">
            Each phase shows coach notes, common misses, key drills, and AI help. Use the AI
            buttons if you want a deeper explanation or a different way to feel the change.
          </div>

          <div class="checkpoint-list" id="checkpoint-list"></div>
        </section>

        <section class="card card-soft practice-card" id="practice-card">
          <div class="practice-header">
            <div>
              <div class="card-title">14-day practice plan</div>
              <div class="card-subtitle" id="practice-overview">
                Next 14 days: lock in transition, shallow the downswing slightly, and keep the great
                fundamentals you already own.
              </div>
            </div>
            <button type="button" class="practice-toggle" id="practice-toggle">
              ▼ Show full plan
            </button>
          </div>
          <div class="practice-body collapsed" id="practice-body"></div>
        </section>

        <div class="footer-note">
          Virtual Coach AI – this is beta insight. If something does not fit, it is always your swing,
          your feel and your hand.
        </div>
      </main>
    </div>

    <script>
      // Demo fallback report – used if no report param loads correctly
      var fallbackReport = {
        meta: {
          playerName: "Player",
          generatedAt: "2024-06-13T12:00:00Z",
          hand: "right",
          eye: "right",
          handicap: "1",
          height: "6'0\"",
          notes:
            "High level amateur right-handed golfer with right eye dominance and good athletic build, swinging a mid-iron."
        },
        summary: {
          headline:
            "Solid fundamentally sound mid-iron swing with small opportunities to clean up transition and low point control.",
          bullets: [
            "Athletic, balanced setup that supports a powerful coil.",
            "Good wrist hinge and width in the backswing.",
            "Clubface control is generally very good through impact.",
            "Transition timing can get a touch upper-body dominant.",
            "Low point control can tighten up for more compression."
          ]
        },
        scores: {
          swing: { grade: "A-", label: "Overall mechanics" },
          power: { grade: "B+", label: "Speed and efficiency" },
          reliability: { grade: "A-", label: "Consistency and shotmaking" }
        },
        strengths: [
          "Athletic setup with clean spine tilt and balance.",
          "Solid connection between arms and body in the takeaway.",
          "Good wrist hinge that creates width and leverage.",
          "Clubface control is generally stable through impact.",
          "Finish is balanced with full rotation toward the target."
        ],
        priorityFixes: [
          {
            title: "Clean up transition timing",
            detail:
              "Start the downswing from the ground up: lead foot pressure, then hips, then torso, then arms. This will sharpen low point and contact."
          },
          {
            title: "Shallow the downswing a touch",
            detail:
              "Feel the club falling slightly behind you at P5–P6 instead of straight down. This reduces steepness and helps compress the ball."
          },
          {
            title: "Keep pivot centered through impact",
            detail:
              "Avoid sliding or backing away at impact. Stay centered and rotate so low point is in front of the ball more often."
          }
        ],
        powerLeaks: [
          "Upper body wants to start the downswing before the lower body.",
          "Slight casting in the transition when you go after it hard.",
          "Early extension under max effort swings.",
          "Downswing can get a fraction steep, costing you smash factor."
        ],
        checkpoints: [
          {
            id: "P1",
            label: "Setup",
            status: "GREEN",
            note: "Balanced, athletic posture with clean alignments.",
            errors: [
              "Too much knee bend can kill hip turn.",
              "Ball position drifting too far forward with mid-irons."
            ],
            drills: [
              "Mirror setup check: spine tilt, ball position, and weight 55/45.",
              "Alignment stick on toes to confirm aim before each swing."
            ]
          },
          {
            id: "P2",
            label: "Shaft parallel backswing",
            status: "GREEN",
            note:
              "Clubhead tracks nicely along the target line with good face control.",
            errors: [
              "Club rolling inside early with too much forearm rotation.",
              "Clubhead getting outside the hands and too steep."
            ],
            drills: [
              "Low-and-slow takeaway focusing on keeping the triangle.",
              "Alignment rod on ground and rehearse tracing it to P2."
            ]
          },
          {
            id: "P3",
            label: "Lead arm parallel backswing",
            status: "GREEN",
            note:
              "Good width and depth with plenty of rotation and coil potential.",
            errors: [
              "Lead arm collapsing and losing width.",
              "Trail leg locking early and stalling hip turn."
            ],
            drills: [
              "Towel under arms drill to keep connection.",
              "Wall drill: turn until trail hip brushes the wall at P3."
            ]
          },
          {
            id: "P4",
            label: "Top of swing",
            status: "GREEN",
            note: "Plenty of turn with a playable club position at the top.",
            errors: [
              "Across-the-line shaft when you rush the backswing.",
              "Over-long backswing when tempo gets fast."
            ],
            drills: [
              "Three-count backswing (1-2-3) to control length.",
              "Pause-at-the-top swings to feel loaded but not loose."
            ]
          },
          {
            id: "P5",
            label: "Lead arm parallel downswing",
            status: "YELLOW",
            note:
              "Club is close to on-plane but can get just a touch steep under pressure.",
            errors: [
              "Upper body diving toward the ball to start the downswing.",
              "Club dropping too far outside the hands."
            ],
            drills: [
              "Pump drill: rehearse shallow set, then swing.",
              "Feet-together swings to encourage rotation over slide."
            ]
          },
          {
            id: "P6",
            label: "Shaft parallel downswing",
            status: "YELLOW",
            note:
              "Face and path are playable but a fraction steep, which can steal compression.",
            errors: [
              "Handle getting too high at P6.",
              "Trail shoulder driving down too hard into the ball."
            ],
            drills: [
              "Headcover just outside the ball line to encourage inside path.",
              "Soft trail arm feel to keep the right shoulder from crashing down."
            ]
          },
          {
            id: "P7",
            label: "Impact",
            status: "GREEN",
            note:
              "Clubface is generally square with decent shaft lean and compression.",
            errors: [
              "Occasional heel or toe strikes from low-point drift.",
              "Hanging back and adding loft under pressure."
            ],
            drills: [
              "Divot-forward drill: paint a line and make divots in front.",
              "Impact tape session: chase a tight strike pattern in the center."
            ]
          },
          {
            id: "P8",
            label: "Trail arm parallel follow-through",
            status: "GREEN",
            note:
              "Arms and body are synced with a clean extension toward the target.",
            errors: [
              "Club exiting too low and left when you hold on.",
              "Arms outracing the body and flipping."
            ],
            drills: [
              "Hold P8 for 2–3 seconds to feel balanced extension.",
              "Throw-the-club drill feel for natural release (without actually throwing)."
            ]
          },
          {
            id: "P9",
            label: "Finish",
            status: "GREEN",
            note:
              "Balanced, full finish with chest facing the target and weight left.",
            errors: [
              "Falling off balance toward the toes or heels.",
              "Stopping rotation early and posing with tension."
            ],
            drills: [
              "Hold finish to a slow 3-count after every practice swing.",
              "Eyes-closed finish drill to train balance and awareness."
            ]
          }
        ],
        practicePlan: {
          overview:
            "Next 14 days: lock in transition, shallow the downswing slightly, and keep the great fundamentals you already own.",
          days: [
            {
              label: "Days 1–2: Setup & alignment",
              focus: "Start from a repeatable blueprint every time.",
              detail:
                "10–15 minutes per session on mirror checks and alignment rods. Build a pre-shot routine that hits posture, ball position, and aim."
            },
            {
              label: "Days 3–5: Transition timing",
              focus: "Lower body starts, upper body follows.",
              detail:
                "Step drills and pause-at-top swings to rehearse the correct sequence. Film 3–5 swings each day to confirm feel versus real."
            },
            {
              label: "Days 6–7: Shallow downswing",
              focus: "Get the club coming in from the slot.",
              detail:
                "Use an external tee or headcover just outside the ball line. Hit 40–60 balls focusing only on path and contact."
            },
            {
              label: "Days 8–10: Low point control",
              focus: "Move the strike consistently in front of the ball.",
              detail:
                "Paint a line on the turf or mat and train divots to start just ahead of it. Track how often you hit the correct side."
            },
            {
              label: "Days 11–14: Full swing integration",
              focus: "Blend the new feels into normal speed.",
              detail:
                "Play random-shot practice: different clubs, different targets, full routine. Track contact quality and start line."
            }
          ]
        }
      };

      var gradeToPercent = {
        "A+": 97,
        A: 93,
        "A-": 89,
        "B+": 85,
        B: 81,
        "B-": 77,
        "C+": 73,
        C: 69,
        "C-": 65,
        "D+": 61,
        D: 57,
        "D-": 53,
        F: 40
      };

      function mapStatus(status) {
        var s = (status || "").toUpperCase();
        if (s === "GREEN") {
          return { label: "On track", className: "status-pill status-green" };
        }
        if (s === "YELLOW") {
          return { label: "Needs attention", className: "status-pill status-yellow" };
        }
        if (s === "RED") {
          return { label: "Priority fix", className: "status-pill status-red" };
        }
        return { label: "Review", className: "status-pill" };
      }

      function buildConversationalSummary(report) {
        var meta = report.meta || {};
        var summary = report.summary || {};
        var name = meta.playerName || "Player";
        var headline = summary.headline || "";
        var strengths = report.strengths || [];
        var fixes = report.priorityFixes || [];

        var strengthSentence = "";
        if (strengths.length > 0) {
          var three = strengths.slice(0, 3);
          strengthSentence =
            " Your biggest strengths right now are: " + three.join(" ");
        }

        var fixesSentence = "";
        if (fixes.length > 0) {
          var fixTitles = fixes.slice(0, 3).map(function (f) {
            return f.title || "";
          });
          fixesSentence =
            " The main things to clean up over the next few weeks are: " +
            fixTitles.join(", ") +
            ".";
        }

        return (
          "Hi " +
          name +
          ", thanks for sending in your swing. " +
          headline +
          strengthSentence +
          fixesSentence +
          " Use the checkpoints and practice plan below to work those pieces in a simple, step-by-step way."
        );
      }

      function setBar(id, grade) {
        var el = document.getElementById(id);
        if (!el) return;
        var percent = gradeToPercent[grade] || 70;
        el.style.width = percent + "%";
      }

      function renderOverview(report) {
        var meta = report.meta || {};
        var summary = report.summary || {};

        var headlineEl = document.getElementById("report-headline");
        var metaLineEl = document.getElementById("report-meta-line");
        var summaryTextEl = document.getElementById("player-summary-text");
        var quickListEl = document.getElementById("quick-highlights");
        var tagsEl = document.getElementById("player-tags");
        var summaryMetaEl = document.getElementById("summary-meta");

        var playerName = meta.playerName || "Player";
        var headline =
          summary.headline ||
          "Solid fundamentally sound swing with clear opportunities to tighten up details.";
        headlineEl.textContent = headline;

        var handEye = "Hand: " + (meta.hand || "right") + " • Eye: " + (meta.eye || "right");
        var hcp = meta.handicap ? " • Hcp " + meta.handicap : "";
        var genDate = meta.generatedAt
          ? new Date(meta.generatedAt).toLocaleString()
          : "just now";
        metaLineEl.textContent =
          "Player: " + playerName + " • " + handEye + hcp + " • Generated: " + genDate;

        var conv = buildConversationalSummary(report);
        summaryTextEl.textContent = conv;
        summaryTextEl.setAttribute("data-summary-text", conv);

        while (quickListEl.firstChild) {
          quickListEl.removeChild(quickListEl.firstChild);
        }
        var bullets = summary.bullets || [];
        if (bullets.length === 0) {
          bullets = [
            "Foundational motion is sound enough to build real speed and consistency.",
            "Small changes in transition and low point control will pay off quickly.",
            "You have more power available once sequencing cleans up."
          ];
        }
        bullets.forEach(function (b) {
          var li = document.createElement("li");
          li.textContent = b;
          quickListEl.appendChild(li);
        });

        while (tagsEl.firstChild) {
          tagsEl.removeChild(tagsEl.firstChild);
        }
        var tags = [];
        if (meta.hand) tags.push(meta.hand + " hand");
        if (meta.eye) tags.push(meta.eye + " eye");
        if (meta.handicap) tags.push("Hcp " + meta.handicap);
        if (meta.height) tags.push(meta.height);
        tags.forEach(function (t) {
          var span = document.createElement("span");
          span.className = "tag-pill";
          span.textContent = t;
          tagsEl.appendChild(span);
        });
        var badge = document.createElement("span");
        badge.className = "tag-pill-alt";
        badge.textContent = "Generated by Virtual Coach AI";
        tagsEl.appendChild(badge);

        summaryMetaEl.textContent =
          meta.notes ||
          "Report generated automatically from your latest upload. This is a guide, not a sentence. Keep anything that matches your ball flight and feel.";
      }

      function renderPower(report) {
        var scores = report.scores || {};
        var swingScore = scores.swing || {};
        var powerScore = scores.power || {};
        var reliabilityScore = scores.reliability || {};

        document.getElementById("grade-swing").textContent =
          swingScore.grade || "A-";
        document.getElementById("grade-power").textContent =
          powerScore.grade || "B+";
        document.getElementById("grade-reliability").textContent =
          reliabilityScore.grade || "A-";

        setBar("bar-swing", swingScore.grade || "A-");
        setBar("bar-power", powerScore.grade || "B+");
        setBar("bar-reliability", reliabilityScore.grade || "A-");

        var strengths = report.strengths || [];
        var leaks = report.powerLeaks || [];
        var fixes = report.priorityFixes || [];

        function fillList(id, items, limit) {
          var el = document.getElementById(id);
          if (!el) return;
          while (el.firstChild) el.removeChild(el.firstChild);
          if (!items || items.length === 0) return;
          items.slice(0, limit).forEach(function (item) {
            var li = document.createElement("li");
            if (typeof item === "string") {
              li.textContent = item;
            } else {
              li.textContent = item.title || item.detail || "";
            }
            el.appendChild(li);
          });
        }

        fillList("power-strengths-list", strengths, 3);
        fillList("power-leaks-list", leaks, 3);
        fillList("power-fixes-list", fixes, 3);
      }

      function renderCheckpoints(report) {
        var listEl = document.getElementById("checkpoint-list");
        while (listEl.firstChild) listEl.removeChild(listEl.firstChild);

        var checkpoints = report.checkpoints || [];
        checkpoints.forEach(function (cp) {
          var card = document.createElement("article");
          card.className = "checkpoint-card";
          card.setAttribute("data-phase-id", cp.id || "");

          var header = document.createElement("div");
          header.className = "checkpoint-header";

          var left = document.createElement("div");
          left.className = "checkpoint-left";

          var phasePill = document.createElement("div");
          phasePill.className = "phase-pill";
          phasePill.textContent = cp.id || "";
          left.appendChild(phasePill);

          var titleWrap = document.createElement("div");

          var phaseLabel = document.createElement("div");
          phaseLabel.className = "phase-label";
          phaseLabel.textContent = cp.label || "";
          titleWrap.appendChild(phaseLabel);

          var phaseNote = document.createElement("div");
          phaseNote.className = "phase-note";
          phaseNote.textContent =
            cp.note ||
            "Coach will add a note for this checkpoint.";
          titleWrap.appendChild(phaseNote);

          left.appendChild(titleWrap);
          header.appendChild(left);

          var statusInfo = mapStatus(cp.status);
          var status = document.createElement("div");
          status.className = statusInfo.className;
          status.textContent = statusInfo.label;
          header.appendChild(status);

          card.appendChild(header);

          var body = document.createElement("div");
          body.className = "checkpoint-body";

          var coachCol = document.createElement("div");
          var coachTitle = document.createElement("div");
          coachTitle.className = "checkpoint-col-title";
          coachTitle.textContent = "Coach notes";
          coachCol.appendChild(coachTitle);

          var coachText = document.createElement("div");
          coachText.className = "checkpoint-col-text";
          coachText.textContent =
            cp.note ||
            "Coach will describe what we like and what we would tweak at this checkpoint.";
          coachCol.appendChild(coachText);
          body.appendChild(coachCol);

          var missCol = document.createElement("div");
          var missTitle = document.createElement("div");
          missTitle.className = "checkpoint-col-title";
          missTitle.textContent = "Common misses";
          missCol.appendChild(missTitle);

          var missText = document.createElement("div");
          missText.className = "checkpoint-col-text";
          var missList = document.createElement("ul");
          var errors = cp.errors || [];
          if (errors.length === 0) {
            var li = document.createElement("li");
            li.textContent =
              "No specific misses saved yet for this checkpoint. Use the AI button if you want examples.";
            missList.appendChild(li);
          } else {
            errors.forEach(function (err) {
              var li = document.createElement("li");
              li.textContent = err;
              missList.appendChild(li);
            });
          }
          missText.appendChild(missList);
          missCol.appendChild(missText);
          body.appendChild(missCol);

          var drillCol = document.createElement("div");
          var drillTitle = document.createElement("div");
          drillTitle.className = "checkpoint-col-title";
          drillTitle.textContent = "Key drills (powered by AI wording)";
          drillCol.appendChild(drillTitle);

          var drillText = document.createElement("div");
          drillText.className = "checkpoint-col-text";
          var drillList = document.createElement("ul");
          var drills = cp.drills || [];
          if (drills.length === 0) {
            var li2 = document.createElement("li");
            li2.textContent =
              "Coach drills for this checkpoint will appear here. For now, ask AI for a drill suggestion.";
            drillList.appendChild(li2);
          } else {
            drills.forEach(function (d) {
              var li2 = document.createElement("li");
              li2.textContent = d;
              drillList.appendChild(li2);
            });
          }
          drillText.appendChild(drillList);
          drillCol.appendChild(drillText);
          body.appendChild(drillCol);

          card.appendChild(body);

          var footer = document.createElement("div");
          footer.className = "checkpoint-footer";

          var buttonsWrap = document.createElement("div");
          buttonsWrap.className = "checkpoint-buttons";

          var aiBtn = document.createElement("button");
          aiBtn.type = "button";
          aiBtn.className = "btn-chip btn-chip-primary";
          aiBtn.textContent = "AI notes";
          aiBtn.onclick = function () {
            requestAiNotes(card, cp, "notes");
          };

          var moreBtn = document.createElement("button");
          moreBtn.type = "button";
          moreBtn.className = "btn-chip";
          moreBtn.textContent = "Need more info";
          moreBtn.onclick = function () {
            requestAiNotes(card, cp, "more");
          };

          var ytBtn = document.createElement("button");
          ytBtn.type = "button";
          ytBtn.className = "btn-chip";
          ytBtn.textContent = "YouTube";
          ytBtn.onclick = function () {
            alert(
              "In the next phase this will open a checkpoint-specific YouTube clip. For now, use your favorite drill video for this position."
            );
          };

          buttonsWrap.appendChild(aiBtn);
          buttonsWrap.appendChild(moreBtn);
          buttonsWrap.appendChild(ytBtn);

          footer.appendChild(buttonsWrap);

          var helper = document.createElement("div");
          helper.className = "card-subtitle";
          helper.textContent =
            "Click the AI buttons if you want a deeper explanation of this phase.";
          footer.appendChild(helper);

          card.appendChild(footer);

          var aiBox = document.createElement("div");
          aiBox.className = "ai-output";
          aiBox.id = "ai-output-" + (cp.id || "");
          var aiHeading = document.createElement("div");
          aiHeading.className = "ai-output-heading";
          aiHeading.textContent = "AI coach notes for this checkpoint";
          aiBox.appendChild(aiHeading);

          var aiStatus = document.createElement("div");
          aiStatus.className = "ai-output-status";
          aiStatus.textContent =
            "Tap AI notes or Need more info and we will talk you through this position.";
          aiBox.appendChild(aiStatus);

          var aiBody = document.createElement("div");
          aiBody.id = "ai-output-text-" + (cp.id || "");
          aiBody.textContent = "";
          aiBox.appendChild(aiBody);

          card.appendChild(aiBox);

          listEl.appendChild(card);
        });
      }

      function renderPracticePlan(report) {
        var plan = report.practicePlan || {};
        var bodyEl = document.getElementById("practice-body");
        var overviewEl = document.getElementById("practice-overview");
        overviewEl.textContent =
          plan.overview ||
          "Use this two-week window to groove the new feels without chasing perfection.";

        while (bodyEl.firstChild) bodyEl.removeChild(bodyEl.firstChild);

        var days = plan.days || [];
        days.forEach(function (day) {
          var div = document.createElement("div");
          div.className = "practice-day";
          var label = document.createElement("div");
          label.innerHTML =
            "<strong>" + (day.label || "") + "</strong> – " + (day.focus || "");
          var detail = document.createElement("div");
          detail.textContent = day.detail || "";
          div.appendChild(label);
          div.appendChild(detail);
          bodyEl.appendChild(div);
        });
      }

      function requestAiNotes(cardEl, checkpoint, mode) {
        var phaseId = checkpoint.id || "";
        var outputBox = cardEl.querySelector(
          "#ai-output-" + (phaseId || "").replace(/[^a-zA-Z0-9]/g, "")
        );
        var outputText = cardEl.querySelector(
          "#ai-output-text-" + (phaseId || "").replace(/[^a-zA-Z0-9]/g, "")
        );

        // if ids with special chars, fallback to generic query by data attribute
        if (!outputBox) {
          outputBox = cardEl.querySelector(".ai-output");
        }
        if (!outputText) {
          var allDivs = cardEl.querySelectorAll(".ai-output div");
          outputText = allDivs[allDivs.length - 1];
        }

        outputBox.classList.add("visible");
        var statusEl = outputBox.querySelector(".ai-output-status");
        statusEl.textContent = "Thinking about " + checkpoint.id + "…";

        var payload = {
          phaseId: phaseId,
          phaseLabel: checkpoint.label || "",
          mode: mode || "notes",
          coachNotes: checkpoint.note || "",
          commonMisses: (checkpoint.errors || []).join(" "),
          keyDrills: (checkpoint.drills || []).join(" ")
        };

        fetch("/api/ai-notes", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        })
          .then(function (res) {
            if (!res.ok) throw new Error("Bad status " + res.status);
            return res.json();
          })
          .then(function (data) {
            if (!data || !data.ok) {
              statusEl.textContent =
                "We could not generate AI notes right now. Try again in a moment.";
              return;
            }
            statusEl.textContent =
              "AI coach response – treat this as guidance, not a command.";
            outputText.textContent = data.notes || "";
          })
          .catch(function () {
            statusEl.textContent =
              "AI notes request failed. This is a tech issue, not a swing issue.";
            outputText.textContent = "";
          });
      }

      function playSummaryOutLoud() {
        var el = document.getElementById("player-summary-text");
        if (!el) return;
        var text = el.getAttribute("data-summary-text") || el.textContent || "";
        if (!text) return;

        if (!("speechSynthesis" in window)) {
          alert(
            "Your browser does not support speech playback yet. You can still read the summary above."
          );
          return;
        }

        window.speechSynthesis.cancel();
        var utter = new SpeechSynthesisUtterance(text);
        utter.rate = 1.0;
        utter.pitch = 1.0;
        window.speechSynthesis.speak(utter);
      }

      function getReportParam() {
        try {
          var url = new URL(window.location.href);
          var p = url.searchParams.get("report");
          return p;
        } catch (e) {
          return null;
        }
      }

      function showError(message) {
        var banner = document.getElementById("error-banner");
        banner.style.display = "block";
        banner.textContent = message;
      }

      function initPracticeToggle() {
        var toggle = document.getElementById("practice-toggle");
        var body = document.getElementById("practice-body");
        if (!toggle || !body) return;

        var expanded = false;
        var update = function () {
          if (expanded) {
            body.classList.remove("collapsed");
            body.classList.add("expanded");
            toggle.textContent = "▲ Hide full plan";
          } else {
            body.classList.remove("expanded");
            body.classList.add("collapsed");
            toggle.textContent = "▼ Show full plan";
          }
        };

        toggle.addEventListener("click", function () {
          expanded = !expanded;
          update();
        });

        update();
      }

      function init() {
        initPracticeToggle();

        var reportParam = getReportParam();
        if (!reportParam) {
          // Use fallback demo data
          renderOverview(fallbackReport);
          renderPower(fallbackReport);
          renderCheckpoints(fallbackReport);
          renderPracticePlan(fallbackReport);
          return;
        }

        fetch(reportParam, { cache: "no-store" })
          .then(function (res) {
            if (!res.ok) {
              throw new Error("Report fetch failed with status " + res.status);
            }
            return res.json();
          })
          .then(function (json) {
            var report = json || fallbackReport;
            renderOverview(report);
            renderPower(report);
            renderCheckpoints(report);
            renderPracticePlan(report);
          })
          .catch(function () {
            showError(
              "We could not load your saved report data, so this page is showing the demo swing instead."
            );
            renderOverview(fallbackReport);
            renderPower(fallbackReport);
            renderCheckpoints(fallbackReport);
            renderPracticePlan(fallbackReport);
          });
      }

      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>

