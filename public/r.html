<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Virtual Coach AI â€” Shared Report</title>
<meta name="robots" content="noindex, nofollow" />
<style>
  body { margin:0; color:#f5f5f5; background:#0a0a0a url("homepage-background.png") center/cover no-repeat fixed;
         font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
         filter: brightness(1.06) contrast(1.02); }
  .wrap { max-width: 1000px; margin:0 auto; padding:32px 16px; text-shadow:0 1px 2px rgba(0,0,0,.25); }
  h1 { margin:0 0 6px; font-size:28px; }
  .muted{ color:rgba(255,255,255,.75); }
  details{ border:1px solid rgba(255,255,255,.16); border-radius:12px; background:rgba(0,0,0,.25); padding:14px 16px; margin:10px 0; }
  summary{ cursor:pointer; font-weight:700; display:flex; justify-content:space-between; }
  .chips{ display:flex; gap:8px; flex-wrap:wrap; margin-top:8px; }
  .chip{ border:1px solid rgba(255,255,255,.16); border-radius:999px; padding:6px 10px; font-size:13px; }
  .pill{ padding:3px 8px; border-radius:999px; font-size:12px; border:1px solid rgba(255,255,255,.16);}
  .pill.g{ background:rgba(22,163,74,0.2); border-color:#16a34a; }
  .pill.y{ background:rgba(234,179,8,0.2); border-color:#eab308; }
  .pill.r{ background:rgba(239,68,68,0.2); border-color:#ef4444; }
  .table-wrap { overflow-x:auto; -webkit-overflow-scrolling:touch; margin:0 -8px; padding:0 8px; }
  table{ width:100%; border-collapse:collapse; table-layout:fixed; min-width:720px; }
  th,td{ padding:10px; border-bottom:1px solid rgba(255,255,255,.16); text-align:left; vertical-align:top; }
  .frames{ display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-top:10px; }
  @media (max-width:640px){ .frames{ grid-template-columns:repeat(2,1fr);} }
  .frame{ border:1px solid rgba(255,255,255,.16); border-radius:10px; background:rgba(0,0,0,.25); overflow:hidden; font-size:13px; color:rgba(255,255,255,.75);}
  .frame img{ width:100%; aspect-ratio:16/9; object-fit:cover; display:block; }
  .frame figcaption{ padding:6px 8px; }
  .cta{ display:inline-block; padding:10px 14px; border-radius:10px; background:#1F6F1F; color:#fff; text-decoration:none; font-weight:700; border:1px solid rgba(255,255,255,.16); }
</style>
</head>
<body>
<div class="wrap">
  <h1>Shared Swing Report</h1>
  <div class="muted" id="meta">Loadingâ€¦</div>

  <details open>
    <summary>Tempo</summary>
    <div class="chips" id="chips"></div>
  </details>

  <details open>
    <summary>P1â€“P9 Assessment</summary>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Checkpoint</th><th>Status</th></tr></thead>
        <tbody id="pRows"></tbody>
      </table>
    </div>
    <div class="frames" id="thumbs"></div>
  </details>

  <details open>
    <summary>Top 3 Things to Work On</summary>
    <ol id="top3work"></ol>
  </details>

  <details>
    <summary>Top 3 Power Things</summary>
    <ol id="top3power"></ol>
  </details>

  <p><a class="cta" href="/">Upload another swing</a></p>
</div>

<script>
(async function(){
  const id = new URLSearchParams(location.search).get('id') || '';
  const meta = document.getElementById('meta');
  if (!id) { meta.textContent = 'Missing id.'; return; }

  try {
    const r = await fetch('/api/get?id=' + encodeURIComponent(id));
    const j = await r.json();
    if (!r.ok || !j?.ok) { meta.textContent = 'Report not found.'; return; }
    const { report, thumbs } = j.doc || {};

    meta.textContent = `ID: ${id} â€¢ ${new Date(j.doc.createdAt).toLocaleString()}`;

    // Tempo
    const chips = document.getElementById('chips');
    const t = report?.tempo || {};
    chips.innerHTML = `
      <span class="chip">Backswing: ${t.backswing ?? '-' }s</span>
      <span class="chip">Pause: ${t.pause ?? '-' }s</span>
      <span class="chip">Downswing: ${t.downswing ?? '-' }s</span>
      <span class="chip">Ratio: ${t.ratio ?? '-' }:1</span>
    `;

    // P1â€“P9
    const map = { g:'Good', y:'Okay', r:'Needs Work' };
    const rows = document.getElementById('pRows');
    rows.innerHTML = '';
    (report?.pFlags || []).slice(0,9).forEach((f,i)=>{
      const tr = document.createElement('tr');
      const tdK = document.createElement('td'); tdK.textContent = `P${i+1}`;
      const tdS = document.createElement('td');
      const pill = document.createElement('span');
      pill.className = 'pill ' + (f||'y');
      pill.textContent = map[f] || 'Okay';
      tdS.appendChild(pill);
      tr.appendChild(tdK); tr.appendChild(tdS);
      rows.appendChild(tr);
    });

    // Top 3s
    document.getElementById('top3work').innerHTML  = (report?.top3WorkOn||[]).map(x=>`<li><b>${x}</b></li>`).join('');
    document.getElementById('top3power').innerHTML = (report?.top3Power||[]).map(x=>`<li><b>${x}</b></li>`).join('');

    // Thumbs (optional)
    const grid = document.getElementById('thumbs');
    grid.innerHTML = (thumbs||[]).map((src,i)=>`
      <figure class="frame">
        <img src="${src}" alt="Frame ${i+1}">
        <figcaption>Frame ${i+1}</figcaption>
      </figure>`).join('');
  } catch (e) {
    meta.textContent = 'Error loading report.';
  }
})();
</script>
</body>
</html>
