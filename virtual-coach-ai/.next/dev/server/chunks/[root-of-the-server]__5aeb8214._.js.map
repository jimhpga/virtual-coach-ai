{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Sites/virtual-coach-ai/virtual-coach-ai/src/app/api/voice-to-text/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\n\r\nexport const runtime = \"nodejs\";\r\n\r\nexport async function POST(req: NextRequest) {\r\n  try {\r\n    const apiKey = process.env.OPENAI_API_KEY;\r\n    if (!apiKey) {\r\n      return NextResponse.json(\r\n        { error: \"OPENAI_API_KEY is not set on the server.\" },\r\n        { status: 500 },\r\n      );\r\n    }\r\n\r\n    const formData = await req.formData().catch(() => null);\r\n    if (!formData) {\r\n      return NextResponse.json(\r\n        { error: \"No form data found in request.\" },\r\n        { status: 400 },\r\n      );\r\n    }\r\n\r\n    const file = formData.get(\"file\");\r\n    if (!(file instanceof Blob)) {\r\n      return NextResponse.json(\r\n        { error: \"Missing or invalid 'file' field in form data.\" },\r\n        { status: 400 },\r\n      );\r\n    }\r\n\r\n    const openaiForm = new FormData();\r\n    openaiForm.append(\"file\", file);\r\n    openaiForm.append(\"model\", \"whisper-1\");\r\n    openaiForm.append(\"response_format\", \"json\");\r\n    openaiForm.append(\"temperature\", \"0\");\r\n\r\n    const res = await fetch(\r\n      \"https://api.openai.com/v1/audio/transcriptions\",\r\n      {\r\n        method: \"POST\",\r\n        headers: {\r\n          Authorization: `Bearer ${apiKey}`,\r\n        },\r\n        body: openaiForm,\r\n      },\r\n    );\r\n\r\n    if (!res.ok) {\r\n      const text = await res.text();\r\n      console.error(\"OpenAI transcription error:\", res.status, text);\r\n      return NextResponse.json(\r\n        { error: \"OpenAI transcription error.\", detail: text },\r\n        { status: 500 },\r\n      );\r\n    }\r\n\r\n    const json = (await res.json()) as any;\r\n    const text: string | undefined = json?.text;\r\n\r\n    if (!text) {\r\n      return NextResponse.json(\r\n        { error: \"No text returned from transcription.\" },\r\n        { status: 500 },\r\n      );\r\n    }\r\n\r\n    return NextResponse.json({ text }, { status: 200 });\r\n  } catch (err) {\r\n    console.error(\"Error in /api/voice-to-text:\", err);\r\n    return NextResponse.json(\r\n      { error: \"Internal server error.\" },\r\n      { status: 500 },\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;;AAEO,MAAM,UAAU;AAEhB,eAAe,KAAK,GAAgB;IACzC,IAAI;QACF,MAAM,SAAS,QAAQ,GAAG,CAAC,cAAc;QACzC,IAAI,CAAC,QAAQ;YACX,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2C,GACpD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,WAAW,MAAM,IAAI,QAAQ,GAAG,KAAK,CAAC,IAAM;QAClD,IAAI,CAAC,UAAU;YACb,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAiC,GAC1C;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAO,SAAS,GAAG,CAAC;QAC1B,IAAI,CAAC,CAAC,gBAAgB,IAAI,GAAG;YAC3B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgD,GACzD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,aAAa,IAAI;QACvB,WAAW,MAAM,CAAC,QAAQ;QAC1B,WAAW,MAAM,CAAC,SAAS;QAC3B,WAAW,MAAM,CAAC,mBAAmB;QACrC,WAAW,MAAM,CAAC,eAAe;QAEjC,MAAM,MAAM,MAAM,MAChB,kDACA;YACE,QAAQ;YACR,SAAS;gBACP,eAAe,CAAC,OAAO,EAAE,QAAQ;YACnC;YACA,MAAM;QACR;QAGF,IAAI,CAAC,IAAI,EAAE,EAAE;YACX,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,QAAQ,KAAK,CAAC,+BAA+B,IAAI,MAAM,EAAE;YACzD,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;gBAA+B,QAAQ;YAAK,GACrD;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,OAAQ,MAAM,IAAI,IAAI;QAC5B,MAAM,OAA2B,MAAM;QAEvC,IAAI,CAAC,MAAM;YACT,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAuC,GAChD;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE;QAAK,GAAG;YAAE,QAAQ;QAAI;IACnD,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,OAAO;QAAyB,GAClC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}