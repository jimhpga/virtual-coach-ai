// /nav.js
(function(){
  async function mountNav(){
    try{
      const mount = document.getElementById('navMount');
      if(!mount) return; // page doesnâ€™t include a nav mount

      // Bust caches so your latest nav.html always wins
      const res = await fetch('/nav.html?v=3', { cache: 'no-store' });
      if(!res.ok) throw new Error('nav.html HTTP '+res.status);
      const html = await res.text();
      mount.innerHTML = html;

      // Mark current page
      const herePath = location.pathname.replace(/\/+$/,'');
      const links = mount.querySelectorAll('a[data-nav]');
      links.forEach(a=>{
        const u = new URL(a.getAttribute('href'), location.origin);
        if (u.pathname.replace(/\/+$/,'') === herePath) {
          a.setAttribute('aria-current','page');
        }
      });
    }catch(e){
      console.error('Nav load failed:', e);
    }
  }
  if(document.readyState === 'loading'){
    document.addEventListener('DOMContentLoaded', mountNav);
  }else{
    mountNav();
  }
})();
