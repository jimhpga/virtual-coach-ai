<!DOCTYPE html>
<html>
<head>
  <title>Virtual Coach AI – Upload</title>
</head>
<body style="font-family: sans-serif; padding: 30px;">
  <h1>Virtual Coach AI – Upload Your Swing</h1>

  <input type="file" id="videoInput" accept="video/*"><br><br>
  <button onclick="handleSubmit()">Analyze Swing</button>

  <p id="status" style="margin-top: 20px;"></p>

  <script>
    async function handleSubmit() {
      const videoInput = document.getElementById('videoInput');
      const status = document.getElementById('status');

      if (!videoInput.files.length) {
        status.textContent = '❌ No video selected.';
        return;
      }

      status.textContent = '⏳ Uploading video...';

      const videoFile = videoInput.files[0];

      // Step 1: Upload to Cloudinary or replace with your own storage
      const formData = new FormData();
      formData.append('file', videoFile);
      formData.append('upload_preset', 'demo'); // Public demo for testing

      let videoUrl;
      try {
        const uploadRes = await fetch('https://api.cloudinary.com/v1_1/demo/video/upload', {
          method: 'POST',
          body: formData
        });
        const data = await uploadRes.json();
        videoUrl = data.secure_url;
      } catch (err) {
        status.textContent = '❌ Video upload failed.';
        return;
      }

      // Step 2: Send to your analyze API
      try {
        const analyzeRes = await fetch('/api/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            videoUrl,
            selections: {
              club: '7I',
              model: 'analysis-v1',
              dataset: 'baseline'
            }
          })
        });

        const result = await analyzeRes.json();

        if (!analyzeRes.ok) {
          throw new Error(result.error || 'Unknown error');
        }

        status.textContent = '✅ Success! Report created. CID: ' + result._cid;
      } catch (err) {
        status.textContent = '❌ Analysis failed: ' + err.message;
      }
    }
  </script>
</body>
</html>
