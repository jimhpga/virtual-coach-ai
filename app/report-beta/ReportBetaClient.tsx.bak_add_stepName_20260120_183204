"use client";
import React, { useEffect, useRef, useState } from "react";
import { analyzeSwing } from "../lib/analyze/index";
import { postAssess } from "../lib/postAssess";
import PStrip from "./PStrip";
import { SwingFactsCard } from "../components/SwingFactsCard";
import { PDescriptionsCollapsed } from "../../components/PDescriptionsCollapsed";
import { TinyCard, ConfidenceMeter } from "../_components/UI";
import { prescribe, type FaultKey } from "../_logic/drills";
import { PoseOverlay2D } from "./PoseOverlay2D";
type PFrame = {
  p: number;
  label: string;
  frame: number;
  file: string;
  imageUrl: string;
  thumbUrl: string;
};
type AnalyzeResponse = {
  ok: boolean;
  level?: string;
  media?: { framesDir: string; frames: PFrame[] };
  scores?: {
    swing?: number;
    power?: number;
    reliability?: number;
    speed?: number;
    efficiency?: number;
    consistency?: number;
  };
  narrative?: { good?: string[]; improve?: string[]; powerLeaks?: string[] };
  error?: string;
};
const LEVEL_HELP: Record<string, string> = {
  beginner: "Beginner = normal words. Advanced = more detail (donâ€™t go down the rabbit hole).",
  intermediate: "Intermediate = simple + a bit more detail.",
  advanced: "Advanced = deeper detail (optional).",
  teacher: "Teacher = technical detail for coaches and better players.",
};
const DICTIONARY: Record<string, { title: string; body: string }> = {
  "safe hallway": {
    title: "Safe hallway (your â€˜laneâ€™)",
    body:
      "Itâ€™s the lane where your hands and the club travel so you donâ€™t have to save the swing at the bottom. " +
      "Stay in the lane going back and coming down = solid contact with less guessing.",
  },
  "hand path": {
    title: "Hand path",
    body:
      "Itâ€™s simply where your hands travel as you swing. Great ball strikers bring the hands up and down in a similar lane â€” " +
      "that keeps the clubface from being â€˜savedâ€™ late.",
  },
  "lead arm": {
    title: "Lead arm stability",
    body:
      "Itâ€™s how stable your front arm stays. If it collapses early going back, or breaks down too soon after impact, " +
      "youâ€™ll lose both power and control.",
  },
};

const FOCUS_OPTIONS = [
  "Not sure — tell me my #1 priority",
  "Early extension (coming up & out)",
  "Right elbow / trail arm (slotting)",
  "Over the top / steep downswing",
  "Hand path too far outside",
  "Shallowing / dropping the club",
  "Casting / losing lag",
  "Flip / handle stall at impact",
  "Open clubface (slice)",
  "Closed clubface (hook)",
  "Poor low point (fat/thin)",
  "Weight shift / pressure to lead side",
  "Rotation timing (hips vs chest)",
  "Chicken wing / lead arm",
  "Head movement / posture loss",
  "Swing plane / shaft pitch",
  "Tempo too fast",
  "Balance / falling toward toes/heels",
  "Release / rate of closure",
  "Finish position / extension through target"
] as const;

function clamp(n: number, a: number, b: number) {
  return Math.max(a, Math.min(b, n));
}
function Bar({ label, value }: { label: string; value: number }) {
  const v = clamp(Math.round(value), 0, 100);
  return (
    <>
      <div style={{ marginBottom: 10 }}>
        <div style={{ display: "flex", justifyContent: "space-between", fontSize: 12, opacity: 0.9 }}>
          <div style={{ fontWeight: 700 }}>{label}</div>
          <div style={{ fontVariantNumeric: "tabular-nums", opacity: 0.75 }}>{v}</div>
        </div>

        <div
          style={{
            height: 10,
            borderRadius: 999,
            background: "rgba(255,255,255,0.10)",
            overflow: "hidden",
            border: "1px solid rgba(255,255,255,0.12)",
          }}
        >
          <div
            style={{
              width: v + "%",
              height: "100%",
              background: "linear-gradient(90deg, rgba(66,140,255,0.9), rgba(44,220,170,0.9))",
            }}
          />
        </div>
      </div>
    </>
  );
}
function PillButton(props: React.ButtonHTMLAttributes<HTMLButtonElement>) {
  return (
    <button
      type="button"
      {...props}
      style={{
        borderRadius: 999,
        padding: "10px 14px",
        border: "1px solid rgba(255,255,255,0.14)",
        background: "rgba(0,0,0,0.25)",
        color: "#e6edf6",
        cursor: props.disabled ? "not-allowed" : "pointer",
        fontWeight: 700,
        fontSize: 13,
        opacity: props.disabled ? 0.6 : 1,
        ...props.style,
      }}
    />
  );
}
function Card({
  title,
  children,
  right,
}: {
  title?: string;
  children: React.ReactNode;
  right?: React.ReactNode;
}) {
  return (
    <div className="vca-bg"
      style={{
        borderRadius: 18,
        border: "1px solid rgba(255,255,255,0.12)",
        background: "rgba(0,0,0,0.25)",
        boxShadow: "0 12px 30px rgba(0,0,0,0.35)",
        overflow: "hidden",
      }}
    >{/* VCA_SWING_FACTS_CARD */}
      {(title || right) && (
        <div
          style={{
            padding: "14px 16px",
            borderBottom: "1px solid rgba(255,255,255,0.08)",
            display: "flex",
            alignItems: "center",
            justifyContent: "space-between",
          }}
        >
          <div style={{ fontWeight: 900, letterSpacing: 0.2 }}>{title}</div>
          {right}
        </div>
      )}
      <div style={{ padding: 16 }}>{children}</div>
    </div>
  );
}
function Collapsible(props: {
  title: string;
  defaultOpen?: boolean;
  right?: React.ReactNode;
  children: React.ReactNode;
}) {
  const { title, defaultOpen = true, right, children } = props;
  const [open, setOpen] = React.useState(defaultOpen);

  return (
    <div className="vca-bg">{/* VCA_SWING_FACTS_CARD */}
      <div
        style={{
          display: "flex",
          alignItems: "center",
          justifyContent: "space-between",
          gap: 10,
          cursor: "pointer",
          userSelect: "none",
          fontWeight: 900,
          letterSpacing: 0.2,
          padding: "2px 0 8px",
        }}
        onClick={() => setOpen(!open)}
        role="button"
        aria-expanded={open}
      >
        <div style={{ display: "flex", alignItems: "center", gap: 10 }}>
          <span style={{ opacity: 0.75, fontWeight: 900 }}>
            {open ? "â–¾" : "â–¸"}
          </span>
          <span>{title}</span>
        </div>
        <div>{right}</div>
      </div>

      {open ? <div>{children}</div> : null}
    </div>
  );
}
function CountPill({ n }: { n: number }) {
  return (
    <span
      style={{
        fontSize: 12,
        fontWeight: 900,
        padding: "5px 10px",
        borderRadius: 999,
        border: "1px solid rgba(255,255,255,0.14)",
        background: "rgba(255,255,255,0.06)",
        opacity: 0.92,
      }}
    >
      {n}
    </span>
  );
}
function CollapsibleCard({
  title,
  badge,
  open,
  onToggle,
  children,
}: {
  title: string;
  badge?: React.ReactNode;
  open: boolean;
  onToggle: () => void;
  children: React.ReactNode;
}) {
  return (
    <div className="vca-bg"
      style={{
        border: "1px solid rgba(255,255,255,0.10)",
        background: "rgba(0,0,0,0.22)",
        borderRadius: 18,
        overflow: "hidden",
        boxShadow: "0 10px 30px rgba(0,0,0,0.28)",
      }}
    >{/* VCA_SWING_FACTS_CARD */}
      <button
        type="button"
        onClick={onToggle}
        style={{
          width: "100%",
          cursor: "pointer",
          background: "transparent",
          border: "none",
          color: "inherit",
          padding: "12px 14px",
          display: "flex",
          alignItems: "center",
          justifyContent: "space-between",
          borderBottom: open ? "1px solid rgba(255,255,255,0.08)" : "1px solid rgba(255,255,255,0.00)",
          transition: "border-bottom-color 180ms ease",
        }}
        aria-expanded={open}
      >
        <div style={{ display: "flex", alignItems: "center", gap: 10, minWidth: 0 }}>
          <span
            style={{
              display: "inline-block",
              width: 18,
              opacity: 0.9,
              transform: open ? "rotate(90deg)" : "rotate(0deg)",
              transition: "transform 180ms ease",
            }}
          >
            â–¶
          </span>
          <div style={{ fontWeight: 900, letterSpacing: 0.2, whiteSpace: "nowrap", overflow: "hidden", textOverflow: "ellipsis" }}>
            {title}
          </div>
        </div>

        {badge ? (
          <div style={{ display: "flex", alignItems: "center", gap: 8, marginLeft: 10, flexShrink: 0 }}>
            {badge}
          </div>
        ) : null}
      </button>

      <div
        style={{
          display: "grid",
          gridTemplateRows: open ? "1fr" : "0fr",
          transition: "grid-template-rows 220ms cubic-bezier(0.2, 0.8, 0.2, 1)",
        }}
      >
        <div style={{ overflow: "hidden" }}>
        {/* ===== AI_SUMMARY_START ===== */}{/* TEMP OFF: AISummaryCard */}{/* ===== AI_SUMMARY_END ===== */}
          <div style={{ padding: 14 }}>
  {children}
</div>
      </div>
    </div>
  </div>
  );
}
export default function ReportBetaClient() {

  
  // Core report state (kept as `data` for legacy references; `report` is an alias)
  const [data, setData] = useState<any>(null);
  const report = data;
const [loading, setLoading] = useState(false);
  const [runStatus, setRunStatus] = useState<string>("");
  const [runState, setRunState] = useState<"idle" | "running" | "done" | "error">("idle");
  const [runErr, setRunErr] = useState<string>("");
  const [activeP, setActiveP] = useState<number>(1);

  const [videoUrl, setVideoUrl] = useState<string>("/demo/swing.mp4");
  const [impactFrame, setImpactFrame] = useState<number>(0);
  const [level, setLevel] = useState<"beginner"|"intermediate"|"advanced"|"teacher">("intermediate");
  const [focusTopic, setFocusTopic] = useState<string>("Not sure — tell me my #1 priority");
  const focusOptions = [...FOCUS_OPTIONS];

  const [coachQuestion, setCoachQuestion] = useState<string>("");
const overlayVideoRef = useRef<HTMLVideoElement | null>(null);
  const [stickOn, setStickOn] = useState(true);
  const [pose, setPose] = useState<any>(null);
  const [activeAngle, setActiveAngle] = useState<"dtl" | "face">("dtl");
  const poseUrl =
    activeAngle === "face"
      ? "/pose/adam_face_clean.pose.json"
      : "/pose/adam_dtl_clean.pose.json";

  
  // Load pose JSON for overlay (golden uses /demo/pose.json)
  useEffect(() => {
    if (typeof window === "undefined") return;
    (async () => {
      try {
        const golden = new URLSearchParams(window.location.search).get("golden") === "1";
        const url = golden ? "/demo/pose.json" : poseUrl;
        const r = await fetch(url, { cache: "no-store" });
        if (!r.ok) return;
        const j = await r.json();
        setPose(j);
      } catch {}
    })();
  }, [poseUrl]);
useEffect(() => {
  // Golden demo: hydrate overlay frames from /demo/pose.json using /demo/pmap.json for correct P1..P9 timing
  if (typeof window === "undefined") return;
  const params = new URLSearchParams(window.location.search);
  const golden = params.get("golden") === "1";
  if (!golden) return;

  (async () => {
    try {
      const [rPose, rMap] = await Promise.all([
        fetch("/demo/pose.json", { cache: "no-store" }),
        fetch("/demo/pmap.json", { cache: "no-store" }),
      ]);
      if (!rPose.ok || !rMap.ok) {
        console.warn("[VCA] Golden fetch failed", { poseOk: rPose.ok, mapOk: rMap.ok });
        return;
      }

      const pj: any = await rPose.json();
      const pm: any = await rMap.json();

      const raw: any[] = Array.isArray(pj?.frames) ? pj.frames : [];
      const p: any = pm?.p ?? {};
      if (!raw.length) return;

      // Build lookup by exact frame number
      const byFrame = new Map<number, any>();
      for (const f of raw) {
        const n = Number(f?.frame);
        if (Number.isFinite(n)) byFrame.set(n, f);
      }

      // Helper: safely resolve a frame object for a frame number
      const getFrameObj = (frNum: number) => {
        const fr = Number(frNum);
        if (!Number.isFinite(fr)) return raw[0];

        const exact = byFrame.get(fr);
        if (exact) return exact;

        // Fallback: nearest existing frame number (handles missing frames / every>1)
        let best = raw[0];
        let bestD = 1e12;
        for (const f of raw) {
          const n = Number(f?.frame);
          if (!Number.isFinite(n)) continue;
          const d = Math.abs(n - fr);
          if (d < bestD) { bestD = d; best = f; }
        }
        return best;
      };

      const keys = ["P1","P2","P3","P4","P5","P6","P7","P8","P9"];
      const pframes = keys.map((k, idx) => {
        const frNum = Number(p?.[k]?.frame ?? 0);
        const f = getFrameObj(frNum) ?? {};
        return {
          p: idx + 1,
          frame: Number(f.frame ?? frNum ?? 0),
          t_ms: f.t_ms ?? null,
          joints: f.joints ?? {},
        };
      });

      console.log("[VCA] Golden pose loaded:", {
        raw: raw.length,
        pframes: pframes.length,
        pmap: pframes.map(x => x.frame),
      });

      setData((prev: any) => {
        const next = prev ? { ...prev } : {};
        next.media = next.media ? { ...next.media } : { framesDir: "/demo", frames: [] };
        next.media.framesDir = "/demo";
        next.media.frames = pframes;
        return next;
      });
    } catch (e) {
      console.error("[VCA] Golden loader error", e);
    }
  })();
}, []);// Ã°Å¸Å½â„¢Ã¯Â¸Â Ask Coach (voice + typed)
  const [coachQ, setCoachQ] = React.useState<string>("");

const [focusPick, setFocusPick] = React.useState<string>(focusOptions[0]);
  const applyFocusToQuestion = (pick: string) => {
    const p = (pick || "").trim();
    if (!p) return;
    if (p.startsWith("Not sure")) {
      setCoachQ("Iâ€™m not sure what to work on. Based on my report, what is my #1 priority and what drill should I do?");
      return;
    }
    setCoachQ(`I want to work on: ${p}. What should I look for in my swing and what drill fixes it?`);
  };
  const [coachA, setCoachA] = React.useState<string>("");
  const [listening, setListening] = React.useState<boolean>(false);
  const localCoachAnswer = (q: string) => {
    const s = (q || "").toLowerCase();
    // Quick intent routing for MVP (replace with /api/coach later)
    if (s.includes("right elbow") || s.includes("trail elbow") || s.includes("elbow")) {
      return [
        "Right elbow checkpoint:",
        "â€¢ Backswing: elbow points more down than behind you (donâ€™t let it fly).",
        "â€¢ Transition: elbow works in front of your right hipâ€”feel it â€˜slotâ€™ while chest stays down.",
        "â€¢ Downswing: keep the elbow connected to the ribcage; hands donâ€™t throw early.",
        "Drill: towel-under-trail-arm half swings + pause at lead-arm-parallel down (P5)."
      ].join("\n");
    }

    if (
      s.includes("coming up") || s.includes("up and out") || s.includes("stand up") ||
      s.includes("early extend") || s.includes("early extension") || s.includes("humping")
    ) {
      return [
        "Coming up & out (early extension) checkpoint:",
        "â€¢ Keep chest over the ball longer; pressure shifts lead before you rotate.",
        "â€¢ Feel hips â€˜backâ€™ as you start down (left hip back, not toward the ball).",
        "â€¢ Keep trail heel heavier a fraction longer; rotate around your lead hip.",
        "Drill: chair/hip-bump drill + slow â€˜pumpâ€™ to P5 while keeping belt buckle back."
      ].join("\n");
    }

    if (s.includes("shallow") || s.includes("steep") || s.includes("over the top") || s.includes("hand path")) {
      return [
        "Hand path / steepness checkpoint:",
        "â€¢ Start down with pressure shiftâ€”hands follow.",
        "â€¢ Feel trail elbow in front of right hip and club â€˜fallâ€™ behind you.",
        "Drill: split-grip pump + step-through swings."
      ].join("\n");
    }

    return [
      "Tell me what you want to work on specifically (example: right elbow, early extension, face control, hand path).",
      "If youâ€™re not sure: say what your miss is (push/slice/pull/hook/thin/fat) and Iâ€™ll pick the priority."
    ].join("\n");
  };
  const askCoach = async (q: string) => {
    const text = (q || "").trim();
    if (!text) return;
    setCoachA("Thinkingâ€¦");

    // âœ… MVP: local answer now. Later swap to an API call.
    // Example future:
    // const r = await fetch("/api/coach", { method:"POST", headers:{ "content-type":"application/json" }, body: JSON.stringify({ 
        // focus: focusTopic,
        //         question: coachQuestion,q:text, data }) });
    // const j = await r.json(); setCoachA(j.answer || "");
    setCoachA(localCoachAnswer(text));
  };
  const startVoice = () => {
    try {
      const SR = (window as any).SpeechRecognition || (window as any).webkitSpeechRecognition;
      if (!SR) { setCoachA("Voice not supported in this browser. Type your question below."); return; }
      const rec = new SR();
      rec.lang = "en-US";
      rec.interimResults = false;
      rec.maxAlternatives = 1;

      rec.onstart = () => setListening(true);
      rec.onend = () => setListening(false);
      rec.onerror = () => setListening(false);

      rec.onresult = (e: any) => {
        const said = e?.results?.[0]?.[0]?.transcript || "";
        const cleaned = (said || "").trim();
        setCoachQ(cleaned);
        if (cleaned) askCoach(cleaned);
      };

      rec.start();
    } catch {
      setListening(false);
      setCoachA("Voice couldnâ€™t start. Type your question below.");
    }
  };

  // Right-rail collapsibles (collapsed by default)
  const [openGood, setOpenGood] = React.useState<boolean>(false);
  const [openImprove, setOpenImprove] = React.useState<boolean>(false);
  const [openLeaks, setOpenLeaks] = React.useState<boolean>(false);
  const expandAll = () => { setOpenGood(true); setOpenImprove(true); setOpenLeaks(true); };
  const collapseAll = () => { setOpenGood(false); setOpenImprove(false); setOpenLeaks(false); };
  const recommendations = (
    report?.narrative?.recommendations ??
    [
      {
        title: "Transition timing",
        how: "Start the downswing by shifting pressure into your lead foot before the hands move. Let the body lead and the arms respond."
      },
      {
        title: "Low point control",
        how: "Keep your chest over the ball through impact and practice brushing the turf just in front of the ball."
      }
    ]
  ).slice(0, 2);
/* ---- AUTO-COMMENTED BROKEN BLOCK (was causing parser error) ----

    summary:
      "Solid fundamentally sound mid-iron swing with small opportunities to clean up transition and low point control.",
    meta:
      "Player: Player â€¢ Hand: Right â€¢ Eye: Right â€¢ Hcp 1 â€¢ Generated: 6/13/2024, 5:00 AM",
    body:
      "Hi Player, thanks for sending in your swing. Solid fundamentals overall. Your biggest strengths are an athletic setup with clean spine tilt and balance, solid arm-body connection in the takeaway, and good wrist hinge creating width and leverage. The main things to clean up over the next few weeks are transition timing, shallowing the downswing slightly, and keeping the pivot centered through impact. Use the checkpoints and practice plan below to work through this step-by-step.",
    highlights: [
      "Athletic, balanced setup that supports a powerful coil.",
      "Good wrist hinge and width in the backswing.",
      "Clubface control is generally very good through impact.",
      "Transition timing can get a touch upper-body dominant.",
      "Low point control can tighten up for more compression."
    ]
  };

---- END AUTO-COMMENT ---- */
  // Player overview (API-first, fallback)
  const playerOverview =
    (data as any)?.narrative?.playerOverview ??
    (data as any)?.narrative?.player_overview ??
    {
      summary:
        "Solid fundamentally sound mid-iron swing with small opportunities to clean up transition and low point control.",
      meta:
        "Player: Player â€¢ Hand: Right â€¢ Eye: Right â€¢ Hcp 1 â€¢ Generated: 6/13/2024, 5:00 AM",
      body:
        "Hi Player, thanks for sending in your swing. Solid fundamentals overall. Your biggest strengths are an athletic setup with clean spine tilt and balance, solid arm-body connection in the takeaway, and good wrist hinge creating width and leverage. The main things to clean up over the next few weeks are transition timing, shallowing the downswing slightly, and keeping the pivot centered through impact. Use the checkpoints and practice plan below to work through this step-by-step.",
      highlights: [
        "Athletic, balanced setup that supports a powerful coil.",
        "Good wrist hinge and width in the backswing.",
        "Clubface control is generally very good through impact.",
        "Transition timing can get a touch upper-body dominant.",
        "Low point control can tighten up for more compression."
      ],
      tags: ["Right hand", "Right eye", "Hcp 1", "6'0\"", "Generated by Virtual Coach AI"],
      footer:
        "High level amateur right-handed golfer with right eye dominance and good athletic build, swinging a mid-iron.",
      recommendations: ["Transition timing", "Low point control"],
      recHowto: [
        "Start the downswing by shifting pressure into your lead foot before the hands move. Let the body lead and the arms respond.",
        "Keep your chest over the ball through impact and practice brushing the turf just in front of the ball."
      ]
    };
const [error, setError] = React.useState<string | null>(null);
  const [dictKey, setDictKey] = React.useState<keyof typeof DICTIONARY | null>(null);

  // âœ… click test so you KNOW the handler is firing
  const [clickTest, setClickTest] = React.useState<number>(0);
  const videoRef = React.useRef<HTMLVideoElement | null>(null);
  const [duration, setDuration] = React.useState<number>(0);
  const [curTime, setCurTime] = React.useState<number>(0);
  const fps = 30;
  const frames = report?.media?.frames ?? [];
  const sortedFrames = React.useMemo(() => [...frames].sort((a, b) => a.p - b.p), [frames]);
  function resetDemo() {
    // Bulletproof reset: clears UI state without waiting on network
    try { setData(null); } catch {}
    try { setError(null); } catch {}
    try { setRunStatus(""); } catch {}
    try { setRunErr(""); } catch {}
    try { setRunState("idle"); } catch {}

    // common UI state (safe if these exist)
    try { setActiveP(1); } catch {}
    try { setCurTime(0); } catch {}
    try { setLoading(false); } catch {}

    // if you track click tests or other debug counters
    try { setClickTest(0 as any); } catch {}

    // scroll back up so the user sees a clean slate
    try { window.scrollTo({ top: 0, behavior: "smooth" }); } catch {}
  }

  async function analyze() {
    // CLICK TEST â€” if this number bumps, the button is NOT â€œdeadâ€
    setClickTest((n) => n + 1);

    console.log("Ã°Å¸Å¸Â¦ Analyze clicked", { videoUrl, impactFrame, level, t: Date.now() });

    setLoading(true);
    setError(null);
    setRunStatus("Starting analysisâ€¦");

    try {
      const res = await fetch("/api/analyze", {
        method: "POST",
        headers: { "content-type": "application/json" },
        body: JSON.stringify({ videoUrl, impactFrame, level }),
      });
      setRunStatus("Response: " + res.status + " " + res.statusText);
      const text = await res.text();
      let json: AnalyzeResponse | null = null;
      if (text) {
        try {
          json = JSON.parse(text) as AnalyzeResponse;
        } catch {
          throw new Error("Invalid JSON from server");
        }
      }

      if (!res.ok || !json?.ok) {
        throw new Error(json?.error || `Analyze failed (${res.status})`);
      }
      const frames = (json as any)?.media?.frames ?? (json as any)?.frames ?? [];
      const framesDir = (json as any)?.media?.framesDir ?? (json as any)?.framesDir ?? "";
      setRunStatus("Done. Frames + report loaded âœ…");
      setTimeout(() => document.getElementById("results")?.scrollIntoView({ behavior: "smooth" }), 50);
    } catch (e: any) {
      setRunStatus("âŒ Analyze error");
      setError(e?.message || "Analyze failed");
      console.error("âŒ analyze() failed:", e);
    } finally {
      setLoading(false);
    }
  }
  function jumpToP(p: number) {
    
    try { setActiveP(p); } catch {}
const f = sortedFrames.find((x) => x.p === p);
    if (!f) return;
    const t = f.frame / fps;
    const v = videoRef.current;
    if (!v) return;

    v.currentTime = t;
    v.pause();
    setCurTime(t);
  }
  function stepFrames(delta: number) {
    const v = videoRef.current;
    if (!v) return;
    const next = clamp(v.currentTime + delta / fps, 0, Math.max(0, duration - 0.01));
    v.currentTime = next;
    v.pause();
    setCurTime(next);
  }
  const scores = React.useMemo(() => {
    const s = report?.scores;
    return {
      swing: s?.swing ?? 82,
      power: s?.power ?? 78,
      reliability: s?.reliability ?? 74,
      speed: s?.speed ?? 77,
      efficiency: s?.efficiency ?? 73,
      consistency: s?.consistency ?? 72,
    };
  }, [data]);
  const narrative = React.useMemo(() => {
    const n = report?.narrative;
    return {
      good:
        n?.good ?? [
          "Solid balance through the motion - that's your foundation",
          "Tempo is consistent; keep that and you'll keep the strike",
          "Impact looks organized: hands and body arriving together",
        ],
      improve:
        n?.improve ?? [
          "Pick ONE priority today and win it (face control OR low point)",
          "Give me 5 clean reps before you speed up - clean beats fast",
          "Film 2 swings after the drill: if the picture improves, keep it",
        ],
      powerLeaks:
        n?.powerLeaks ?? [
          "If the chest stalls, the hands flip - keep rotating through",
          "Pressure must shift THEN you rotate (don't spin in place)",
          "Finish tall and posted; if you're falling back, you're leaking power",
        ],
    };
  }, [data]);
  const bgUrl = "/bg/home-bg.png";
const bgWrap: React.CSSProperties = {
  minHeight: "100vh",
  border: "8px solid magenta",
  background: "rgba(255,0,255,0.18)",
  backgroundImage: `url(${bgUrl})`,
  backgroundSize: "cover",
  backgroundPosition: "center",
  backgroundRepeat: "no-repeat",
};const scrim: React.CSSProperties = {
  minHeight: "100vh",
  background: "rgba(0,0,0,0.05)",
};const pageShell: React.CSSProperties = {
    minHeight: "100vh",
    padding: "26px 18px 60px",
    color: "#e6edf6",
    background: "transparent",
  };

  return (
    <div className="vca-bg" style={bgWrap}>
    <div style={scrim}>
      <div style={pageShell}>{/* VCA_SWING_FACTS_CARD */}
      <div style={{ maxWidth: 1180, margin: "0 auto" }}>
        <div style={{ display: "flex", alignItems: "baseline", justifyContent: "space-between", marginBottom: 14 }}>
          <div>
            <div style={{ fontSize: 32, fontWeight: 900 }}>Virtual Coach AI</div>
            <div style={{ opacity: 0.75, marginTop: 4 }}>
              Upload once. Get frames, scores, and coaching that makes sense.
            </div>
          </div>
          <a href="/" style={{ color: "#b9cff6", textDecoration: "none", fontWeight: 700 }}>
            â†’Â Home
          </a>
        </div>

        



<Card>
  <div style={{ fontSize: 12, letterSpacing: 1, opacity: 0.7, marginBottom: 6 }}>
    PLAYER OVERVIEW
  </div>

          <div style={{ marginTop: 10, padding: 12, borderRadius: 12, border: "1px solid rgba(255,255,255,0.10)" }}>
          <div style={{ fontWeight: 800, fontSize: 13, opacity: 0.9 }}>Post-Assessment</div>
          <div style={{ marginTop: 6, fontSize: 13 }}>
            <b>Todayâ€™s ONE priority:</b> "(TEMP OFF)"
          </div>
          <div style={{ marginTop: 6, fontSize: 13, opacity: 0.9 }}>""</div>
          <div style={{ marginTop: 6, fontSize: 13, opacity: 0.9 }}>""</div>
        </div>
<div style={{ fontSize: 15, lineHeight: 1.6 }}>
    {narrative?.summary ??
      "This swing shows solid fundamentals with good intent through impact. The priority is improving the transition so power and consistency improve together."}
  </div>
</Card>

<Card title="Swing Report â€” Beta">
  
          {/* TEMP OFF: VCA_CONF_UI */}
<div style={{ display: "grid", gap: 12 }}>
    {/* Row 1: primary actions */}
    <div style={{ display: "grid", gridTemplateColumns: "1fr 1fr", gap: 12 }}>
        {/* MVP breadcrumb */}
        <div style={{ gridColumn: "1 / -1", fontSize: 12, opacity: 0.8, margin: "8px 0 10px" }}>
          <span style={{ fontWeight: stepName(runState)==="Upload" ? 800 : 400 }}>Upload</span>
          {"  â†’  "}
          <span style={{ fontWeight: stepName(runState)==="Analyze" ? 800 : 400 }}>Analyze</span>
          {"  â†’  "}
          <span style={{ fontWeight: stepName(runState)==="Report" ? 800 : 400 }}>Report</span>
          {runState==="error" && runErr ? (
            <span style={{ marginLeft: 10, fontWeight: 800 }}>âš ï¸Â  {runErr}</span>
          ) : null}
        </div>

      <button
        type="button"
        onClick={analyze}
        disabled={loading}
        style={{
          height: 46,
          borderRadius: 14,
          border: "1px solid rgba(66,140,255,0.55)",
          background: loading ? "rgba(66,140,255,0.30)" : "rgba(66,140,255,0.85)",
          color: "#04111f",
          fontWeight: 900,
          cursor: loading ? "not-allowed" : "pointer",
        }}
      >
        {loading ? "Analyzingâ€¦" : "Analyze"}
      </button>

      <button
        type="button"
        onClick={resetDemo}
        disabled={loading}
        style={{
          height: 46,
          borderRadius: 14,
          border: "1px solid rgba(255,255,255,0.14)",
          background: "rgba(255,255,255,0.06)",
          color: "rgba(255,255,255,0.92)",
          fontWeight: 700,
          cursor: loading ? "not-allowed" : "pointer",
        }}
      >
        Reset Demo
      </button>
          <button
            type="button"
            onClick={() => {
              try { sessionStorage.setItem("vca_card_src", "/data/card-demo.json"); } catch {}
              window.location.href = "/report-beta/full?golden=1";
            }}
            style={{
              height: 38,
              padding: "0 16px",
              borderRadius: 999,
              border: "1px solid rgba(255,255,255,0.18)",
              background: "rgba(120,180,255,0.22)",
              color: "#eaf1ff",
              fontSize: 13,
              fontWeight: 900,
              cursor: "pointer",
              marginLeft: 10,
              whiteSpace: "nowrap",
            }}
          >
            View Full Report â†’
          </button>
    </div>

    {/* Row 2: key options */}
    <div style={{
  display: "grid",
  gridTemplateColumns: "1.2fr 0.8fr 1fr",
  gap: 12,
  alignItems: "end",
  padding: 12,
  borderRadius: 14,
  background: "rgba(255,255,255,0.03)",
  border: "1px solid rgba(255,255,255,0.06)"
}}>
      <div>
        <div style={{ fontSize: 12, opacity: 0.75, fontWeight: 900, marginBottom: 6 }}>Level</div>
        <select
          value={level}
          onChange={(e) => setLevel(e.target.value as any)}
          style={{
            width: "100%",
            height: 42,
            borderRadius: 12,
            border: "1px solid rgba(255,255,255,0.14)",
            background: "rgba(0,0,0,0.18)",
            color: "#e6edf6",
            padding: "0 12px",
            outline: "none",
            fontWeight: 700,
          }}
        >
          <option value="beginner">Beginner (simple)</option>
          <option value="intermediate">Intermediate</option>
          <option value="advanced">Advanced</option>
          <option value="teacher">Teacher (technical)</option>
        </select>
        <div style={{ fontSize: 12, opacity: 0.65, marginTop: 6 }}>{LEVEL_HELP[level]}</div>
      </div>

      <div>
        <div style={{ fontSize: 12, opacity: 0.75, fontWeight: 900, marginBottom: 6 }}>Impact</div>
        <input
          type="number"
          value={impactFrame}
          onChange={(e) => setImpactFrame(parseInt(e.target.value || "0", 10))}
          style={{
            width: "100%",
            height: 42,
            borderRadius: 12,
            border: "1px solid rgba(255,255,255,0.14)",
            background: "rgba(0,0,0,0.18)",
            color: "#e6edf6",
            padding: "0 12px",
            outline: "none",
          }}
        />
      </div>

      <div>
        <div style={{ fontSize: 12, opacity: 0.75, fontWeight: 900, marginBottom: 6 }}>Focus (optional)</div>
        <select
          value={focusTopic}
          onChange={(e) => setFocusTopic(e.target.value)}
          style={{
            width: "100%",
            height: 42,
            borderRadius: 12,
            border: "1px solid rgba(255,255,255,0.12)",
            background: "rgba(0,0,0,0.22)",
            color: "#e6edf6",
            padding: "0 12px",
            outline: "none",
          }}
        >
          {focusOptions.map((o) => (
            <option key={o} value={o}>
              {o}
            </option>
          ))}
        </select>
      </div>
    </div>

    {/* Row 3: calm extras (collapsed) */}
    <div style={{ display: "grid", gap: 8 }}>
      <Collapsible title="Ask the Coach (optional)" defaultOpen={false}>
        <div style={{ display: "grid", gridTemplateColumns: "1fr auto", gap: 10, alignItems: "end", marginTop: 8 }}>
          <div>
            <div style={{ fontSize: 12, fontWeight: 700, opacity: 0.8, marginBottom: 6 }}>Question</div>
            <input
              value={coachQuestion}
              onChange={(e) => setCoachQuestion(e.target.value)}
              placeholder='e.g., "What is my right elbow doing?"'
              style={{
                width: "100%",
                height: 42,
                borderRadius: 12,
                border: "1px solid rgba(255,255,255,0.12)",
                background: "rgba(0,0,0,0.22)",
                color: "#e6edf6",
                padding: "0 12px",
                outline: "none",
              }}
            />
          </div>

          <button
            type="button"
            onClick={() => alert("Ã°Å¸Å½Â¤ Voice is coming soon. For now, type your question.")}
            style={{
              height: 42,
              padding: "0 12px",
              borderRadius: 12,
              border: "1px solid rgba(255,255,255,0.14)",
              background: "rgba(255,255,255,0.06)",
              color: "rgba(230,237,246,0.85)",
              cursor: "pointer",
              fontWeight: 700,
              whiteSpace: "nowrap",
            }}
            title="Coming soon"
          >
            Ã°Å¸Å½Â¤ Voice (soon)
          </button>
        </div>
      </Collapsible>

      <Collapsible title="Help (terms)" defaultOpen={false}>
        <div style={{ marginTop: 10, display: "flex", gap: 10, flexWrap: "wrap" }}>
          <PillButton onClick={() => setDictKey("safe hallway")}>Safe hallway</PillButton>
          <PillButton onClick={() => setDictKey("hand path")}>Hand path</PillButton>
          <PillButton onClick={() => setDictKey("lead arm")}>Lead arm</PillButton>
        </div>
      </Collapsible>

      <Collapsible title="Advanced" defaultOpen={false}>
        <div style={{ marginTop: 10, display: "flex", gap: 10, alignItems: "center" }}>
  <button
    type="button"
    onClick={() => setStickOn(v => !v)}
    style={{ padding: "8px 12px", borderRadius: 10, border: "1px solid rgba(255,255,255,0.18)", background: "rgba(0,0,0,0.25)", color: "#e6edf6", cursor: "pointer" }}
  >
    Stick Figure: {stickOn ? "On" : "Off"}{"  "}
<span style={{ opacity: 0.55, marginLeft: 10, marginRight: 6 }}>|</span>
{"  "}
<span style={{ opacity: 0.85, marginRight: 8 }}>Angle:</span>
<PillButton
  onClick={() => setActiveAngle(activeAngle === "dtl" ? "face" : "dtl")}
  title="Toggle camera angle (DTL / Face)"
>
  {activeAngle === "dtl" ? "DTL" : "FACE"}
</PillButton>
  </button>
</div>
<div style={{ marginTop: 10, display: "grid", gap: 10 }}>
          <div>
            <div style={{ fontSize: 12, opacity: 0.75, fontWeight: 900, marginBottom: 6 }}>Video URL</div>
            <input
              value={videoUrl}
              onChange={(e) => setVideoUrl(e.target.value)}
              placeholder="/uploads/yourfile.mp4"
              style={{
                width: "100%",
                height: 42,
                borderRadius: 12,
                border: "1px solid rgba(255,255,255,0.14)",
                background: "rgba(0,0,0,0.18)",
                color: "#e6edf6",
                padding: "0 12px",
                outline: "none",
              }}
            />
          </div>
        </div>
      </Collapsible>

      {runStatus ? (
        <div style={{ marginTop: 2, fontSize: 12, opacity: 0.75 }}>
          <b>Status:</b> {runStatus}
        </div>
      ) : null}

      {/* P1â€“P9 descriptions (collapsed) */}
      <PDescriptionsCollapsed onJumpToP={jumpToP} activeP={activeP} />

      {error && (
        <div
          style={{
            marginTop: 8,
            padding: 12,
            borderRadius: 12,
            border: "1px solid rgba(255,80,80,0.35)",
            background: "rgba(255,80,80,0.08)",
          }}
        >
          <div style={{ fontWeight: 900, color: "#ffb4b4" }}>Error</div>
          <div style={{ opacity: 0.9, marginTop: 4 }}>{error}</div>
        </div>
      )}
    </div>
  </div>
</Card>

        <div id="results" style={{ marginTop: 16, display: "grid", gridTemplateColumns: "1.3fr 0.7fr", gap: 14 }}>
          <Card
            title="Fine Viewer (frame-by-frame)"
            right={
              <div style={{ display: "flex", gap: 8, flexWrap: "wrap" }}>
                {Array.from({ length: 9 }, (_, i) => i + 1).map((p) => (
                  <PillButton key={p} onClick={() => jumpToP(p)} disabled={!sortedFrames.length}>
                    P{p}
                  </PillButton>
                ))}
              </div>
            }
          >
            <div style={{ position: "relative", width: "100%" }}>
<video
              ref={(el) => { videoRef.current = el; overlayVideoRef.current = el; }}
              src={videoUrl || undefined}
              controls
              playsInline
              preload="metadata"
              style={{
                width: "100%",
                borderRadius: 14,
                background: "#000",
                border: "1px solid rgba(255,255,255,0.10)",
              }}
              onLoadedMetadata={(e) => setDuration((e.currentTarget as HTMLVideoElement).duration || 0)}
              onTimeUpdate={(e) => setCurTime((e.currentTarget as HTMLVideoElement).currentTime || 0)}
            />
<PoseOverlay2D videoRef={overlayVideoRef} pose={pose} enabled={stickOn} />
</div>

            <div style={{ marginTop: 10, display: "flex", gap: 10, alignItems: "center" }}>
  <button
    type="button"
    onClick={() => setStickOn(v => !v)}
    style={{ padding: "8px 12px", borderRadius: 10, border: "1px solid rgba(255,255,255,0.18)", background: "rgba(0,0,0,0.25)", color: "#e6edf6", cursor: "pointer" }}
  >
    Stick Figure: {stickOn ? "On" : "Off"}{"  "}
<span style={{ opacity: 0.55, marginLeft: 10, marginRight: 6 }}>|</span>
{"  "}
<span style={{ opacity: 0.85, marginRight: 8 }}>Angle:</span>
<PillButton
  onClick={() => setActiveAngle(activeAngle === "dtl" ? "face" : "dtl")}
  title="Toggle camera angle (DTL / Face)"
>
  {activeAngle === "dtl" ? "DTL" : "FACE"}
</PillButton>
  </button>
</div>
<div style={{ marginTop: 10, display: "grid", gridTemplateColumns: "auto 1fr auto", gap: 10, alignItems: "center" }}>
              <div style={{ display: "flex", gap: 8 }}>
                <PillButton onClick={() => stepFrames(-1)} disabled={!duration}>
                  â® 1 frame
                </PillButton>
                <PillButton onClick={() => stepFrames(+1)} disabled={!duration}>
                  1 frame â–¶
                </PillButton>
              </div>

              <input
                type="range"
                min={0}
                max={Math.max(0, duration)}
                step={1 / fps}
                value={curTime}
                onChange={(e) => {
                  const t = parseFloat(e.target.value);
                  const v = videoRef.current;
                  if (v) {
                    v.currentTime = t;
                    v.pause();
                  }
                  setCurTime(t);
                }}
              />

              <div style={{ fontSize: 12, opacity: 0.75, fontVariantNumeric: "tabular-nums" }}>
                {curTime.toFixed(2)}s / {duration ? duration.toFixed(2) : "â€”"}s
              </div>
            </div>

            <div style={{ marginTop: 12, fontWeight: 900, opacity: 0.92 }}>P1â€“P9 frames</div>

            {!sortedFrames.length ? (
              <div style={{ opacity: 0.75, marginTop: 6 }}>Run Analyze to populate frames.</div>
            ) : (
              <>
                <div style={{ marginTop: 10 }}>
                  {/* P1â€“P9 frame thumbnails hidden (optional feature) */}
                </div>

                <div style={{ marginTop: 8, display: "grid", gridTemplateColumns: "repeat(9, minmax(0, 1fr))", gap: 8 }}>
                  {sortedFrames.map((f) => (
                    <button
                      type="button"
                      key={f.p}
                      onClick={() => jumpToP(f.p)}
                      style={{
                        padding: 0,
                        border: "1px solid rgba(255,255,255,0.10)",
                        borderRadius: 12,
                        overflow: "hidden",
                        cursor: "pointer",
                        background: "rgba(0,0,0,0.2)",
                      }}
                      title={`Jump to ${f.label}`}
                    >
                      <div style={{ padding: "6px 8px", fontSize: 12, fontWeight: 900, opacity: 0.9 }}>{f.label}</div>
                      <img
                        src={f.thumbUrl || f.imageUrl}
                        alt={f.label}
                        style={{ width: "100%", display: "block", aspectRatio: "16/9", objectFit: "cover" }}
                      />
                    </button>
                  ))}
                </div>
              </>
            )}
          </Card>

          <div style={{ display: "grid", gridTemplateColumns: "1fr", gap: 14 }}>
            <Card title="Scoreboard">
              <div style={{ display: "grid", gridTemplateColumns: "repeat(3, 1fr)", gap: 10 }}>
                {[
                  ["Swing Score", scores.swing],
                  ["Power", scores.power],
                  ["Reliability", scores.reliability],
                ].map(([k, v]) => (
                  <div
                    key={k as string}
                    style={{
                      border: "1px solid rgba(255,255,255,0.10)",
                      borderRadius: 14,
                      padding: 12,
                      background: "rgba(0,0,0,0.18)",
                    }}
                  >
                    <div style={{ fontSize: 12, opacity: 0.8, fontWeight: 900 }}>{k as string}</div>
                    <div style={{ fontSize: 28, fontWeight: 900, marginTop: 4 }}>{v as number}</div>
                  </div>
                ))}
              </div>

              <div style={{ marginTop: 14 }}>
                <div style={{ fontWeight: 900, marginBottom: 8, opacity: 0.92 }}>Power + Reliability (estimated)</div>
                <Bar label="Speed" value={scores.speed} />
                <Bar label="Impact efficiency" value={scores.efficiency} />
                <Bar label="Consistency" value={scores.consistency} />
                <div style={{ fontSize: 12, opacity: 0.75, marginTop: 10 }}>
                  AI explanation: Power = speed delivered into solid strike. Reliability = how repeatable contact and start-line are.
                </div>
              </div>
            </Card>

            <Card>
  <Collapsible title="3 things you do well" defaultOpen={true}>
<ul style={{ margin: 0, paddingLeft: 18, opacity: 0.9, lineHeight: 1.6 }}>
                {narrative.good.slice(0, 3).map((x, i) => (
                  <li key={i}>{x}</li>
                ))}
              </ul>

<div style={{ marginTop: 12, paddingTop: 10, borderTop: "1px solid rgba(255,255,255,0.08)" }}>
  <div style={{ fontSize: 12, fontWeight: 900, opacity: 0.75, marginBottom: 6 }}>
  Top 3 fixes</div>
      <div style={{ marginTop: 14 }}>
        <div style={{ fontWeight: 900, marginBottom: 8 }}>
        </div>

        <ol style={{ paddingLeft: 18, margin: 0 }}>
          {recommendations.map((r, i) => (
            <li key={i} style={{ marginBottom: 10 }}>
              <div style={{ fontWeight: 700 }}>{r.title}</div>
              <div style={{ opacity: 0.8, fontSize: 12, marginTop: 3, lineHeight: 1.35 }}>
                {r.how}
              </div>
            </li>
          ))}
        </ol>
      </div>
  <ol style={{ paddingLeft: 18, margin: 0 }}>
    {(report?.narrative?.playerOverview?.recommendations ?? []).slice(0,2).map((r, i) => (
      <li key={i} style={{ marginBottom: 10 }}>
        <div style={{ fontWeight: 700 }}>{r}</div>
        <div style={{ opacity: 0.8, fontSize: 12, marginTop: 3, lineHeight: 1.35 }}>
          {(report?.narrative?.playerOverview?.recHowto?.[i]) ?? "Work this in slow reps first, then blend it into full speed."}
        </div>
      </li>
    ))}
  </ol>
</div>
</Collapsible>
</Card>

            <Card>
  <Collapsible title="3 things to improve next" defaultOpen={true}>
<ul style={{ margin: 0, paddingLeft: 18, opacity: 0.9, lineHeight: 1.6 }}>
                {narrative.improve.slice(0, 3).map((x, i) => (
                  <li key={i}>{x}</li>
                ))}
              </ul>

<div style={{ marginTop: 12, paddingTop: 10, borderTop: "1px solid rgba(255,255,255,0.08)" }}>
  <div style={{ fontSize: 12, fontWeight: 900, opacity: 0.75, marginBottom: 6 }}>
  Top 3 fixes</div>
  <ol style={{ paddingLeft: 18, margin: 0 }}>
    {(report?.narrative?.playerOverview?.recommendations ?? []).slice(0,2).map((r, i) => (
      <li key={i} style={{ marginBottom: 10 }}>
        <div style={{ fontWeight: 700 }}>{r}</div>
        <div style={{ opacity: 0.8, fontSize: 12, marginTop: 3, lineHeight: 1.35 }}>
          {(report?.narrative?.playerOverview?.recHowto?.[i]) ?? "Work this in slow reps first, then blend it into full speed."}
        </div>
      </li>
    ))}
  </ol>
</div>
</Collapsible>
</Card>

            <Card>
  <Collapsible title="3 possible power leaks" defaultOpen={false}>
<ul style={{ margin: 0, paddingLeft: 18, opacity: 0.9, lineHeight: 1.6 }}>
                {narrative.powerLeaks.slice(0, 3).map((x, i) => (
                  <li key={i}>{x}</li>
                ))}
              </ul>

<div style={{ marginTop: 12, paddingTop: 10, borderTop: "1px solid rgba(255,255,255,0.08)" }}>
  <div style={{ fontSize: 12, fontWeight: 900, opacity: 0.75, marginBottom: 6 }}>
  Top 3 fixes</div>
  <ol style={{ paddingLeft: 18, margin: 0 }}>
    {(report?.narrative?.playerOverview?.recommendations ?? []).slice(0,2).map((r, i) => (
      <li key={i} style={{ marginBottom: 10 }}>
        <div style={{ fontWeight: 700 }}>{r}</div>
        <div style={{ opacity: 0.8, fontSize: 12, marginTop: 3, lineHeight: 1.35 }}>
          {(report?.narrative?.playerOverview?.recHowto?.[i]) ?? "Work this in slow reps first, then blend it into full speed."}
        </div>
      </li>
    ))}
  </ol>
</div>
</Collapsible>
</Card>
          </div>
        </div>

        {dictKey && (
          <div
            onClick={() => setDictKey(null)}
            style={{
              position: "fixed",
              inset: 0,
              background: "rgba(0,0,0,0.62)",
              display: "grid",
              placeItems: "center",
              padding: 16,
              zIndex: 50,
            }}
          >
            <div
              onClick={(e) => e.stopPropagation()}
              style={{
                width: "min(720px, 96vw)",
                borderRadius: 18,
                border: "1px solid rgba(255,255,255,0.14)",
                background: "rgba(6,10,16,0.95)",
                boxShadow: "0 20px 70px rgba(0,0,0,0.6)",
                overflow: "hidden",
              }}
            >
              <div
                style={{
                  padding: "14px 16px",
                  borderBottom: "1px solid rgba(255,255,255,0.10)",
                  display: "flex",
                  justifyContent: "space-between",
                  alignItems: "center",
                }}
              >
                <div style={{ fontWeight: 900 }}>{DICTIONARY[dictKey].title}</div>
                <button
                  type="button"
                  onClick={() => setDictKey(null)}
                  style={{
                    borderRadius: 10,
                    border: "1px solid rgba(255,255,255,0.14)",
                    background: "rgba(0,0,0,0.25)",
                    color: "#e6edf6",
                    padding: "8px 10px",
                    cursor: "pointer",
                    fontWeight: 900,
                  }}
                >
                  Close
                </button>
              </div>
              <div style={{ padding: 16, lineHeight: 1.65, opacity: 0.92 }}>{DICTIONARY[dictKey].body}</div>
            </div>
          </div>
        )}
      </div>
    </div>
    </div>
  </div>

  );
}


































